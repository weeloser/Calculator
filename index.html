<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculator_ByWeeloser</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3Eüìà%3C/text%3E%3C/svg%3E" type="image/svg+xml">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        html {
            scroll-behavior: smooth; /* 1. –ü–ª–∞–≤–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ */
        }
        :root {
            --primary: #06b6d4;
            --secondary: #10b981;
            --accent: #facc15;
            --bg: #0c0a09;
            --card-bg: #1c1917;
            --text: #f8fafc;
            --border-radius: 12px;
            --transition: all 0.3s ease;
            --shadow: 0 4px 12px rgba(var(--primary-rgb), 0.3);
            --primary-rgb: 6, 182, 212;
            --accent-rgb: 250, 204, 21;
            --placeholder-text-color: #a1a1aa;
            --warning-color: #ef4444;
            --profit-color: #10b981;
            --button-bg: var(--primary);
            --button-text: #0c0a09;
            --button-hover-bg: var(--accent);
            --button-active-shadow: inset 0 2px 5px rgba(0,0,0,0.2);
            --container-max-width: 1200px;
            --body-padding: 1.5rem;
            --tab-padding: 0.75rem 1.5rem;
            --input-padding: 0.75rem 1rem;
            --font-size-base: 1rem;
            --font-size-h2: 1.8rem;
            --font-size-result-title: 1.1rem;
            --font-size-result-value: 1.6rem;
            --gap-large: 2rem;
            --gap-medium: 1.5rem;
            --gap-small: 1rem;
            --settings-card-border: 1px solid rgba(var(--primary-rgb), 0.2);
            --settings-item-bg: rgba(var(--primary-rgb), 0.08);
            --settings-item-hover-bg: rgba(var(--primary-rgb), 0.15);
            --settings-input-bg: #2d3748;
            --settings-input-border: 1px solid #4a5568;
            --selection-bg: var(--primary);
            --selection-text: white;
            --history-item-bg: #282422;
        }

        [data-theme="dark"] {
            --primary: #5a67d8;
            --secondary: #4299e1;
            --accent: #8b5cf6;
            --bg: #1a202c;
            --card-bg: #2d3748;
            --text: #e2e8f0;
            --shadow: 0 4px 12px rgba(90, 103, 216, 0.3);
            --primary-rgb: 90, 103, 216;
            --secondary-rgb: 66, 153, 225;
            --accent-rgb: 139, 92, 246;
            --placeholder-text-color: #a0aec0;
            --button-bg: var(--primary);
            --button-text: #e2e8f0;
            --button-hover-bg: var(--accent);
            --settings-card-border: 1px solid rgba(var(--primary-rgb), 0.3);
            --settings-item-bg: rgba(var(--primary-rgb), 0.15);
            --settings-item-hover-bg: rgba(var(--primary-rgb), 0.25);
            --settings-input-bg: #1a202c;
            --settings-input-border: 1px solid #4a5568;
            --history-item-bg: #222938;
        }

        [data-theme="light"] {
            --primary: #4c51bf;
            --secondary: #3182ce;
            --accent: #6b46c1;
            --bg: #f0f4f8;
            --card-bg: #ffffff;
            --text: #1e293b;
            --shadow: 0 6px 16px rgba(76, 81, 191, 0.15), 0 2px 8px rgba(0,0,0,0.05);
            --primary-rgb: 76, 81, 191;
            --secondary-rgb: 49, 130, 206;
            --accent-rgb: 107, 70, 193;
            --placeholder-text-color: #64748b;
            --button-bg: var(--primary);
            --button-text: #ffffff;
            --button-hover-bg: var(--accent);
            --settings-card-border: 1px solid rgba(var(--primary-rgb), 0.1);
            --settings-item-bg: rgba(var(--primary-rgb), 0.05);
            --settings-item-hover-bg: rgba(var(--primary-rgb), 0.1);
            --settings-input-bg: #f8fafc;
            --settings-input-border: 1px solid #cbd5e1;
            --profit-color: #059669;
            --warning-color: #dc2626;
            --selection-bg: var(--primary);
            --selection-text: white;
            --history-item-bg: #f5f8fb;
        }
        
        [data-theme="blue"] {
            --primary: #2563eb;
            --secondary: #3b82f6;
            --accent: #a855f7;
            --bg: #0f172a;
            --card-bg: #1e293b;
            --text: #e0f2fe;
            --shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
            --primary-rgb: 37, 99, 235;
            --secondary-rgb: 59, 130, 246;
            --accent-rgb: 168, 85, 247;
            --placeholder-text-color: #94a3b8;
            --button-bg: var(--primary);
            --button-text: #ffffff;
            --button-hover-bg: var(--accent);
            --settings-card-border: 1px solid rgba(var(--primary-rgb), 0.3);
            --settings-item-bg: rgba(var(--primary-rgb), 0.15);
            --settings-item-hover-bg: rgba(var(--primary-rgb), 0.25);
            --settings-input-bg: #0f172a;
            --settings-input-border: 1px solid #475569;
            --history-item-bg: #1a2230;
        }

        [data-theme="green"] {
            --primary: #059669;
            --secondary: #10b981;
            --accent: #84cc16;
            --bg: #0a0a0a;
            --card-bg: #1c1917;
            --text: #f0fdf4;
            --shadow: 0 4px 12px rgba(5, 150, 105, 0.3);
            --primary-rgb: 5, 150, 105;
            --secondary-rgb: 16, 185, 129;
            --accent-rgb: 132, 204, 22;
            --placeholder-text-color: #a1a1aa;
            --button-bg: var(--primary);
            --button-text: #ffffff;
            --button-hover-bg: var(--accent);
            --settings-card-border: 1px solid rgba(var(--primary-rgb), 0.3);
            --settings-item-bg: rgba(var(--primary-rgb), 0.15);
            --settings-item-hover-bg: rgba(var(--primary-rgb), 0.25);
            --settings-input-bg: #0a0a0a;
            --settings-input-border: 1px solid #4a5568;
            --history-item-bg: #161a19;
        }

        [data-theme="pink"] {
            --primary: #d82777;
            --secondary: #f472b6;
            --accent: #facc15;
            --bg: linear-gradient(135deg, #1a0610 0%, #290f1a 100%);
            --card-bg: #2d101c;
            --text: #fef0f8;
            --shadow: 0 8px 20px rgba(216, 39, 119, 0.35), 0 4px 10px rgba(0,0,0,0.1);
            --primary-rgb: 216, 39, 119;
            --secondary-rgb: 244, 114, 182;
            --accent-rgb: 250, 204, 21;
            --placeholder-text-color: #fbcfe8;
            --button-bg: var(--primary);
            --button-text: #ffffff;
            --button-hover-bg: var(--accent);
            --settings-card-border: 1px solid rgba(var(--primary-rgb), 0.4);
            --settings-item-bg: rgba(var(--primary-rgb), 0.2);
            --settings-item-hover-bg: rgba(var(--primary-rgb), 0.3);
            --settings-input-bg: rgba(45, 16, 28, 0.7);
            --settings-input-border: 1px solid rgba(var(--secondary-rgb), 0.5);
            --profit-color: #84cc16;
            --warning-color: #ef4444;
            --history-item-bg: #240c17;
        }

        [data-theme="purple"] {
            --primary: #9333ea;
            --secondary: #d946ef;
            --accent: #06b6d4;
            --bg: linear-gradient(135deg, #15062a 0%, #250b3e 100%);
            --card-bg: #2e1248;
            --text: #f3e8ff;
            --shadow: 0 8px 20px rgba(147, 51, 234, 0.35), 0 4px 10px rgba(0,0,0,0.1);
            --primary-rgb: 147, 51, 234;
            --secondary-rgb: 217, 70, 239;
            --accent-rgb: 6, 182, 212;
            --placeholder-text-color: #d8b4fe;
            --button-bg: var(--primary);
            --button-text: #ffffff;
            --button-hover-bg: var(--accent);
            --settings-card-border: 1px solid rgba(var(--primary-rgb), 0.4);
            --settings-item-bg: rgba(var(--primary-rgb), 0.2);
            --settings-item-hover-bg: rgba(var(--primary-rgb), 0.3);
            --settings-input-bg: rgba(46, 18, 72, 0.7);
            --settings-input-border: 1px solid rgba(var(--secondary-rgb), 0.5);
            --profit-color: #4ade80;
            --warning-color: #ef4444;
            --history-item-bg: #25103a;
        }

        body {
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow-x: hidden;
            font-family: 'Inter', sans-serif;
            padding: var(--body-padding);
        }
        /* 4. –ë–æ–ª–µ–µ –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è —Ñ–æ–Ω–∞ */
        body::before, body::after {
            content: '';
            position: fixed;
            z-index: -2;
            pointer-events: none;
            opacity: 0.8;
            filter: blur(12px);
            background-size: 200% 200%;
        }

        body::before {
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 75% 25%, rgba(var(--primary-rgb), 0.25) 0%, transparent 40%),
                        radial-gradient(circle at 25% 75%, rgba(var(--accent-rgb), 0.25) 0%, transparent 40%);
            animation: moveGradient 20s ease-in-out infinite alternate,
                       hueRotate 40s linear infinite,
                       radialScale 25s ease-in-out infinite alternate; /* 5. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Ä–∞–¥–∏–∞–ª—å–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è —Ñ–æ–Ω–∞ */
        }

        body::after {
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg,
                rgba(var(--secondary-rgb), 0.08) 0%, /* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å secondary-rgb */
                transparent 50%,
                rgba(var(--primary-rgb), 0.08) 100%
            );
            animation: backgroundPan 30s linear infinite alternate;
        }
        
        .background-element {
            position: fixed;
            border-radius: 50%;
            opacity: 0;
            background-color: rgba(var(--accent-rgb), 0.3);
            box-shadow: 0 0 50px rgba(var(--accent-rgb), 0.5);
            animation: floatAndFade 25s infinite ease-in-out;
            z-index: -3;
        }

        /* 2. –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–æ–Ω–æ–≤—ã–µ —á–∞—Å—Ç–∏—Ü—ã - –¥–æ–±–∞–≤–ª–µ–Ω—ã rotate –∏ scale –¥–ª—è –¥–∏–Ω–∞–º–∏—á–Ω–æ—Å—Ç–∏ */
        .background-element:nth-child(1) { width: 150px; height: 150px; top: 10%; left: 15%; animation-delay: 0s; background-color: rgba(var(--primary-rgb), 0.45); }
        .background-element:nth-child(2) { width: 200px; height: 200px; top: 60%; left: 70%; animation-delay: 8s; background-color: rgba(var(--accent-rgb), 0.45); }
        .background-element:nth-child(3) { width: 100px; height: 100px; top: 30%; left: 80%; animation-delay: 15s; background-color: rgba(var(--secondary-rgb), 0.45); }
        .background-element:nth-child(4) { width: 180px; height: 180px; top: 80%; left: 20%; animation-delay: 22s; background-color: rgba(var(--primary-rgb), 0.45); }
        .background-element:nth-child(5) { width: 120px; height: 120px; top: 5%; left: 40%; animation-delay: 5s; background-color: rgba(var(--accent-rgb), 0.35); }
        .background-element:nth-child(6) { width: 90px; height: 90px; top: 70%; left: 5%; animation-delay: 12s; background-color: rgba(var(--primary-rgb), 0.35); }
        .background-element:nth-child(7) { width: 160px; height: 160px; top: 25%; left: 55%; animation-delay: 18s; background-color: rgba(var(--secondary-rgb), 0.35); }
        /* 3. –¢–æ–Ω–∫–æ–µ –Ω–∞–ª–æ–∂–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç—É—Ä—ã —à—É–º–∞ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('data:image/svg+xml;base64,PHN2ZyB2aWR0aD0iNjAwIiBoZWlnaHQ9IjYwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZmlsdGVyIGlkPSJuIj48ZmVDb2xvck1hdHJpeCBpbi1rZXl3b3Jkcz0ic2F0dXJhdGUiIHR5cGU9Im1hdHJpeCIgdmFsdWVzPSIxIDAgMCAwIDAgMCAxIDAgMCAwIDAgMCAxIDAgMCAwIDAgMC41IDAgMCI+PC9mZUNvbG9yTWF0cml4PjwvZmlsdGVyPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbHRlcn0idXJsKCNuKSIgc3R5bGU9ImZpbGw6IHJnYmEoMCwwLDAsMC4wNSkiLz48L3N2Zz4=');
            opacity: 0.05;
            pointer-events: none;
            z-index: -1;
        }

        @keyframes moveGradient {
            0% { transform: translate(0, 0); }
            100% { transform: translate(-50%, -50%); }
        }

        @keyframes hueRotate {
            0% { filter: hue-rotate(0deg) blur(12px); }
            100% { filter: hue-rotate(360deg) blur(12px); }
        }
        /* 5. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Ä–∞–¥–∏–∞–ª—å–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è —Ñ–æ–Ω–∞ */
        @keyframes radialScale {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes backgroundPan {
            0% { background-position: 0% 0%; }
            100% { background-position: 100% 100%; }
        }
        /* 2. –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–æ–Ω–æ–≤—ã–µ —á–∞—Å—Ç–∏—Ü—ã - –æ–±–Ω–æ–≤–ª–µ–Ω–æ */
        @keyframes floatAndFade {
            0% { transform: translateY(0) scale(0.8) rotateZ(0deg); opacity: 0; }
            20% { opacity: 0.6; transform: translateY(-20px) scale(0.9) rotateZ(10deg); }
            80% { opacity: 0.6; transform: translateY(-180px) scale(1.1) rotateZ(-10deg); }
            100% { transform: translateY(-200px) scale(1.2) rotateZ(0deg); opacity: 0; }
        }

        .container {
            max-width: var(--container-max-width);
            width: 100%;
            margin: 0 auto;
            padding: 0 1rem;
            position: relative;
            z-index: 1;
            opacity: 0;
            transform: translateY(20px) scale(0.98) rotateX(2deg); /* 9. –£–ª—É—á—à–µ–Ω–∞ –∞–Ω–∏–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
            animation: containerFadeIn 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) 0.2s forwards;
            /* 6. –≠—Ñ—Ñ–µ–∫—Ç —Å–≤–µ—á–µ–Ω–∏—è –∫—Ä–∞–µ–≤ –Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ */
            box-shadow: 0 0 0 0px rgba(var(--primary-rgb), 0.7);
            animation: containerFadeIn 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) 0.2s forwards,
                       edgeGlow 4s ease-in-out infinite alternate 1s;
        }
        /* 6. –≠—Ñ—Ñ–µ–∫—Ç —Å–≤–µ—á–µ–Ω–∏—è –∫—Ä–∞–µ–≤ –Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ */
        @keyframes edgeGlow {
            0% { box-shadow: 0 0 0 0px rgba(var(--primary-rgb), 0.7); }
            50% { box-shadow: 0 0 25px 5px rgba(var(--primary-rgb), 0.7), 0 0 50px 10px rgba(var(--accent-rgb), 0.5); }
            100% { box-shadow: 0 0 0 0px rgba(var(--primary-rgb), 0.7); }
        }

        @keyframes containerFadeIn {
            to { opacity: 1; transform: translateY(0) scale(1) rotateX(0deg); }
        }

        .author {
            text-align: center;
            margin-bottom: var(--gap-large);
            font-size: 0.9rem;
            opacity: 0;
            /* 7. –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –∞–≤—Ç–æ—Ä–∞ */
            animation: fadeInAuthor 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) 0.7s forwards;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            color: var(--text); 
        }

        @keyframes fadeInAuthor {
            from { opacity: 0; transform: translateY(20px) scale(0.9); }
            to { opacity: 0.8; transform: translateY(0) scale(1); }
        }

        .author a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 700;
            transition: color 0.3s ease, text-shadow 0.3s ease;
        }

        .author a:hover {
            text-decoration: underline;
            color: var(--accent);
            text-shadow: 0 0 8px var(--accent);
        }

        .theme-switcher {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-top: var(--gap-small);
            justify-content: center;
            animation: none;
            max-width: 380px;
            margin-left: auto;
            margin-right: auto;
            margin-bottom: var(--gap-large);
            opacity: 1;
            transform: none;
        }

        .theme-button {
            width: 40px;
            height: 40px;
            border: 2px solid transparent;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275), border-color 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        /* 8. –≠—Ñ—Ñ–µ–∫—Ç –º–µ—Ä—Ü–∞–Ω–∏—è –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É —Ç–µ–º—ã */
        .theme-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, rgba(255,255,255,0.8), transparent);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            opacity: 0;
            transition: width 0.3s ease, height 0.3s ease, opacity 0.3s ease;
        }
        .theme-button:hover::before {
            width: 100px;
            height: 100px;
            opacity: 0.2;
        }

        .theme-button::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.7);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1) translate(-50%, -50%);
            transform-origin: 50% 50%;
        }
        /* 9. –ê–Ω–∏–º–∞—Ü–∏—è –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ —Ç–µ–º—ã */
        .theme-button:active::after {
            animation: themeButtonClickRipple 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }
        @keyframes themeButtonClickRipple {
            0% { transform: scale(0) translate(-50%, -50%); opacity: 1; }
            100% { transform: scale(10) translate(-50%, -50%); opacity: 0; }
        }

        .theme-button:hover {
            transform: scale(1.2) rotate(10deg);
            border-color: var(--accent);
            box-shadow: 0 0 12px var(--accent), 0 4px 8px rgba(0,0,0,0.2);
        }

        .theme-button.active-theme {
            border-color: var(--accent);
            box-shadow: 0 0 10px var(--accent), 0 0 20px var(--primary), inset 0 0 5px rgba(0,0,0,0.2);
            transform: scale(1.15) rotate(5deg);
            /* 10. –ü—É–ª—å—Å–∏—Ä—É—é—â–∞—è –≥—Ä–∞–Ω–∏—Ü–∞ –∞–∫—Ç–∏–≤–Ω–æ–π —Ç–µ–º—ã */
            animation: activeThemePulse 2s infinite ease-in-out;
        }
        @keyframes activeThemePulse {
            0% { box-shadow: 0 0 10px var(--accent), 0 0 20px var(--primary); }
            50% { box-shadow: 0 0 15px var(--accent), 0 0 30px var(--primary); }
            100% { box-shadow: 0 0 10px var(--accent), 0 0 20px var(--primary); }
        }


        .theme-dark { background: #1a202c; border: 2px solid #a0aec0; }
        .theme-light { background: #f8fafc; border: 2px solid #64748b; }
        .theme-blue { background: #2563eb; border: 2px solid #e0f2fe; }
        .theme-green { background: #059669; border: 2px solid #f0fdf4; }
        .theme-pink { background: #db2777; border: 2px solid #fef0f8; }
        .theme-purple { background: #9333ea; border: 2px solid #f3e8ff; }

        .tabs {
            display: flex;
            margin-bottom: var(--gap-large);
            border-radius: var(--border-radius);
            overflow: hidden;
            background: var(--card-bg);
            padding: 0.5rem;
            box-shadow: var(--shadow);
            flex-wrap: wrap;
            justify-content: center;
            animation: slideDownTabs 0.7s cubic-bezier(0.23, 1, 0.32, 1) 0.5s backwards;
            color: var(--text);
        }

        @keyframes slideDownTabs {
            from { transform: translateY(-40px) scale(0.95); opacity: 0; }
            to { transform: translateY(0) scale(1); opacity: 1; }
        }

        .tab {
            flex: 1;
            padding: var(--tab-padding);
            text-align: center;
            cursor: pointer;
            font-weight: 700;
            border-radius: calc(var(--border-radius) - 4px);
            transition: background-color 0.3s ease, color 0.3s ease, transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.3s ease;
            min-width: 150px;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }
        /* 11. –≠—Ñ—Ñ–µ–∫—Ç –±–ª–∏–∫–æ–≤ –Ω–∞ –≤–∫–ª–∞–¥–∫–µ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
        .tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 50%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: skewX(-20deg);
            transition: left 0.5s ease;
            z-index: -1;
        }
        .tab:hover:not(.active)::before {
            left: 100%;
        }

        .tab:hover:not(.active) {
            transform: translateY(-4px) scale(1.02);
            color: var(--primary);
            box-shadow: 0 0 15px rgba(var(--primary-rgb), 0.3); /* 17. –≠—Ñ—Ñ–µ–∫—Ç —Å–≤–µ—á–µ–Ω–∏—è –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫—É */
        }

        .tab.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 6px 12px rgba(var(--primary-rgb), 0.4), 0 0 20px rgba(var(--accent-rgb), 0.25);
            position: relative;
            overflow: hidden;
            transform: translateY(-3px) scale(1.03);
            z-index: 2;
        }
        /* 12. –≠–ª–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—å –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏ */
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--accent), var(--secondary)); /* –ë–æ–ª–µ–µ —è—Ä–∫–∏–π –≥—Ä–∞–¥–∏–µ–Ω—Ç */
            transform: scaleX(0);
            transform-origin: center;
            animation: activeTabUnderline 0.6s cubic-bezier(0.23, 1, 0.32, 1) forwards;
            border-radius: 2px;
        }

        @keyframes activeTabUnderline {
            0% { transform: scaleX(0); opacity: 0; }
            70% { transform: scaleX(1.1); opacity: 1; }
            100% { transform: scaleX(1); opacity: 1; }
        }
        /* 13. –¢–µ–Ω—å —Ç–µ–∫—Å—Ç–∞ –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏ */
        .tab.active {
            text-shadow: 0 0 8px rgba(255,255,255,0.5);
        }

        .tab-content {
            opacity: 0;
            visibility: hidden;
            height: 0;
            overflow: hidden;
            /* 18. –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –≤–∫–ª–∞–¥–æ–∫ */
            transition: opacity 0.5s ease, visibility 0.5s ease, height 0.5s ease, transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            background: var(--card-bg);
            padding: var(--gap-large);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            color: var(--text);
            transform: translateY(20px);
        }

        .tab-content.active {
            opacity: 1;
            visibility: visible;
            height: auto;
            animation: tabContentAppear 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
            transform-origin: top center;
            transform: translateY(0);
        }

        @keyframes tabContentAppear {
            from { transform: translateY(20px) scaleY(0.95) rotateX(-10deg); opacity: 0; }
            to { transform: translateY(0) scaleY(1) rotateX(0deg); opacity: 1; }
        }

        .sub-tabs {
            display: flex;
            margin-bottom: var(--gap-medium);
            border-radius: var(--border-radius);
            background: var(--bg);
            padding: 0.3rem;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
            overflow: hidden;
            flex-wrap: wrap;
            justify-content: center;
            color: var(--text);
        }

        .sub-tab {
            flex: 1;
            padding: 0.7rem 1rem;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            border-radius: calc(var(--border-radius) - 6px);
            transition: background-color 0.3s ease, color 0.3s ease, transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
            min-width: 120px;
        }
        /* 21. –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–≤–∫–ª–∞–¥–∫–∏ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
        .sub-tab:hover:not(.active) {
            transform: scale(1.03);
            background-color: rgba(var(--primary-rgb), 0.1);
        }

        .sub-tab.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 2px 5px rgba(var(--primary-rgb), 0.2);
            transform: scale(1.05); /* 20. –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–≤–∫–ª–∞–¥–∫–∏ */
            /* 19. –°–≤–µ—á–µ–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü—ã –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–¥–≤–∫–ª–∞–¥–∫–∏ */
            border: 2px solid var(--accent);
            box-shadow: 0 0 10px var(--accent), 0 0 20px var(--primary);
        }
        /* 22. –ù–∞–∂–∞—Ç–∏–µ –ø–æ–¥–≤–∫–ª–∞–¥–∫–∏ */
        .sub-tab:active {
            transform: scale(0.98);
        }
        /* 20. –ü—É–ª—å—Å–∞—Ü–∏—è —Ñ–æ–Ω–∞ –ø–æ–¥–≤–∫–ª–∞–¥–∫–∏ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
        .sub-tab:hover::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, rgba(255,255,255,0.1), transparent);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            animation: ripple 0.6s linear forwards;
        }
        @keyframes ripple {
            to { width: 100%; height: 100%; opacity: 0; }
        }

        .sub-tab-content {
            display: none;
        }

        .sub-tab-content.active {
            display: block;
        }

        .calculator {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--gap-large);
        }

        .input-section {
            display: grid;
            gap: var(--gap-medium);
        }

        .input-group {
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            animation: inputGroupAppear 0.6s cubic-bezier(0.215, 0.610, 0.355, 1) backwards;
        }

        .input-section .input-group:nth-child(1) { animation-delay: 0.1s; }
        .input-section .input-group:nth-child(2) { animation-delay: 0.2s; }
        .input-section .input-group:nth-child(3) { animation-delay: 0.3s; }
        .input-section .input-group:nth-child(4) { animation-delay: 0.4s; }
        .input-section .input-group:nth-child(5) { animation-delay: 0.5s; }

        @keyframes inputGroupAppear {
            from { opacity: 0; transform: translateX(-25px) skewX(-10deg); }
            to { opacity: 1; transform: translateX(0) skewX(0deg); }
        }
        /* 30. –ü—É–ª—å—Å–∏—Ä—É—é—â–∏–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ñ–æ–∫—É—Å–∞ –≤–≤–æ–¥–∞ */
        .input-group::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0%;
            height: 3px;
            background: linear-gradient(to right, var(--primary), var(--accent));
            transition: width 0.5s cubic-bezier(0.23, 1, 0.32, 1), left 0.5s cubic-bezier(0.23, 1, 0.32, 1);
            border-radius: 2px;
        }

        .input-group:focus-within::before {
            width: 100%;
            left: 0;
            animation: inputGroupFocusPulse 1s infinite alternate; 
        }
        @keyframes inputGroupFocusPulse {
            from { opacity: 0.7; transform: scaleX(0.9); }
            to { opacity: 1; transform: scaleX(1); }
        }


        .input-group label {
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text);
            transform: translateX(-10px);
            opacity: 0;
            animation: labelSlideIn 0.5s ease-out 0.2s forwards;
            transition: text-shadow 0.3s ease, color 0.3s ease; /* 23. –ê–∫—Ü–µ–Ω—Ç –º–µ—Ç–∫–∏ –≤–≤–æ–¥–∞ */
        }
        /* 23. –ê–∫—Ü–µ–Ω—Ç –º–µ—Ç–∫–∏ –≤–≤–æ–¥–∞ */
        .input-group:focus-within label {
            text-shadow: 0 0 8px rgba(var(--primary-rgb), 0.5); 
            color: var(--primary);
        }
        @keyframes labelSlideIn {
            to { transform: translateX(0); opacity: 1;}
        }

        .input-group input {
            padding: var(--input-padding);
            border: 1px solid rgba(var(--text-rgb, 0,0,0), 0.2);
            border-radius: var(--border-radius);
            font-size: var(--font-size-base);
            transition: border-color 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease, transform 0.2s ease;
            background-color: var(--bg);
            color: var(--text);
        }

        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }
        /* 24. –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ç–µ–Ω—å –ø–æ–ª—è –≤–≤–æ–¥–∞ –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ */
        .input-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.5), 0 0 12px rgba(var(--accent-rgb), 0.3), inset 0 0 10px rgba(var(--primary-rgb), 0.2); 
            background-color: var(--card-bg);
            transform: scale(1.01);
        }
        /* 25. –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω–∞—è –≥—Ä–∞–Ω–∏—Ü–∞ –Ω–∞ —Ñ–æ–∫—É—Å–µ –≤–≤–æ–¥–∞ - —É–∂–µ –µ—Å—Ç—å, –Ω–æ —É—Å–∏–ª–∏–º */
        .input-group input:focus {
            border-image: linear-gradient(to right, var(--primary), var(--accent)) 1;
            border-image-slice: 1;
        }
        /* 31. –ê–Ω–∏–º–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏—è –≤–≤–æ–¥–∞ –ø—Ä–∏ –ø–µ—á–∞—Ç–∏ */
        .input-group input.typing-pulse {
            animation: typingPulse 0.3s ease-out;
        }
        @keyframes typingPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.015); }
            100% { transform: scale(1); }
        }
        /* 27. –ê–Ω–∏–º–∞—Ü–∏—è –¥—Ä–æ–∂–∞–Ω–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–µ –≤–≤–æ–¥–∞ */
        .input-group input.invalid-input {
            animation: shake 0.3s cubic-bezier(.36,.07,.19,.97) both;
            transform: translate3d(0, 0, 0);
            backface-visibility: hidden;
            perspective: 1000px;
        }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
        /* 26. –ü–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ/–∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞-–∑–∞–ø–æ–ª–Ω–∏—Ç–µ–ª—è - —É—Å–∏–ª–µ–Ω–æ */
        .input-group input::placeholder {
            transition: opacity 0.3s ease;
        }
        .input-group input:focus::placeholder {
            opacity: 0.5;
        }


        .slider-container {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
             animation: inputGroupAppear 0.6s cubic-bezier(0.215, 0.610, 0.355, 1) backwards;
             animation-delay: 0.4s;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            color: var(--text);
        }

        .slider {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 12px;
            border-radius: 6px;
            background: linear-gradient(to right, var(--primary) 0%, var(--secondary) 50%, var(--accent) 100%);
            outline: none;
            transition: background 0.4s ease, box-shadow 0.4s ease;
            cursor: pointer;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
        }
        /* 29. –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –¥–æ—Ä–æ–∂–∫–∏ —Å–ª–∞–π–¥–µ—Ä–∞ */
        .slider::-webkit-slider-runnable-track {
            background: linear-gradient(to right, var(--primary) 0%, var(--secondary) 50%, var(--accent) 100%);
            background-size: 200% 100%;
            background-position: var(--fill-percent, 0%) 0%; /* –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è JS */
            transition: background-position 0.3s ease;
        }

        .slider:hover {
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.2), 0 0 10px rgba(var(--primary-rgb), 0.6);
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 26px;
            height: 26px;
            border-radius: 50%;
            background: white;
            cursor: grab;
            transition: transform 0.25s cubic-bezier(0.175, 0.885, 0.32, 1.275), box-shadow 0.25s ease;
            box-shadow: 0 3px 7px rgba(var(--accent-rgb), 0.5), 0 1px 3px rgba(0,0,0,0.3);
            border: 3px solid var(--accent);
        }
        .slider::-webkit-slider-thumb:active {
            cursor: grabbing;
            box-shadow: 0 0 15px rgba(var(--accent-rgb), 0.9), 0 0 20px var(--primary); /* 30. –°–≤–µ—á–µ–Ω–∏–µ –ø–æ–ª–∑—É–Ω–∫–∞ —Å–ª–∞–π–¥–µ—Ä–∞ */
            animation: thumbPop 0.3s ease-in-out;
            /* 31. –ì–ª—É–±–∏–Ω–∞ —Ç–µ–Ω–∏ –ø–æ–ª–∑—É–Ω–∫–∞ —Å–ª–∞–π–¥–µ—Ä–∞ */
            box-shadow: 0 8px 20px rgba(var(--accent-rgb), 0.8), 0 0 30px var(--primary);
        }

        .slider::-moz-range-thumb {
            width: 26px;
            height: 26px;
            border-radius: 50%;
            background: white;
            cursor: grab;
            box-shadow: 0 3px 7px rgba(var(--accent-rgb), 0.5), 0 1px 3px rgba(0,0,0,0.3);
            border: 3px solid var(--accent);
        }
         .slider::-moz-range-thumb:active {
            cursor: grabbing;
            box-shadow: 0 0 15px rgba(var(--accent-rgb), 0.9), 0 0 20px var(--primary); /* 30. –°–≤–µ—á–µ–Ω–∏–µ –ø–æ–ª–∑—É–Ω–∫–∞ —Å–ª–∞–π–¥–µ—Ä–∞ */
            animation: thumbPop 0.3s ease-in-out;
            /* 31. –ì–ª—É–±–∏–Ω–∞ —Ç–µ–Ω–∏ –ø–æ–ª–∑—É–Ω–∫–∞ —Å–ª–∞–π–¥–µ—Ä–∞ */
            box-shadow: 0 8px 20px rgba(var(--accent-rgb), 0.8), 0 0 30px var(--primary);
        }

        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.25) rotate(10deg);
            box-shadow: 0 5px 10px rgba(var(--accent-rgb), 0.7), 0 0 15px var(--accent);
        }
         .slider::-moz-range-thumb:hover {
            transform: scale(1.25) rotate(10deg);
            box-shadow: 0 5px 10px rgba(var(--accent-rgb), 0.7), 0 0 15px var(--accent);
        }

        @keyframes thumbPop {
            0%, 100% { transform: scale(1.2); }
            50% { transform: scale(1.1); }
        }
        /* 32. –°–≤–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∑–Ω–∞—á–µ–Ω–∏—è —Å–ª–∞–π–¥–µ—Ä–∞ */
        #riskValue {
            transition: text-shadow 0.3s ease;
        }
        .slider-container:focus-within #riskValue {
            text-shadow: 0 0 10px rgba(var(--accent-rgb), 0.7);
        }
        /* 33. –í–∏–∑—É–∞–ª—å–Ω—ã–µ –æ—Ç–º–µ—Ç–∫–∏ —Å–ª–∞–π–¥–µ—Ä–∞ */
        .slider::before, .slider::after {
            content: '';
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 2px;
            height: 8px;
            background-color: rgba(255,255,255,0.4);
            border-radius: 1px;
            z-index: 1;
        }
        .slider::before { left: 5%; }
        .slider::after { right: 5%; }


        .results {
            margin-top: var(--gap-large);
             animation: resultsAppear 0.7s cubic-bezier(0.165, 0.84, 0.44, 1) 0.6s backwards;
        }

        @keyframes resultsAppear {
            from { opacity: 0; transform: scale(0.9) perspective(500px) rotateX(-20deg); }
            to { transform: scale(1) perspective(500px) rotateX(0deg); }
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: var(--gap-medium);
        }

        .result-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: var(--gap-medium);
            box-shadow: var(--shadow);
            border-left: 6px solid var(--primary);
            /* 49. –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ */
            animation: fadeInUpResultCard 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) backwards;
            position: relative;
            overflow: hidden;
            /* 45. 3D-–Ω–∞–∫–ª–æ–Ω –∫–∞—Ä—Ç–æ—á–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
            transition: transform 0.35s cubic-bezier(0.075, 0.82, 0.165, 1), box-shadow 0.35s cubic-bezier(0.075, 0.82, 0.165, 1), border-color 0.3s ease, background-color 0.3s ease,
                        transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            transform-style: preserve-3d;
        }

        .result-grid .result-card:nth-child(1) { animation-delay: 0.7s; }
        .result-grid .result-card:nth-child(2) { animation-delay: 0.8s; }
        .result-grid .result-card:nth-child(3) { animation-delay: 0.9s; }
        .result-grid .result-card:nth-child(4) { animation-delay: 1.0s; }
        .result-grid .result-card:nth-child(5) { animation-delay: 1.1s; }

        @keyframes fadeInUpResultCard {
            from { opacity: 0; transform: translateY(30px) rotateX(-20deg) scale(0.9); }
            to { opacity: 1; transform: translateY(0) rotateX(0deg) scale(1); }
        }
        /* 46. –ê–Ω–∏–º–∞—Ü–∏—è –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ –≥—Ä–∞–Ω–∏—Ü—ã –∫–∞—Ä—Ç–æ—á–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ */
        .result-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, rgba(var(--primary-rgb), 0.1), rgba(var(--accent-rgb), 0.1));
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        .result-card:hover::before {
            opacity: 1;
        }

        .result-card:hover {
            transform: translateY(-12px) rotateX(7deg) scale(1.04) skewY(-1deg);
            /* 50. –ê–Ω–∏–º–∞—Ü–∏—è —Ç–µ–Ω–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ */
            box-shadow: 0 18px 30px rgba(var(--primary-rgb), 0.25), 0 8px 15px rgba(0,0,0,0.15), 0 0 30px rgba(var(--accent-rgb), 0.4);
        }

        .result-card.calculating-animation {
            animation: resultCardPulse 0.4s ease-out;
            border-color: var(--accent); 
        }
        /* 47. –ü—É–ª—å—Å–∞—Ü–∏—è —Ñ–æ–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ */
        .result-card.flash-bg {
            animation: resultCardBgFlash 0.3s ease-out;
        }

        @keyframes resultCardPulse {
            0% { transform: scale(1); box-shadow: var(--shadow); border-color: var(--primary); }
            50% { transform: scale(1.03); box-shadow: 0 0 15px rgba(var(--primary-rgb), 0.6); border-color: var(--accent); }
            100% { transform: scale(1); box-shadow: var(--shadow); border-color: var(--primary); }
        }
        @keyframes resultCardBgFlash {
            0% { background-color: var(--card-bg); }
            50% { background-color: rgba(var(--primary-rgb), 0.2); }
            100% { background-color: var(--card-bg); }
        }


        .result-title {
            font-size: var(--font-size-result-title);
            font-weight: 600;
            /* 52. –ì—Ä–∞–¥–∏–µ–Ω—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ */
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
            opacity: 0;
            transform: translateY(-10px);
            animation: resultTextAppear 0.5s ease-out 0.2s forwards;
        }

        .result-value {
            font-size: var(--font-size-result-value);
            font-weight: 700;
            color: var(--text);
            word-break: break-all;
            display: flex; /* –î–ª—è –∏–∫–æ–Ω–æ–∫ */
            align-items: center;
            gap: 0.5rem; /* –û—Ç—Å—Ç—É–ø –¥–ª—è –∏–∫–æ–Ω–æ–∫ */
            transition: opacity 0.25s ease-out, transform 0.25s ease-out, color 0.3s ease, text-shadow 0.3s ease;
            opacity: 0;
            transform: translateY(10px);
            animation: resultTextAppear 0.5s ease-out 0.3s forwards;
        }
         @keyframes resultTextAppear {
            to { opacity: 1; transform: translateY(0); }
        }

        .result-value.is-placeholder {
            font-size: 0.9rem;
            font-weight: 400;
            color: var(--placeholder-text-color);
            opacity: 0;
            animation: placeholderFadeIn 0.5s ease-out forwards;
        }
        @keyframes placeholderFadeIn {
            to { opacity: 0.7; }
        }

        .result-value.high-risk {
            color: var(--warning-color);
            font-weight: 700;
            animation: pulseRed 1s infinite alternate;
        }

        @keyframes pulseRed {
            from { color: var(--warning-color); text-shadow: 0 0 5px rgba(255,0,0,0.3); }
            to { color: #cc3333; text-shadow: 0 0 10px rgba(255,0,0,0.7); }
        }
        /* 53. –¢–µ–Ω—å —Ç–µ–∫—Å—Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ */
        .result-value.text-shadow-subtle {
            text-shadow: 0 1px 3px rgba(0,0,0,0.2), 0 0 8px rgba(var(--primary-rgb), 0.1);
        }

        .footer {
            display: none;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            background: var(--card-bg);
            box-shadow: var(--shadow);
        }

        .settings-section-card {
            background: rgba(var(--primary-rgb), 0.03);
            border: var(--settings-card-border);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            /* 51. –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ */
            opacity: 0;
            transform: translateY(20px) scale(0.95);
            animation: settingCardAppear 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }
        .settings-section-card:nth-child(1) { animation-delay: 0.1s; }
        .settings-section-card:nth-child(2) { animation-delay: 0.2s; }
        .settings-section-card:nth-child(3) { animation-delay: 0.3s; }

        @keyframes settingCardAppear {
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        /* 55. –ú–µ—Ä—Ü–∞–Ω–∏–µ –≤–µ—Ä—Ö–Ω–µ–π –ø–æ–ª–æ—Å—ã –∫–∞—Ä—Ç–æ—á–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ */
        .settings-section-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            border-top-left-radius: inherit;
            border-top-right-radius: inherit;
        }

        .settings-section-card:hover {
            box-shadow: var(--shadow), 0 0 15px rgba(var(--primary-rgb), 0.2);
            transform: translateY(-5px);
        }

        .settings-section-card h3 {
            font-size: 1.4rem;
            color: var(--primary);
            margin-bottom: 1.5rem;
            border-bottom: 1px solid rgba(var(--primary-rgb), 0.3);
            padding-bottom: 0.75rem;
            position: relative;
        }
        .settings-section-card h3::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: -1px;
            width: 50px;
            height: 2px;
            background: var(--accent);
            transition: width 0.3s ease;
        }
        .settings-section-card:hover h3::after {
            width: 100%;
        }

        .settings-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            background: var(--settings-item-bg);
            border-radius: var(--border-radius);
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
            cursor: pointer;
            border: 1px solid rgba(var(--primary-rgb), 0.1);
            color: var(--text);
        }
        /* 51. –≠—Ñ—Ñ–µ–∫—Ç –ø–∞—Ä–µ–Ω–∏—è –¥–ª—è –ø—É–Ω–∫—Ç–æ–≤ –Ω–∞—Å—Ç—Ä–æ–µ–∫ */
        .setting-item:hover {
            background-color: var(--settings-item-hover-bg);
            transform: translateY(-3px); 
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .setting-item label {
            font-weight: 600;
            color: var(--text);
            flex-grow: 1;
            margin-right: 1rem;
            cursor: inherit;
        }

        .input-group.settings-input {
            margin-top: 0.5rem;
            margin-bottom: 1rem;
            position: relative;
        }

        .input-group.settings-input input {
            width: 100%;
            background-color: var(--settings-input-bg);
            border: var(--settings-input-border);
            padding: 0.75rem;
            border-radius: var(--border-radius);
            color: var(--text);
            font-size: 1rem;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .input-group.settings-input input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.3);
            /* 54. –°–≤–µ—á–µ–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü—ã –ø–æ–ª—è –≤–∞–ª—é—Ç—ã */
            box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.5), 0 0 15px rgba(var(--accent-rgb), 0.4);
        }

        .settings-dropdown-wrapper {
            position: relative;
            display: inline-block;
            width: 80px;
            text-align: center;
            cursor: pointer;
        }

        .settings-dropdown-display {
            background-color: var(--settings-input-bg);
            border: var(--settings-input-border);
            border-radius: var(--border-radius);
            padding: 0.75rem;
            color: var(--text);
            font-size: 1rem;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .settings-dropdown-display.focused {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.3);
        }

        .settings-dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: var(--settings-input-bg);
            border: var(--settings-input-border);
            border-radius: var(--border-radius);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            max-height: 200px;
            overflow-y: auto;
            z-index: 10;
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
            transition: opacity 0.2s ease, transform 0.2s ease, visibility 0.2s ease;
        }
        /* 53. –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ –º–µ–Ω—é –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ */
        .settings-dropdown-menu.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0) scaleY(1);
            animation: dropdownScaleIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
        @keyframes dropdownScaleIn {
            from { transform: translateY(-10px) scaleY(0); opacity: 0; }
            to { transform: translateY(0) scaleY(1); opacity: 1; }
        }


        .settings-dropdown-menu button {
            display: block;
            width: 100%;
            padding: 0.75rem 1rem;
            text-align: center;
            background: none;
            border: none;
            color: var(--text);
            cursor: pointer;
            transition: background-color 0.2s ease, color 0.2s ease;
        }
        /* 52. –í—ã–¥–µ–ª–µ–Ω–∏–µ –ø—É–Ω–∫—Ç–æ–≤ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ */
        .settings-dropdown-menu button:hover,
        .settings-dropdown-menu button.selected {
            background-color: var(--primary); 
            color: var(--selection-text);
            box-shadow: inset 0 0 8px rgba(0,0,0,0.2);
        }

        .checkbox-container {
            position: relative;
            display: inline-block;
            width: 28px;
            height: 28px;
            cursor: pointer;
            vertical-align: middle;
        }

        .checkbox-container input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .custom-checkbox {
            position: absolute;
            top: 0;
            left: 0;
            height: 28px;
            width: 28px;
            background-color: #eee;
            border-radius: 6px;
            transition: background-color 0.3s ease, box-shadow 0.3s ease, border 0.3s ease;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
            border: 2px solid transparent;
        }
        /* 52. –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —á–µ–∫–±–æ–∫—Å–∞ */
        .checkbox-container input:checked + .custom-checkbox {
            background-color: var(--primary);
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.5), inset 0 1px 3px rgba(0,0,0,0.2);
            animation: checkboxFill 0.3s ease forwards;
        }
        @keyframes checkboxFill {
            from { transform: scale(0.8); opacity: 0.5; }
            to { transform: scale(1); opacity: 1; }
        }

        .custom-checkbox:after {
            content: "";
            position: absolute;
            display: none;
            left: 10px;
            top: 4px;
            width: 6px;
            height: 12px;
            border: solid white;
            border-width: 0 3px 3px 0;
            transform: rotate(45deg);
        }

        .checkbox-container input:checked + .custom-checkbox:after {
            display: block;
        }

        .custom-checkbox:hover {
            box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.3);
        }

        .reset-button {
            background-color: #f44336;
            color: white;
            border: none;
            padding: 0.85rem 1.4rem;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 10px rgba(244, 67, 54, 0.3);
            margin-top: var(--gap-medium);
            width: fit-content;
            align-self: flex-end;
            display: block;
        }
        /* 41. –≠—Ñ—Ñ–µ–∫—Ç –ø–∞—Ä–µ–Ω–∏—è –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
        .reset-button:hover {
            background-color: #d32f2f;
            transform: translateY(-2px) rotateZ(-1deg); 
            box-shadow: 0 6px 15px rgba(244, 67, 54, 0.4);
        }
        /* 42. –ì–ª—É–±–∏–Ω–∞ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–æ–∫ */
        .reset-button:active {
            transform: translateY(0);
            box-shadow: inset 0 3px 8px rgba(0,0,0,0.3); 
        }
        /* 56. –ö–Ω–æ–ø–∫–∞ —Å–±—Ä–æ—Å–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å —ç—Ñ—Ñ–µ–∫—Ç–æ–º –ø—É–ª—å—Å–∞—Ü–∏–∏ */
        .reset-button.settings-reset-button:hover {
            animation: resetButtonPulse 1s infinite alternate;
        }
        @keyframes resetButtonPulse {
            0% { box-shadow: 0 6px 15px rgba(244, 67, 54, 0.4); }
            100% { box-shadow: 0 8px 20px rgba(244, 67, 54, 0.6), 0 0 25px rgba(244, 67, 54, 0.8); }
        }


        .validation-message {
            color: var(--warning-color);
            font-size: 0.85rem;
            margin-top: 0.25rem;
            min-height: 1rem;
            opacity: 0;
            transform: translateY(5px); /* 28. –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ —Å —ç—Ñ—Ñ–µ–∫—Ç–æ–º —Å–ª–∞–π–¥–∞ */
            transition: opacity 0.3s ease-out, transform 0.3s ease-out;
        }

        .validation-message:not(:empty) {
            opacity: 1;
            transform: translateY(0);
        }

        .input-group input.invalid-input {
            border-color: var(--warning-color);
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.5);
        }

        .notification-container {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .notification {
            background-color: var(--card-bg);
            color: var(--text);
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
            opacity: 0;
            transform: translateX(120%) scale(0.9);
            animation: slideInNotification 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards,
                       fadeOutNotification 0.7s cubic-bezier(0.55, 0.085, 0.68, 0.53) forwards 3.5s;
            border-left: 5px solid var(--primary);
            max-width: 320px;
            word-break: break-word;
            font-size: 0.95rem;
            display: flex; /* –î–ª—è –∏–∫–æ–Ω–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */
            align-items: center;
            gap: 0.75rem;
        }
        .notification.notification-success { border-left-color: var(--profit-color); }
        .notification.notification-warning { border-left-color: var(--warning-color); }
        .notification.notification-info { border-left-color: var(--primary); }
        /* 54. –ü—É–ª—å—Å–∞—Ü–∏—è —Ñ–æ–Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ */
        @keyframes slideInNotification {
            0% { opacity: 0; transform: translateX(120%) scale(0.9) ; box-shadow: 0 0 0 0 rgba(var(--primary-rgb), 0.7);}
            50% { box-shadow: 0 0 15px rgba(var(--primary-rgb), 0.7); }
            100% { opacity: 1; transform: translateX(0) scale(1); box-shadow: 0 5px 15px rgba(0,0,0,0.15); }
        }
        /* 55. –ê–Ω–∏–º–∞—Ü–∏—è "–≤—ã–ª–µ—Ç–∞" —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        @keyframes fadeOutNotification {
            from { opacity: 1; transform: translateX(0) scale(1) rotateZ(0deg); }
            to { opacity: 0; transform: translateX(150%) scale(0.7) rotateZ(10deg); } /* –ë–æ–ª–µ–µ –≤—ã—Ä–∞–∂–µ–Ω–Ω—ã–π –≤—ã–ª–µ—Ç */
        }
        /* 56. –û—Ç—Å–∫–æ–∫ –∏–∫–æ–Ω–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */
        .notification span.icon {
            animation: iconBounce 0.5s ease-out;
            display: inline-block;
        }
        @keyframes iconBounce {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); }
        }

        .slider-container .slider::-webkit-slider-thumb:active {
            animation: thumbPop 0.3s ease-in-out;
        }

         .slider-container .slider::-moz-range-thumb:active {
            animation: thumbPop 0.3s ease-in-out;
        }

        .function-toggle-button-container {
            display: flex;
            align-items: center;
            background-color: var(--primary);
            color: white;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            margin-bottom: var(--gap-small);
            cursor: pointer;
        }
        /* 41. –≠—Ñ—Ñ–µ–∫—Ç –ø–∞—Ä–µ–Ω–∏—è –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
        .function-toggle-button-container:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .function-toggle-button {
            flex-grow: 1;
            padding: 0.75rem 1rem;
            border: none;
            background: none;
            color: inherit;
            font-size: 1rem;
            font-weight: 600;
            text-align: left;
            cursor: pointer;
            border-radius: var(--border-radius);
            transition: background-color 0.2s ease;
        }

        .function-toggle-button:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .function-toggle-button:focus {
            outline: none;
        }
        /* 40. –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∫–Ω–æ–ø–∫–∏-–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è –ø—Ä–∏ –∫–ª–∏–∫–µ */
        .function-toggle-button:active {
            animation: toggleTextScale 0.3s ease-out;
        }
        @keyframes toggleTextScale {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        .function-toggle-button-container:not(.has-dropdown) .function-dropdown-toggle,
        .function-selector:not(.has-dropdown) {
            display: none !important;
        }

        .trade-type-switcher {
            display: flex;
            width: 100%;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: var(--gap-small);
        }

        .trade-type-button {
            flex: 1;
            padding: 0.75rem 1rem;
            text-align: center;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
            color: white;
            background-color: rgba(var(--text-rgb, 0,0,0), 0.3);
        }
        /* 39. –°–≤–µ—á–µ–Ω–∏–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è —Ç–∏–ø–∞ —Å–¥–µ–ª–∫–∏ */
        .trade-type-button.active {
            box-shadow: 0 4px 10px rgba(0,0,0,0.2), 0 0 15px rgba(var(--primary-rgb), 0.5); 
            position: relative;
            z-index: 1;
            animation: tradeTypeGlow 1.5s infinite alternate;
        }
        @keyframes tradeTypeGlow {
            0% { box-shadow: 0 4px 10px rgba(0,0,0,0.2), 0 0 15px rgba(var(--primary-rgb), 0.5); }
            100% { box-shadow: 0 4px 15px rgba(0,0,0,0.3), 0 0 25px rgba(var(--primary-rgb), 0.8); }
        }


        .trade-type-button:not(.active):hover {
            background-color: rgba(var(--text-rgb, 0,0,0), 0.1);
            color: var(--text);
        }

        .trade-type-button.long.active {
            background-color: #10b981;
        }

        .trade-type-button.short.active {
            background-color: #ef4444;
        }

        .copy-all-button {
            background-color: var(--secondary);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease, color 0.3s ease;
            box-shadow: 0 2px 5px rgba(var(--secondary-rgb), 0.2);
            margin-top: var(--gap-medium);
            width: fit-content;
            align-self: flex-start;
            display: block;
            position: relative; /* –î–ª—è shimmer */
            overflow: hidden;
            z-index: 0;
        }
        /* 36. –ú–µ—Ä—Ü–∞—é—â–∏–π —Ñ–æ–Ω –∫–Ω–æ–ø–∫–∏ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
        .copy-all-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 50%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transform: skewX(-20deg);
            transition: left 0.5s ease;
            z-index: -1;
        }
        .copy-all-button:hover::before {
            left: 100%;
        }

        /* 41. –≠—Ñ—Ñ–µ–∫—Ç –ø–∞—Ä–µ–Ω–∏—è –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
        .copy-all-button:hover {
            background-color: var(--primary);
            transform: translateY(-1px) rotateZ(1deg); 
            box-shadow: 0 3px 8px rgba(var(--primary-rgb), 0.3);
        }
        /* 42. –ì–ª—É–±–∏–Ω–∞ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–æ–∫ */
        .copy-all-button:active {
            transform: translateY(0);
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1); 
        }
        /* 43. –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –∫–Ω–æ–ø–∫–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è */
        .copy-all-button.copied { 
            background-color: var(--profit-color);
            color: white;
            animation: copiedFlash 0.5s ease-out;
        }
        @keyframes copiedFlash {
            0% { background-color: var(--secondary); }
            50% { background-color: var(--profit-color); transform: scale(1.05); }
            100% { background-color: var(--secondary); transform: scale(1); }
        }

        /* History related CSS - will be unused */
        .history-item {
            background-color: var(--history-item-bg);
            border-left: 4px solid var(--primary);
            padding: 0.75rem 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            transition: background-color 0.2s ease, transform 0.2s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(var(--primary-rgb), 0.1);
        }

        .history-item:hover {
            background-color: rgba(var(--primary-rgb), 0.1);
            transform: translateX(5px);
        }

        .history-item-header {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.25rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-item-date {
            font-size: 0.75rem;
            color: var(--placeholder-text-color);
            margin-left: auto;
        }

        .history-item-content {
            white-space: pre-wrap;
            word-break: break-all;
            color: var(--text);
        }

        .history-clear-all-button {
            background-color: #f44336;
            color: white;
            border: none;
            padding: 0.75rem 1.2rem;
            border-radius: var(--border-radius);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 10px rgba(244, 67, 54, 0.3);
            margin-top: var(--gap-medium);
            width: fit-content;
            align-self: flex-end;
            display: block;
        }
        .history-clear-all-button:hover {
            background-color: #d32f2f;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(244, 67, 54, 0.4);
        }
        .history-clear-all-button:active {
            transform: translateY(0);
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.2);
        }

        .input-mode-toggle { /* This entire block will be unused */
            display: none; 
        }
        
        @media (max-width: 768px) and (orientation: landscape) {
            body {
                padding: 0.5rem;
                display: flex;
                flex-direction: column;
                align-items: stretch;
                justify-content: flex-start;
            }

            .container {
                padding: 0.5rem;
                display: flex;
                flex-direction: column;
                width: 100%;
                height: 100vh;
                overflow-y: auto;
            }

            .tabs {
                flex-direction: row;
                justify-content: center;
                margin-bottom: 0.75rem;
                padding: 0.25rem;
            }

            .tab {
                min-width: unset;
                flex-basis: auto;
                margin: 0 0.25rem;
                font-size: 0.9rem;
                padding: 0.5rem 1rem;
            }

            .tab-content {
                padding: 1rem;
                flex-grow: 1;
                display: flex;
                flex-direction: column;
                height: auto;
            }

            #calculations.tab-content.active {
                flex-direction: column;
                flex-wrap: nowrap;
                justify-content: flex-start;
                align-items: stretch;
                gap: 0.75rem;
            }

            .sub-tabs {
                order: -1;
                width: 100%;
                margin-bottom: 0.5rem;
                padding: 0.15rem;
                flex-wrap: nowrap;
                overflow-x: auto;
            }
            .sub-tab {
                font-size: 0.8rem;
                padding: 0.4rem 0.8rem;
                min-width: fit-content;
                flex-basis: auto;
            }

            .calculator {
                display: flex;
                flex-direction: row;
                flex-grow: 1;
                margin-top: 0;
                gap: 0.75rem;
                align-items: flex-start;
                flex-wrap: nowrap;
            }

            .input-section, .results {
                flex: 1;
                min-width: 0;
                padding: 0.5rem;
                gap: 0.75rem;
            }
            .input-group label {
                margin-bottom: 0.25rem;
                font-size: 0.9rem;
            }
            .input-group input {
                padding: 0.5rem 0.75rem;
                font-size: 0.9rem;
            }
            .function-toggle-button-container {
                margin-bottom: 0.5rem;
            }
            .function-toggle-button {
                padding: 0.6rem 0.8rem;
                font-size: 0.9rem;
            }
            .slider-container {
                padding: 0.5rem 0;
            }
            .slider-label span {
                font-size: 0.9rem;
            }
            .slider {
                height: 10px;
            }
            .slider::-webkit-slider-thumb, .slider::-moz-range-thumb {
                width: 20px;
                height: 20px;
                border: 2px solid var(--accent);
            }

            .result-grid {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }
            .result-card {
                padding: 0.75rem;
                border-left-width: 4px;
            }
            .result-title {
                font-size: 0.9rem;
                margin-bottom: 0.25rem;
            }
            .result-value {
                font-size: 1.2rem;
            }

            .copy-all-button, .reset-button {
                width: 100%;
                margin-top: 0.75rem;
                padding: 0.4rem 0.8rem;
                font-size: 0.75rem;
            }
            .reset-button {
                align-self: stretch;
            }

            #settings.tab-content.active {
                flex-direction: column;
            }
            .settings-grid {
                grid-template-columns: 1fr;
                padding: 1rem;
                gap: 1rem;
            }
            .settings-section-card {
                padding: 1rem;
            }
            .settings-section-card h3 {
                font-size: 1.2rem;
                margin-bottom: 0.75rem;
                padding-bottom: 0.5rem;
            }
            .setting-item {
                padding: 0.5rem 0.75rem;
                font-size: 0.9rem;
            }
            .settings-dropdown-wrapper, #currencySymbolInput {
                width: 60px;
                font-size: 0.9rem;
                padding: 0.4rem;
            }
            .settings-dropdown-display, .settings-dropdown-menu button {
                 font-size: 0.9rem;
                 padding: 0.5rem;
            }
            #currencySymbolInput {
                text-align: center;
            }

            .input-mode-toggle {
                margin-bottom: 0.5rem;
            }
            .input-mode-button {
                padding: 0.5rem 0.6rem;
                font-size: 0.85rem;
            }
        }

        @media (max-width: 768px) and (orientation: portrait) {
            body {
                padding: 0.75rem;
            }
            .container {
                 padding: 0.5rem;
            }

            .calculator {
                grid-template-columns: 1fr;
                gap: var(--gap-medium);
            }

            .result-grid {
                grid-template-columns: 1fr;
            }

            .settings-grid {
                grid-template-columns: 1fr;
                padding: 1rem;
            }

            .tabs {
                padding: 0.25rem;
                flex-direction: column;
                align-items: stretch;
            }

            .tab {
                min-width: unset;
                flex-basis: auto;
                margin-bottom: 0.25rem;
            }
            .tabs .tab:last-child {
                margin-bottom: 0;
            }

             .theme-switcher {
                position: static;
                bottom: auto;
                right: auto;
                padding: 0;
                gap: 0.5rem;
                box-shadow: none;
                background: none;
                justify-content: center;
                margin-bottom: var(--gap-medium);
             }

             .theme-button {
                 width: 36px;
                 height: 36px;
             }

             .sub-tabs {
                 padding: 0.2rem;
                 flex-wrap: wrap;
                 justify-content: center;
                 margin-bottom: var(--gap-medium);
             }
             .sub-tab {
                 min-width: unset;
                 flex-basis: calc(50% - 0.2rem);
                 margin-bottom: 0.2rem;
             }
             .sub-tabs .sub-tab:last-child:nth-child(odd) {
                flex-basis: 100%;
             }

             .input-group, .slider-container, .function-toggle-button-container {
                 margin-left: 0;
                 margin-right: 0;
                 padding-left: 0;
                 padding-right: 0;
             }

            #currencySymbolInput {
                width: 80px;
                text-align: right;
                padding: 0.5rem 0.75rem;
                position: relative;
                left: 0;
                box-sizing: border-box;
            }
            .custom-checkbox:after {
                left: 10px;
                top: 4px;
            }

            .reset-button {
                width: 100%;
            }

            .author, .footer {
                padding: 0 0.5rem;
            }

            .settings-section-card {
                padding: 1.25rem;
            }
            .settings-section-card h3 {
                font-size: 1.3rem;
                margin-bottom: 1rem;
                padding-bottom: 0.5rem;
            }
            .setting-item {
                padding: 0.65rem 0.9rem;
            }
            .input-mode-toggle {
                margin-bottom: 0.5rem;
            }
            .input-mode-button {
                padding: 0.5rem 0.6rem;
                font-size: 0.85rem;
            }
            .history-item { /* will be unused */
                font-size: 0.85rem;
                padding: 0.65rem 0.9rem;
            }
            .history-item-header { /* will be unused */
                font-size: 0.95rem;
            }
            .history-item-date { /* will be unused */
                font-size: 0.7rem;
            }
            .history-clear-all-button { /* will be unused */
                width: 100%;
                font-size: 0.85rem;
                padding: 0.65rem 1rem;
            }
        }

        @media (min-width: 769px) {
            .calculator {
                grid-template-columns: 1fr 1fr;
            }

            .sub-tabs {
                flex-wrap: nowrap;
            }

            .sub-tab {
                flex-basis: auto;
                margin-bottom: 0;
            }

            .settings-dropdown-wrapper {
                width: 100px;
            }
            .settings-dropdown-display {
                padding: 0.75rem;
            }
            #currencySymbolInput {
                width: 80px;
                text-align: right;
            }
             .custom-checkbox:after {
                left: 10px;
                top: 4px;
            }
        }

        @media (min-width: 769px) and (max-width: 1024px) {
            .container {
                padding: 0 1.5rem;
            }
            .calculator {
                grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            }
            .result-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
        }

        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--card-bg);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 5px;
            border: 2px solid var(--card-bg);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--secondary), var(--accent));
        }

        :focus-visible {
            outline: 3px solid rgba(var(--primary-rgb), 0.7);
            outline-offset: 3px;
            border-radius: var(--border-radius);
        }
    </style>
</head>
<body>
    <div class="background-element"></div>
    <div class="background-element"></div>
    <div class="background-element"></div>
    <div class="background-element"></div>
    <div class="background-element"></div>
    <div class="background-element"></div>
    <div class="background-element"></div>

    <div class="notification-container"></div>

    <div class="container">
        <div class="author">
            <p>¬© <a href="https://t.me/weeloser " target="_blank">@weeloser</a></p>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('calculations')">–†–∞—Å—á–µ—Ç—ã</div>
            <div class="tab" onclick="switchTab('settings')">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
        </div>

        <div id="calculations" class="tab-content">
            <div class="sub-tabs">
                <div class="sub-tab active" onclick="switchSubTab('risk-on-deal')">–†–∏—Å–∫ –Ω–∞ —Å–¥–µ–ª–∫—É</div>
                <div class="sub-tab" onclick="switchSubTab('risk-reward-ratio')">R/R</div>
                <div class="sub-tab" onclick="switchSubTab('pnl-calculator')">–ü/–£</div>
            </div>

            <div id="risk-on-deal" class="sub-tab-content active">
                <div class="calculator">
                    <div class="input-section">
                        <div class="input-group">
                            <label for="balance">–ë–∞–ª–∞–Ω—Å</label>
                            <input type="number" id="balance" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –±–∞–ª–∞–Ω—Å" min="0.01" step="any">
                            <div class="validation-message" id="balance-validation"></div>
                        </div>

                        <div class="input-group">
                            <label for="leverage">–ü–ª–µ—á–æ</label>
                            <input type="number" id="leverage" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫—Ä–µ–¥–∏—Ç–Ω–æ–µ –ø–ª–µ—á–æ" min="1" step="any">
                            <div class="validation-message" id="leverage-validation"></div>
                        </div>

                        <div class="input-group">
                            <label for="entryPoint">–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞</label>
                            <input type="number" id="entryPoint" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–æ—á–∫—É –≤—Ö–æ–¥–∞" min="0.01" step="any">
                            <div class="validation-message" id="entryPoint-validation"></div>
                        </div>

                        <div class="input-group">
                            <label for="stopLoss">–¶–µ–Ω–∞ —Å—Ç–æ–ø-–ª–æ—Å—Å–∞</label>
                            <input type="number" id="stopLoss" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É —Å—Ç–æ–ø-–ª–æ—Å—Å–∞" min="0.01" step="any">
                            <div class="validation-message" id="stopLoss-validation"></div>
                        </div>

                        <div class="function-toggle-button-container" id="riskAmountToggleContainer">
                            <button id="riskToggleButton" class="function-toggle-button">% —Ä–∏—Å–∫–∞ –Ω–∞ —Å–¥–µ–ª–∫—É üîÑ</button>
                        </div>

                        <div id="riskPercentageSlider" class="slider-container">
                            <div class="slider-label">
                                <span>–ü—Ä–æ—Ü–µ–Ω—Ç —Ä–∏—Å–∫–∞</span>
                                <div id="riskValue">3.0%</div>
                            </div>
                            <input type="range" min="0.5" max="10" step="0.1" value="3" class="slider" id="riskSlider">
                            <div id="riskWarning" class="validation-message"></div>
                        </div>

                        <div id="fixedLossInput" style="display: none;">
                            <div class="input-group">
                                <label for="fixedLoss">–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —É–±—ã—Ç–æ–∫</label>
                                <input type="number" id="fixedLoss" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É —É–±—ã—Ç–∫–∞" min="0.01" step="any">
                                <div class="validation-message" id="fixedLoss-validation"></div>
                            </div>
                        </div>

                        <button class="reset-button" onclick="resetRiskOnDealCalculator()">–°–±—Ä–æ—Å</button>
                    </div>

                    <div class="results">
                        <div class="result-grid">
                            <div class="result-card transition-hover">
                                <div class="result-title">–ú–∞—Ä–∂–∞</div>
                                <div class="result-value" id="margin">0.00</div>
                            </div>

                            <div class="result-card transition-hover">
                                <div class="result-title">–†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏</div>
                                <div class="result-value" id="positionSize">0.00</div>
                            </div>

                            <div class="result-card transition-hover">
                                <div class="result-title">–†–∏—Å–∫ –Ω–∞ —Å–¥–µ–ª–∫—É</div>
                                <div class="result-value" id="riskAmount">0.00</div>
                            </div>

                            <div class="result-card transition-hover">
                                <div class="result-title">–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ</div>
                                <div class="result-value text-shadow-subtle" id="pureMovement">0.00%</div>
                            </div>
                        </div>
                        <button class="copy-all-button" onclick="copyAllResults('risk-on-deal')">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
                    </div>
                </div>
            </div>

            <div id="risk-reward-ratio" class="sub-tab-content">
                <div class="calculator">
                    <div class="input-section">
                        <!-- Input mode toggle removed -->
                        <div class="input-group">
                            <label for="rrEntryPoint">–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞</label>
                            <input type="number" id="rrEntryPoint" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–æ—á–∫—É –≤—Ö–æ–¥–∞" min="0.01" step="any">
                            <div class="validation-message" id="rrEntryPoint-validation"></div>
                        </div>

                        <div class="input-group">
                            <label for="rrStopLoss" id="rrStopLossLabel">–¶–µ–Ω–∞ —Å—Ç–æ–ø-–ª–æ—Å—Å–∞</label>
                            <input type="number" id="rrStopLoss" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É —Å—Ç–æ–ø-–ª–æ—Å—Å–∞" min="0.01" step="any">
                            <div class="validation-message" id="rrStopLoss-validation"></div>
                        </div>

                        <div class="input-group">
                            <label for="rrTakeProfit" id="rrTakeProfitLabel">–¶–µ–Ω–∞ —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç–∞</label>
                            <input type="number" id="rrTakeProfit" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç–∞" min="0.01" step="any">
                            <div class="validation-message" id="rrTakeProfit-validation"></div>
                        </div>
                        <button class="reset-button" onclick="resetRiskRewardCalculator()">–°–±—Ä–æ—Å</button>
                    </div>

                    <div class="results">
                        <div class="result-grid">
                            <div class="result-card transition-hover">
                                <div class="result-title">–ü—É–Ω–∫—Ç–æ–≤ –¥–æ —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç–∞</div>
                                <div class="result-value text-shadow-subtle" id="rrTPPoints">0.00</div>
                            </div>

                            <div class="result-card transition-hover">
                                <div class="result-title">–ü—É–Ω–∫—Ç–æ–≤ –¥–æ —Å—Ç–æ–ø-–ª–æ—Å—Å–∞</div>
                                <div class="result-value text-shadow-subtle" id="rrSLPoints">0.00</div>
                            </div>

                            <div class="result-card transition-hover">
                                <div class="result-title">–°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Ä–∏—Å–∫–∞ –∏ –ø—Ä–∏–±—ã–ª–∏</div>
                                <div class="result-value text-shadow-subtle" id="rrRatio">0:0</div>
                            </div>
                        </div>
                        <button class="copy-all-button" onclick="copyAllResults('risk-reward-ratio')">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
                    </div>
                </div>
            </div>

            <div id="pnl-calculator" class="sub-tab-content">
                <div class="calculator">
                    <div class="input-section">
                        <div class="trade-type-switcher">
                            <div class="trade-type-button long active" id="pnlTradeTypeLong">LONG</div>
                            <div class="trade-type-button short" id="pnlTradeTypeShort">SHORT</div>
                        </div>
                        <!-- Input mode toggle removed -->
                        <div class="input-group">
                            <label for="pnlEntryPrice">–¶–µ–Ω–∞ –≤—Ö–æ–¥–∞</label>
                            <input type="number" id="pnlEntryPrice" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É –≤—Ö–æ–¥–∞" min="0.01" step="any">
                            <div class="validation-message" id="pnlEntryPrice-validation"></div>
                        </div>

                        <div class="input-group">
                            <label for="pnlExitPrice" id="pnlExitPriceLabel">–¶–µ–Ω–∞ –≤—ã—Ö–æ–¥–∞</label>
                            <input type="number" id="pnlExitPrice" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É –≤—ã—Ö–æ–¥–∞" min="0.01" step="any">
                            <div class="validation-message" id="pnlExitPrice-validation"></div>
                        </div>

                        <div class="input-group">
                            <label for="pnlPositionAmount">–°—É–º–º–∞ –ø–æ–∑–∏—Ü–∏–∏ <span style="color: var(--placeholder-text-color); font-size: 0.8em;">(–Ω–µ –ø—É—Ç–∞—Ç—å —Å –º–∞—Ä–∂–æ–π)</span></label>
                            <input type="number" id="pnlPositionAmount" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –ø–æ–∑–∏—Ü–∏–∏" min="0.01" step="any">
                            <div class="validation-message" id="pnlPositionAmount-validation"></div>
                        </div>

                        <div class="input-group">
                            <label for="pnlLeverage">–ü–ª–µ—á–æ</label>
                            <input type="number" id="pnlLeverage" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–ª–µ—á–æ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" min="1" step="any">
                            <div class="validation-message" id="pnlLeverage-validation"></div>
                        </div>

                        <button class="reset-button" onclick="resetPnLCalculator()">–°–±—Ä–æ—Å</button>
                    </div>

                    <div class="results">
                        <div class="result-grid">
                            <div class="result-card transition-hover">
                                <div class="result-title">–û–±—â–∞—è –ø—Ä–∏–±—ã–ª—å/—É–±—ã—Ç–æ–∫</div>
                                <div class="result-value" id="pnlTotalPnL">0.00</div>
                            </div>

                            <div class="result-card transition-hover">
                                <div class="result-title">ROI (%)</div>
                                <div class="result-value" id="pnlRoi">0.00%</div>
                            </div>

                            <div class="result-card transition-hover">
                                <div class="result-title">–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –≤ %</div>
                                <div class="result-value text-shadow-subtle" id="pnlPureMovement">0.00%</div>
                            </div>
                            <div class="result-card transition-hover">
                                <div class="result-title">–ü—É–Ω–∫—Ç–æ–≤ –º–µ–∂–¥—É –≤—Ö–æ–¥–æ–º/–≤—ã—Ö–æ–¥–æ–º</div>
                                <div class="result-value text-shadow-subtle" id="pnlPointsBetweenEntryExit">0.00</div>
                            </div>
                        </div>
                        <button class="copy-all-button" onclick="copyAllResults('pnl-calculator')">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="settings" class="tab-content">
            <div class="settings-grid">
                <div class="settings-section-card">
                    <h3>–¢–µ–º—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</h3>
                    <p style="color: var(--text);">–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–Ω—É –∏–∑ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ç–µ–º.</p>
                    <div class="theme-switcher" id="settingsThemeSwitcher"></div>
                </div>

                <!-- History section removed -->

                <div class="settings-section-card">
                    <h3>–î—Ä—É–≥–æ–µ</h3>
                    <div class="settings-list">
                        <div class="setting-item">
                            <label for="notificationToggle">–í–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</label>
                            <label class="checkbox-container">
                                <input type="checkbox" id="notificationToggle">
                                <span class="custom-checkbox"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <label for="precisionInput">–¢–æ—á–Ω–æ—Å—Ç—å</label>
                            <div class="settings-dropdown-wrapper">
                                <div class="settings-dropdown-display" id="precisionDisplay">2</div>
                                <div class="settings-dropdown-menu" id="precisionDropdownMenu">
                                </div>
                            </div>
                        </div>
                        <div class="setting-item">
                            <label for="currencySymbolInput">–í–∞–ª—é—Ç–Ω—ã–π —Å–∏–º–≤–æ–ª</label>
                            <input type="text" id="currencySymbolInput" maxlength="10" placeholder="$, ‚Ç¨, ‚ÇΩ" class="input-group-text-input" style="width: 80px; text-align: center; background-color: var(--settings-input-bg); border: var(--settings-input-border); border-radius: var(--border-radius); padding: 0.5rem 0.75rem; color: var(--text); font-size: 1rem; transition: border-color 0.3s ease, box-shadow 0.3s ease;">
                        </div>
                        <!-- Clear all calculators button removed -->
                        <button class="reset-button settings-reset-button" onclick="resetAllSettings()">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let balanceInput, leverageInput, riskSlider, riskValue, riskWarning;
        let marginDisplay, positionSizeDisplay, riskAmountDisplay, pureMovementDisplay;
        let entryPointInput, stopLossInput;
        let fixedLossInput, fixedLossValidation;

        let rrEntryPointInput, rrStopLossInput, rrTakeProfitInput;
        let rrSLPointsDisplay, rrTPPointsDisplay, rrRatioDisplay;
        let rrStopLossLabel, rrTakeProfitLabel;

        let pnlEntryPriceInput, pnlExitPriceInput, pnlPositionAmountInput, pnlLeverageInput;
        let pnlTotalPnLDisplay, pnlRoiDisplay, pnlPureMovementDisplay, pnlPointsBetweenEntryExitDisplay;
        let pnlTradeTypeLongButton, pnlTradeTypeShortButton;
        let pnlExitPriceLabel;
        let currentPnLTradeType = 'long';

        let notificationsEnabled = true;
        let currentPrecision = 2;
        let currencySymbol = '';
        let isFixedLossModeForRiskOnDeal = false;

        const placeholderMessage = "–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –±–æ–ª—å—à–µ –ø–æ–ª–µ–π –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞";

        // Moved function definitions to global scope for accessibility
        function updateRiskAmountUIMode() {
            const riskToggleButton = document.getElementById('riskToggleButton');
            const riskPercentageSliderContainer = document.getElementById('riskPercentageSlider');
            const fixedLossInputContainer = document.getElementById('fixedLossInput');
            if (isFixedLossModeForRiskOnDeal) {
                if (riskToggleButton) riskToggleButton.textContent = '–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —É–±—ã—Ç–æ–∫ üîÑ';
                if (riskPercentageSliderContainer) riskPercentageSliderContainer.style.display = 'none';
                if (fixedLossInputContainer) fixedLossInputContainer.style.display = 'block';
            } else {
                if (riskToggleButton) riskToggleButton.textContent = '% —Ä–∏—Å–∫–∞ –Ω–∞ —Å–¥–µ–ª–∫—É üîÑ';
                if (fixedLossInputContainer) fixedLossInputContainer.style.display = 'none';
                if (riskPercentageSliderContainer) riskPercentageSliderContainer.style.display = 'flex';
            }
            if (fixedLossValidation) fixedLossValidation.textContent = '';
            if (fixedLossInput) fixedLossInput.classList.remove('invalid-input');
        }

        function updatePnLTradeTypeUI() {
            if (pnlTradeTypeLongButton && pnlTradeTypeShortButton) {
                if (currentPnLTradeType === 'long') {
                    pnlTradeTypeLongButton.classList.add('active');
                    pnlTradeTypeShortButton.classList.remove('active');
                } else {
                    pnlTradeTypeLongButton.classList.remove('active');
                    pnlTradeTypeShortButton.classList.add('active');
                }
            }
        }

        function showNotification(message, type = 'info') {
            if (!notificationsEnabled) return;
            const container = document.querySelector('.notification-container');
            if (!container) return;
            const notification = document.createElement('div');
            notification.classList.add('notification', `notification-${type}`);
            
            let icon = '';
            if (type === 'success') icon = '<span class="icon">‚úÖ</span> ';
            else if (type === 'warning') icon = '<span class="icon">‚ö†Ô∏è</span> ';
            else if (type === 'error') icon = '<span class="icon">‚ùå</span> ';
            else icon = '<span class="icon">‚ÑπÔ∏è</span> ';

            notification.innerHTML = icon + message; // –ò–∫–æ–Ω–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
            container.appendChild(notification);
            requestAnimationFrame(() => {
                notification.style.opacity = '1';
                notification.style.transform = 'translateX(0) scale(1)';
            });
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(150%) scale(0.9) rotateZ(5deg)'; 
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 700);
            }, 3500);
        }

        const availableThemes = [
            { name: 'dark', label: '–¢–µ–º–Ω–∞—è' },
            { name: 'light', label: '–°–≤–µ—Ç–ª–∞—è' },
            { name: 'blue', label: '–ì–æ–ª—É–±–∞—è' },
            { name: 'green', label: '–ó–µ–ª–µ–Ω–∞—è' },
            { name: 'pink', label: '–†–æ–∑–æ–≤–∞—è' },
            { name: 'purple', label: '–§–∏–æ–ª–µ—Ç–æ–≤–∞—è' },
        ];

        function setTheme(themeName) {
            document.body.setAttribute('data-theme', themeName);
            localStorage.setItem('theme', themeName);
            const themeLabel = availableThemes.find(t => t.name === themeName)?.label || themeName;
            showNotification(`–¢–µ–º–∞ –∏–∑–º–µ–Ω–µ–Ω–∞ –Ω–∞ "${themeLabel}"`, 'success');
            updateThemeButtonActiveState(themeName);
        }

        function createThemeButtons() {
            const container = document.getElementById('settingsThemeSwitcher');
            if (!container) return;
            container.innerHTML = '';
            availableThemes.forEach(theme => {
                const button = document.createElement('button');
                button.className = `theme-button theme-${theme.name}`;
                button.title = theme.label;
                button.setAttribute('aria-label', `–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–º—É ${theme.label}`);
                button.onclick = () => setTheme(theme.name);
                container.appendChild(button);
            });
        }

        function updateThemeButtonActiveState(activeThemeName) {
             document.querySelectorAll('.theme-button').forEach(button => {
                 button.classList.remove('active-theme');
                 if (button.classList.contains(`theme-${activeThemeName}`)) {
                     button.classList.add('active-theme');
                 }
             });
        }

        function toggleNotifications(enabled) {
            notificationsEnabled = enabled;
            localStorage.setItem('notificationsEnabled', enabled);
            showNotification(`–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è ${enabled ? '–≤–∫–ª—é—á–µ–Ω—ã' : '–≤—ã–∫–ª—é—á–µ–Ω—ã'}`, 'info');
        }

        function setPrecision(precision) {
            currentPrecision = parseInt(precision);
            localStorage.setItem('currentPrecision', currentPrecision);
            const precisionDisplay = document.getElementById('precisionDisplay');
            if (precisionDisplay) {
                precisionDisplay.textContent = currentPrecision;
                document.querySelectorAll('#precisionDropdownMenu button').forEach(btn => {
                    btn.classList.remove('selected');
                    if (parseInt(btn.dataset.value) === currentPrecision) {
                        btn.classList.add('selected');
                    }
                });
            }
            calculateRiskOnDeal();
            calculateRiskReward();
            calculatePnL();
            showNotification(`–¢–æ—á–Ω–æ—Å—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞ ${currentPrecision}`, 'info');
        }

        function setCurrencySymbol(symbol) {
            currencySymbol = symbol;
            localStorage.setItem('currencySymbol', currencySymbol);
            calculateRiskOnDeal();
            calculatePnL();
        }

        function resetAllSettings() {
            localStorage.clear();
            notificationsEnabled = true;
            currentPrecision = 2;
            currencySymbol = '';
            const themeReset = 'dark';
            setTheme(themeReset);
            const notificationToggleInput = document.getElementById('notificationToggle');
            if (notificationToggleInput) notificationToggleInput.checked = true;
            const precisionDisplay = document.getElementById('precisionDisplay');
            if (precisionDisplay) precisionDisplay.textContent = 2;
            const precisionDropdownMenu = document.getElementById('precisionDropdownMenu');
            if (precisionDropdownMenu) {
                Array.from(precisionDropdownMenu.children).forEach(button => {
                    button.classList.remove('selected');
                    if (parseInt(button.dataset.value) === 2) {
                        button.classList.add('selected');
                    }
                });
            }
            const currencySymbolInput = document.getElementById('currencySymbolInput');
            if (currencySymbolInput) currencySymbolInput.value = '';
            
            resetRiskOnDealCalculator(false);
            resetRiskRewardCalculator(false);
            resetPnLCalculator(false);
            
            showNotification('–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–±—Ä–æ—à–µ–Ω—ã –¥–æ –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.', 'info');
        }

        document.addEventListener('DOMContentLoaded', () => {
            try {
                balanceInput = document.getElementById('balance');
                leverageInput = document.getElementById('leverage');
                riskSlider = document.getElementById('riskSlider');
                riskValue = document.getElementById('riskValue');
                riskWarning = document.getElementById('riskWarning');
                marginDisplay = document.getElementById('margin');
                positionSizeDisplay = document.getElementById('positionSize');
                riskAmountDisplay = document.getElementById('riskAmount');
                pureMovementDisplay = document.getElementById('pureMovement');

                entryPointInput = document.getElementById('entryPoint');
                stopLossInput = document.getElementById('stopLoss');
                fixedLossInput = document.getElementById('fixedLoss');
                fixedLossValidation = document.getElementById('fixedLoss-validation');

                rrEntryPointInput = document.getElementById('rrEntryPoint');
                rrStopLossInput = document.getElementById('rrStopLoss');
                rrTakeProfitInput = document.getElementById('rrTakeProfit');
                rrSLPointsDisplay = document.getElementById('rrSLPoints');
                rrTPPointsDisplay = document.getElementById('rrTPPoints');
                rrRatioDisplay = document.getElementById('rrRatio');
                rrStopLossLabel = document.getElementById('rrStopLossLabel');
                rrTakeProfitLabel = document.getElementById('rrTakeProfitLabel');

                pnlEntryPriceInput = document.getElementById('pnlEntryPrice');
                pnlExitPriceInput = document.getElementById('pnlExitPrice');
                pnlPositionAmountInput = document.getElementById('pnlPositionAmount');
                pnlLeverageInput = document.getElementById('pnlLeverage');
                pnlTradeTypeLongButton = document.getElementById('pnlTradeTypeLong');
                pnlTradeTypeShortButton = document.getElementById('pnlTradeTypeShort');
                pnlTotalPnLDisplay = document.getElementById('pnlTotalPnL');
                pnlRoiDisplay = document.getElementById('pnlRoi');
                pnlPureMovementDisplay = document.getElementById('pnlPureMovement');
                pnlPointsBetweenEntryExitDisplay = document.getElementById('pnlPointsBetweenEntryExit');
                pnlExitPriceLabel = document.getElementById('pnlExitPriceLabel');

                createThemeButtons();

                const savedTheme = localStorage.getItem('theme') || 'dark';
                if (availableThemes.some(t => t.name === savedTheme)) {
                    setTheme(savedTheme);
                } else {
                    setTheme('dark');
                }

                notificationsEnabled = localStorage.getItem('notificationsEnabled') !== 'false';
                const notificationToggleInput = document.getElementById('notificationToggle');
                if (notificationToggleInput) {
                    notificationToggleInput.checked = notificationsEnabled;
                    notificationToggleInput.addEventListener('change', () => toggleNotifications(notificationToggleInput.checked));
                }

                currentPrecision = parseInt(localStorage.getItem('currentPrecision') || '2');
                const precisionDisplay = document.getElementById('precisionDisplay');
                const precisionDropdownMenu = document.getElementById('precisionDropdownMenu');

                if (precisionDisplay && precisionDropdownMenu) {
                    precisionDisplay.textContent = currentPrecision;
                    for (let i = 1; i <= 5; i++) {
                        const optionButton = document.createElement('button');
                        optionButton.dataset.value = i;
                        optionButton.textContent = i;
                        if (i === currentPrecision) {
                            optionButton.classList.add('selected');
                        }
                        optionButton.addEventListener('click', () => {
                            setPrecision(i);
                            precisionDropdownMenu.classList.remove('active');
                            precisionDisplay.classList.remove('focused');
                        });
                        precisionDropdownMenu.appendChild(optionButton);
                    }

                    precisionDisplay.addEventListener('click', () => {
                        precisionDropdownMenu.classList.toggle('active');
                        precisionDisplay.classList.toggle('focused');
                    });

                    document.addEventListener('click', (event) => {
                        if (!precisionDisplay.contains(event.target) && !precisionDropdownMenu.contains(event.target)) {
                            precisionDropdownMenu.classList.remove('active');
                            precisionDisplay.classList.remove('focused');
                        }
                    });
                }

                currencySymbol = localStorage.getItem('currencySymbol') || '';
                const currencySymbolInput = document.getElementById('currencySymbolInput');
                if (currencySymbolInput) {
                    currencySymbolInput.value = currencySymbol;
                    currencySymbolInput.addEventListener('input', (event) => {
                        setCurrencySymbol(event.target.value);
                    });
                }
                
                const initialTab = localStorage.getItem('activeTab') || 'calculations';
                switchTab(initialTab);
                const initialSubTab = localStorage.getItem('activeSubTab-calculations') || 'risk-on-deal';
                switchSubTab(initialSubTab);

                if (balanceInput) balanceInput.addEventListener('input', calculateRiskOnDeal);
                if (leverageInput) leverageInput.addEventListener('input', calculateRiskOnDeal);
                if (riskSlider) riskSlider.addEventListener('input', () => {
                    const riskVal = parseFloat(riskSlider.value);
                    if (riskValue) riskValue.textContent = `${riskVal.toFixed(1)}%`;
                    calculateRiskOnDeal();
                });
                if (entryPointInput) entryPointInput.addEventListener('input', calculateRiskOnDeal);
                if (stopLossInput) stopLossInput.addEventListener('input', calculateRiskOnDeal);
                if (fixedLossInput) fixedLossInput.addEventListener('input', calculateRiskOnDeal);

                if (rrEntryPointInput) rrEntryPointInput.addEventListener('input', calculateRiskReward);
                if (rrStopLossInput) rrStopLossInput.addEventListener('input', calculateRiskReward);
                if (rrTakeProfitInput) rrTakeProfitInput.addEventListener('input', calculateRiskReward);

                if (pnlEntryPriceInput) pnlEntryPriceInput.addEventListener('input', calculatePnL);
                if (pnlExitPriceInput) pnlExitPriceInput.addEventListener('input', calculatePnL);
                if (pnlPositionAmountInput) pnlPositionAmountInput.addEventListener('input', calculatePnL);
                if (pnlLeverageInput) pnlLeverageInput.addEventListener('input', calculatePnL);

                if (pnlTradeTypeLongButton) {
                    pnlTradeTypeLongButton.addEventListener('click', () => {
                        currentPnLTradeType = 'long';
                        localStorage.setItem('currentPnLTradeType', 'long');
                        updatePnLTradeTypeUI();
                        calculatePnL();
                    });
                }
                if (pnlTradeTypeShortButton) {
                    pnlTradeTypeShortButton.addEventListener('click', () => {
                        currentPnLTradeType = 'short';
                        localStorage.setItem('currentPnLTradeType', 'short');
                        updatePnLTradeTypeUI();
                        calculatePnL();
                    });
                }

                document.querySelectorAll('.result-card').forEach(card => {
                    card.addEventListener('click', (event) => {
                        const valueElement = card.querySelector('.result-value');
                        if (valueElement && !valueElement.classList.contains('is-placeholder')) {
                            const textToCopy = valueElement.textContent.replace(/[^0-9.-]/g, '');
                            copyToClipboard(textToCopy);
                        }
                    });
                });

                const riskAmountToggleContainer = document.getElementById('riskAmountToggleContainer');
                // const riskToggleButton = document.getElementById('riskToggleButton'); // Defined globally

                if (riskAmountToggleContainer) {
                    riskAmountToggleContainer.addEventListener('click', () => {
                        isFixedLossModeForRiskOnDeal = !isFixedLossModeForRiskOnDeal;
                        localStorage.setItem('isFixedLossModeForRiskOnDeal', isFixedLossModeForRiskOnDeal);
                        updateRiskAmountUIMode();
                        calculateRiskOnDeal();
                    });
                }
                
                updateRiskAmountUIMode();
                updatePnLTradeTypeUI();

                document.addEventListener('keydown', (event) => {
                    if (event.ctrlKey && event.key === '1') {
                        event.preventDefault();
                        switchTab('calculations');
                    }
                    if (event.ctrlKey && event.key === '2') {
                        event.preventDefault();
                        switchTab('settings');
                    }

                    if (event.key === 'Enter') {
                        const activeElement = document.activeElement;
                        const formElements = Array.from(document.querySelectorAll('input:not([type="hidden"]):not([disabled]), select:not([disabled])'))
                                            .filter(el => {
                                                let isHidden = false;
                                                let current = el;
                                                while(current && current !== document.body) {
                                                    const style = window.getComputedStyle(current);
                                                    if (style.display === 'none' || style.visibility === 'hidden' || style.opacity === '0') {
                                                        isHidden = true;
                                                        break;
                                                    }
                                                    current = current.parentElement;
                                                }
                                                return !isHidden;
                                            });

                        const currentIndex = formElements.indexOf(activeElement);
                        if (currentIndex > -1 && currentIndex < formElements.length - 1) {
                            event.preventDefault();
                            formElements[currentIndex + 1].focus();
                        }
                    }
                });

                // Add event listener for input typing animation
                document.querySelectorAll('input[type="number"], .input-group-text-input').forEach(input => {
                    input.addEventListener('input', (event) => {
                        event.target.classList.add('typing-pulse');
                        event.target.addEventListener('animationend', () => {
                            event.target.classList.remove('typing-pulse');
                        }, { once: true });
                        // Update slider fill if it's the risk slider
                        if (event.target.id === 'riskSlider') {
                            const min = parseFloat(event.target.min);
                            const max = parseFloat(event.target.max);
                            const value = parseFloat(event.target.value);
                            const percent = ((value - min) / (max - min)) * 100;
                            event.target.style.setProperty('--fill-percent', `${percent}%`);
                        }
                    });
                });
                
                // Initial update for slider fill
                if (riskSlider) {
                    const min = parseFloat(riskSlider.min);
                    const max = parseFloat(riskSlider.max);
                    const value = parseFloat(riskSlider.value);
                    const percent = ((value - min) / (max - min)) * 100;
                    riskSlider.style.setProperty('--fill-percent', `${percent}%`);
                }

            } catch (error) {
                console.error("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ", error);
                showNotification(`–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ${error.message}`, 'error');
            }
        });

        function copyToClipboard(text) {
            const tempInput = document.createElement('textarea');
            tempInput.value = text;
            document.body.appendChild(tempInput);
            tempInput.select();
            try {
                document.execCommand('copy');
                showNotification(`–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ: ${text}`, 'success');
            } catch (err) {
                console.error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç: ', err);
                showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç.', 'error');
            } finally {
                document.body.removeChild(tempInput);
            }
        }

        function copyAllResults(subTabId) {
            let resultsText = '';
            let titles = [];
            let values = [];
            const currentSubTabContent = document.getElementById(subTabId);
            if (!currentSubTabContent) return;
            const resultCards = currentSubTabContent.querySelectorAll('.result-card');
            resultCards.forEach(card => {
                const titleElement = card.querySelector('.result-title');
                const valueElement = card.querySelector('.result-value');
                if (titleElement && valueElement && !valueElement.classList.contains('is-placeholder')) {
                    titles.push(titleElement.textContent.trim());
                    values.push(valueElement.textContent.trim());
                }
            });

            if (titles.length === 0) {
                showNotification('–ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è.', 'warning');
                return;
            }

            for (let i = 0; i < titles.length; i++) {
                resultsText += `${titles[i]}: ${values[i]}\n`;
            }

            copyToClipboard(resultsText.trim());

            const copyButton = currentSubTabContent.querySelector('.copy-all-button');
            if (copyButton) {
                const originalText = copyButton.textContent;
                copyButton.textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
                copyButton.classList.add('copied');
                setTimeout(() => {
                    copyButton.textContent = originalText;
                    copyButton.classList.remove('copied');
                }, 1500);
            }
        }

        function switchTab(tabId) {
            try {
                document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                    content.style.height = '0';
                    content.style.opacity = '0';
                    content.style.visibility = 'hidden';
                });

                const targetTab = document.querySelector(`.tab[onclick="switchTab('${tabId}')"]`);
                if (targetTab) {
                    targetTab.classList.add('active');
                }
                const targetContent = document.getElementById(tabId);
                if (targetContent) {
                    targetContent.classList.add('active');
                    targetContent.style.height = 'auto';
                    targetContent.style.opacity = '1';
                    targetContent.style.visibility = 'visible';
                }
                localStorage.setItem('activeTab', tabId);
                if (tabId === 'calculations') {
                    const initialSubTab = localStorage.getItem('activeSubTab-calculations') || 'risk-on-deal';
                    switchSubTab(initialSubTab);
                }
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫: ", error);
                showNotification(`–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫: ${error.message}`, 'error');
            }
        }

        function switchSubTab(subTabId) {
            try {
                document.querySelectorAll('#calculations .sub-tab').forEach(tab => tab.classList.remove('active'));
                document.querySelectorAll('#calculations .sub-tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                const targetSubTab = document.querySelector(`#calculations .sub-tab[onclick="switchSubTab('${subTabId}')"]`);
                if (targetSubTab) {
                    targetSubTab.classList.add('active');
                }
                const targetSubContent = document.getElementById(subTabId);
                if (targetSubContent) {
                    targetSubContent.classList.add('active');
                }
                localStorage.setItem('activeSubTab-calculations', subTabId);
                if (subTabId === 'risk-on-deal') {
                    calculateRiskOnDeal();
                } else if (subTabId === 'risk-reward-ratio') {
                    calculateRiskReward();
                } else if (subTabId === 'pnl-calculator') {
                    calculatePnL();
                }
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –ø–æ–¥–≤–∫–ª–∞–¥–æ–∫: ", error);
                showNotification(`–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –ø–æ–¥–≤–∫–ª–∞–¥–æ–∫: ${error.message}`, 'error');
            }
        }

        function validateInput(inputElement, messageElement, min, max = Infinity) {
            if (!inputElement || !messageElement) return true;
            const value = parseFloat(inputElement.value);
            let isValid = true;
            let message = '';
            if (inputElement.value.trim() === '') {
                message = '';
                isValid = true;
            } else if (isNaN(value)) {
                message = '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —á–∏—Å–ª–æ.';
                isValid = false;
            } else if (value < min) {
                message = `–ó–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ ${min}.`;
                isValid = false;
            } else if (value > max) {
                message = `–ó–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ –±–æ–ª–µ–µ ${max}.`;
                isValid = false;
            }
            if (isValid) {
                inputElement.classList.remove('invalid-input');
                messageElement.textContent = '';
            } else {
                inputElement.classList.add('invalid-input');
                messageElement.textContent = message;
            }
            return isValid;
        }

        function displayResult(element, value, unit = '', isPlaceholder = false, status = '') {
            if (!element) return;
            const resultCard = element.closest('.result-card');
            if (resultCard) {
                resultCard.classList.remove('calculating-animation', 'flash-bg');
                void resultCard.offsetWidth; 
                resultCard.classList.add('calculating-animation', 'flash-bg');
            }

            if (isPlaceholder) {
                element.textContent = placeholderMessage;
                element.classList.add('is-placeholder');
                element.classList.remove('high-risk');
                element.style.opacity = '0';
                element.style.transform = 'translateY(5px)';
                requestAnimationFrame(() => {
                    element.style.opacity = '0.7';
                    element.style.transform = 'translateY(0px)';
                });
            } else {
                element.classList.remove('is-placeholder');
                let formattedValue;
                if (typeof value === 'number') {
                    formattedValue = `${value > 0 && (element.id === 'pnlTotalPnL' || element.id === 'pnlRoi') ? '+' : ''}${value.toFixed(currentPrecision)}`;
                } else {
                    formattedValue = `${value}`;
                }

                let icon = '';
                if (element.id === 'pnlTotalPnL' || element.id === 'pnlRoi') {
                    if (typeof value === 'number') {
                        if (value > 0) icon = '‚¨ÜÔ∏è';
                        else if (value < 0) icon = '‚¨áÔ∏è';
                    }
                }
                
                if (element.id === 'pureMovement' || element.id === 'pnlPureMovement' ||
                    element.id === 'rrTPPoints' || element.id === 'rrSLPoints' ||
                    element.id === 'pnlPointsBetweenEntryExit' || element.id === 'rrRatio') {
                    element.classList.add('text-shadow-subtle');
                } else {
                    element.classList.remove('text-shadow-subtle');
                }

                if (element.id === 'riskAmount') {
                    const currentBalance = parseFloat(balanceInput?.value);
                    if (!isNaN(currentBalance) && currentBalance > 0 && typeof value === 'number') {
                        const riskPercentageDisplay = (value / currentBalance) * 100;
                        if (riskPercentageDisplay > 5) {
                            element.classList.add('high-risk');
                        } else {
                            element.classList.remove('high-risk');
                        }
                        formattedValue = `${value.toFixed(currentPrecision)}${currencySymbol} (${riskPercentageDisplay.toFixed(2)}%)`;
                    } else {
                        element.classList.remove('high-risk');
                        formattedValue = `${value.toFixed(currentPrecision)}${currencySymbol}`;
                    }
                } else if (element.id === 'margin' || element.id === 'positionSize' || element.id === 'pnlTotalPnL') {
                    formattedValue = `${value > 0 && (element.id === 'pnlTotalPnL') ? '+' : ''}${value.toFixed(currentPrecision)}${currencySymbol}`;
                } else if (element.id === 'pnlRoi' || element.id === 'pureMovement' || element.id === 'pnlPureMovement') {
                    formattedValue = `${value > 0 && (element.id === 'pnlRoi') ? '+' : ''}${value.toFixed(currentPrecision)}${unit}`;
                } else if (element.id === 'rrTPPoints' || element.id === 'rrSLPoints' || element.id === 'pnlPointsBetweenEntryExit') {
                     formattedValue = value.toFixed(currentPrecision);
                }
                element.style.color = 'var(--text)';
                if (status === 'positive') {
                    element.style.color = 'var(--profit-color)';
                } else if (status === 'negative') {
                    element.style.color = 'var(--warning-color)';
                }

                // 48. –ê–Ω–∏–º–∞—Ü–∏—è "–ø–æ–¥—Å—á–µ—Ç–∞" –∑–Ω–∞—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ - —Ç–æ–ª—å–∫–æ –¥–ª—è —á–∏—Å–µ–ª
                if (typeof value === 'number' && !element.classList.contains('is-placeholder') && !isNaN(parseFloat(element.textContent))) {
                    const currentNum = parseFloat(element.textContent.replace(/[^0-9.-]/g, ''));
                    animateNumber(element, currentNum, value, currentPrecision, icon, unit, status);
                } else {
                    if (element.textContent !== icon + formattedValue) {
                        element.style.opacity = '0';
                        element.style.transform = 'translateY(10px) scale(0.95)';
                        setTimeout(() => {
                            element.innerHTML = icon + formattedValue;
                            element.style.opacity = '1';
                            element.style.transform = 'translateY(0px) scale(1)';
                        }, 50);
                    } else if (element.style.opacity === '0') {
                        element.style.opacity = '1';
                        element.style.transform = 'translateY(0px) scale(1)';
                    }
                }
            }
        }
        // Helper for 48. –ê–Ω–∏–º–∞—Ü–∏—è "–ø–æ–¥—Å—á–µ—Ç–∞" –∑–Ω–∞—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        function animateNumber(element, start, end, precision, icon, unit, status) {
            const duration = 500; // milliseconds
            let startTime;

            function animate(currentTime) {
                if (!startTime) startTime = currentTime;
                const progress = (currentTime - startTime) / duration;

                const easedProgress = easeOutCubic(progress); // More natural easing

                const currentValue = start + (end - start) * easedProgress;

                let displayValue;
                if (element.id === 'riskAmount' || element.id === 'margin' || element.id === 'positionSize' || element.id === 'pnlTotalPnL') {
                    displayValue = `${currentValue > 0 && (element.id === 'pnlTotalPnL') ? '+' : ''}${currentValue.toFixed(precision)}${currencySymbol}`;
                } else if (element.id === 'pnlRoi' || element.id === 'pureMovement' || element.id === 'pnlPureMovement') {
                    displayValue = `${currentValue > 0 && (element.id === 'pnlRoi') ? '+' : ''}${currentValue.toFixed(precision)}${unit}`;
                } else {
                    displayValue = currentValue.toFixed(precision);
                }

                element.innerHTML = icon + displayValue;
                element.style.color = 'var(--text)';
                if (status === 'positive') {
                    element.style.color = 'var(--profit-color)';
                } else if (status === 'negative') {
                    element.style.color = 'var(--warning-color)';
                }

                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    // Ensure final value is exact
                    element.innerHTML = icon + (
                        (element.id === 'riskAmount' || element.id === 'margin' || element.id === 'positionSize' || element.id === 'pnlTotalPnL') ?
                        `${end > 0 && (element.id === 'pnlTotalPnL') ? '+' : ''}${end.toFixed(precision)}${currencySymbol}` :
                        ((element.id === 'pnlRoi' || element.id === 'pureMovement' || element.id === 'pnlPureMovement') ?
                        `${end > 0 && (element.id === 'pnlRoi') ? '+' : ''}${end.toFixed(precision)}${unit}` :
                        end.toFixed(precision))
                    );
                    element.style.color = 'var(--text)';
                    if (status === 'positive') {
                        element.style.color = 'var(--profit-color)';
                    } else if (status === 'negative') {
                        element.style.color = 'var(--warning-color)';
                    }
                }
            }
            // Easing function for smoother animation
            function easeOutCubic(t) {
                return (--t) * t * t + 1;
            }

            requestAnimationFrame(animate);
        }

        function calculateRiskOnDeal() {
            const balanceVal = parseFloat(balanceInput?.value);
            const leverageVal = parseFloat(leverageInput?.value) || 1;
            const riskPercentage = parseFloat(riskSlider?.value);
            const fixedLossVal = parseFloat(fixedLossInput?.value);
            const entryPointVal = parseFloat(entryPointInput?.value);
            const stopLossVal = parseFloat(stopLossInput?.value);

            let isValid = true;

            isValid = validateInput(balanceInput, document.getElementById('balance-validation'), 0.01) && isValid;
            isValid = validateInput(leverageInput, document.getElementById('leverage-validation'), 1) && isValid;
            isValid = validateInput(entryPointInput, document.getElementById('entryPoint-validation'), 0.01) && isValid;
            isValid = validateInput(stopLossInput, document.getElementById('stopLoss-validation'), 0.01) && isValid;
            
            if (isFixedLossModeForRiskOnDeal) {
                isValid = validateInput(fixedLossInput, fixedLossValidation, 0.01) && isValid;
                if (!isNaN(fixedLossVal) && !isNaN(balanceVal) && fixedLossVal > balanceVal) {
                    fixedLossValidation.textContent = '–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —É–±—ã—Ç–æ–∫ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ –±–∞–ª–∞–Ω—Å–∞.';
                    fixedLossInput.classList.add('invalid-input');
                    isValid = false;
                }
            }

            if (!isValid || isNaN(balanceVal) || isNaN(entryPointVal) || isNaN(stopLossVal)) {
                displayResult(riskAmountDisplay, '', '', true);
                displayResult(marginDisplay, '', '', true);
                displayResult(positionSizeDisplay, '', '', true);
                displayResult(pureMovementDisplay, '', '', true);
                return;
            }

            const riskPercentOfEntry = Math.abs((entryPointVal - stopLossVal) / entryPointVal);

            let actualRiskAmount = 0;
            if (isFixedLossModeForRiskOnDeal && !isNaN(fixedLossVal)) {
                actualRiskAmount = fixedLossVal;
            } else {
                actualRiskAmount = (balanceVal * riskPercentage) / 100;
            }

            if (riskPercentOfEntry === 0) {
                displayResult(riskAmountDisplay, actualRiskAmount, currencySymbol);
                displayResult(marginDisplay, 0, currencySymbol);
                displayResult(positionSizeDisplay, 0, currencySymbol);
                displayResult(pureMovementDisplay, 0, '%');
                return;
            }

            const calculatedPositionSize = actualRiskAmount / riskPercentOfEntry;
            const calculatedMargin = calculatedPositionSize / leverageVal;
            const calculatedPureMovement = riskPercentOfEntry * 100;

            displayResult(riskAmountDisplay, actualRiskAmount, currencySymbol);
            displayResult(marginDisplay, calculatedMargin, currencySymbol);
            displayResult(positionSizeDisplay, calculatedPositionSize, currencySymbol);
            displayResult(pureMovementDisplay, calculatedPureMovement, '%');
        }

        function calculateRiskReward() {
            if (!rrEntryPointInput || !rrStopLossInput || !rrTakeProfitInput ||
                !rrSLPointsDisplay || !rrTPPointsDisplay || !rrRatioDisplay) {
                return;
            }

            const isEntryPointValid = validateInput(rrEntryPointInput, document.getElementById('rrEntryPoint-validation'), 0.01);
            const isStopLossValid = validateInput(rrStopLossInput, document.getElementById('rrStopLoss-validation'), 0.01);
            const isTakeProfitValid = validateInput(rrTakeProfitInput, document.getElementById('rrTakeProfit-validation'), 0.01);

            const entryPoint = parseFloat(rrEntryPointInput.value);
            let stopLoss = parseFloat(rrStopLossInput.value);
            let takeProfit = parseFloat(rrTakeProfitInput.value);

            if (!isEntryPointValid || !isStopLossValid || !isTakeProfitValid ||
                isNaN(entryPoint) || isNaN(stopLoss) || isNaN(takeProfit)) {
                displayResult(rrTPPointsDisplay, '', '', true);
                displayResult(rrSLPointsDisplay, '', '', true);
                displayResult(rrRatioDisplay, '', '', true);
                return;
            }

            const slPoints = Math.abs(entryPoint - stopLoss);
            const tpPoints = Math.abs(entryPoint - takeProfit);

            displayResult(rrTPPointsDisplay, tpPoints);
            displayResult(rrSLPointsDisplay, slPoints);

            let ratioText = '0:0';
            if (slPoints > 0) {
                const ratio = tpPoints / slPoints;
                ratioText = `1:${ratio.toFixed(currentPrecision)}`;
                displayResult(rrRatioDisplay, ratioText);
            } else {
                showNotification('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—É–Ω–∫—Ç–æ–≤ –¥–æ —Å—Ç–æ–ø-–ª–æ—Å—Å–∞ —Ä–∞–≤–Ω–æ 0. –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Ä–∏—Å–∫–∞/–ø—Ä–∏–±—ã–ª–∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–æ.', 'warning');
                displayResult(rrRatioDisplay, '–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å (SL = TP)', '', true);
            }
        }

        function calculatePnL() {
            if (!pnlEntryPriceInput || !pnlExitPriceInput || !pnlPositionAmountInput || !pnlLeverageInput ||
                !pnlTotalPnLDisplay || !pnlRoiDisplay || !pnlPureMovementDisplay || !pnlPointsBetweenEntryExitDisplay) {
                return;
            }

            const isEntryPriceValid = validateInput(pnlEntryPriceInput, document.getElementById('pnlEntryPrice-validation'), 0.01);
            const isExitPriceValid = validateInput(pnlExitPriceInput, document.getElementById('pnlExitPrice-validation'), 0.01);
            const isPositionAmountValid = pnlPositionAmountInput.value.trim() === '' || validateInput(pnlPositionAmountInput, document.getElementById('pnlPositionAmount-validation'), 0.01);
            const isLeverageValid = pnlLeverageInput.value.trim() === '' || validateInput(pnlLeverageInput, document.getElementById('pnlLeverage-validation'), 1);

            const entryPrice = parseFloat(pnlEntryPriceInput.value);
            let exitPrice = parseFloat(pnlExitPriceInput.value);
            const positionAmount = parseFloat(pnlPositionAmountInput.value);
            let leverage = parseFloat(pnlLeverageInput.value);
            const tradeType = currentPnLTradeType;

            if (isNaN(leverage) || leverage < 1) {
                leverage = 1;
            }

            if (!isEntryPriceValid || !isExitPriceValid) {
                displayResult(pnlTotalPnLDisplay, '', '', true);
                displayResult(pnlRoiDisplay, '', '', true);
                displayResult(pnlPureMovementDisplay, '', '', true);
                displayResult(pnlPointsBetweenEntryExitDisplay, '', '', true);
                return;
            }

            let pureMovement;
            if (tradeType === 'long') {
                pureMovement = ((exitPrice - entryPrice) / entryPrice) * 100;
            } else {
                pureMovement = ((entryPrice - exitPrice) / entryPrice) * 100;
            }
            
            const pnlPoints = Math.abs(exitPrice - entryPrice);

            let totalPnL = 0;
            let roi = 0;

            if (!isNaN(positionAmount) && isPositionAmountValid) {
                if (tradeType === 'long') {
                    totalPnL = (exitPrice - entryPrice) * (positionAmount / entryPrice);
                } else {
                    totalPnL = (entryPrice - exitPrice) * (positionAmount / entryPrice);
                }
                
                const margin = positionAmount / leverage;
                if (margin > 0) {
                    roi = (totalPnL / margin) * 100;
                } else {
                    roi = 0;
                }
            } else {
                if (pnlPositionAmountInput.value.trim() !== '' && !isPositionAmountValid) {
                    displayResult(pnlTotalPnLDisplay, '', '', true);
                    displayResult(pnlRoiDisplay, '', '', true);
                    displayResult(pnlPureMovementDisplay, '', '', true);
                    displayResult(pnlPointsBetweenEntryExitDisplay, '', '', true);
                    return;
                }
                totalPnL = 0;
                roi = pureMovement * leverage;
            }
            
            displayResult(pnlTotalPnLDisplay, totalPnL, '', false, totalPnL > 0 ? 'positive' : (totalPnL < 0 ? 'negative' : ''));
            displayResult(pnlRoiDisplay, roi, '%', false, roi > 0 ? 'positive' : (roi < 0 ? 'negative' : ''));
            displayResult(pnlPureMovementDisplay, pureMovement, '%');
            displayResult(pnlPointsBetweenEntryExitDisplay, pnlPoints);
        }

        function resetRiskOnDealCalculator(showNotif = true) {
            if (balanceInput) balanceInput.value = '';
            if (leverageInput) leverageInput.value = '';
            if (entryPointInput) entryPointInput.value = '';
            if (stopLossInput) stopLossInput.value = '';
            if (riskSlider) riskSlider.value = 3;
            if (riskValue) riskValue.textContent = '3.0%';
            if (fixedLossInput) fixedLossInput.value = '';

            localStorage.removeItem('isFixedLossModeForRiskOnDeal');

            if (document.getElementById('balance-validation')) document.getElementById('balance-validation').textContent = '';
            if (document.getElementById('leverage-validation')) document.getElementById('leverage-validation').textContent = '';
            if (document.getElementById('entryPoint-validation')) document.getElementById('entryPoint-validation').textContent = '';
            if (document.getElementById('stopLoss-validation')) document.getElementById('stopLoss-validation').textContent = '';
            if (fixedLossValidation) fixedLossValidation.textContent = '';

            if (balanceInput) balanceInput.classList.remove('invalid-input');
            if (leverageInput) leverageInput.classList.remove('invalid-input');
            if (entryPointInput) entryPointInput.classList.remove('invalid-input');
            if (stopLossInput) stopLossInput.classList.remove('invalid-input');
            if (fixedLossInput) fixedLossInput.classList.remove('invalid-input');

            isFixedLossModeForRiskOnDeal = false;
            updateRiskAmountUIMode();
            calculateRiskOnDeal();
            if (showNotif) {
                showNotification('–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä "–†–∏—Å–∫ –Ω–∞ —Å–¥–µ–ª–∫—É" —Å–±—Ä–æ—à–µ–Ω.', 'info');
            }
        }

        function resetRiskRewardCalculator(showNotif = true) {
            if (rrEntryPointInput) rrEntryPointInput.value = '';
            if (rrStopLossInput) rrStopLossInput.value = '';
            if (rrTakeProfitInput) rrTakeProfitInput.value = '';
            
            if (document.getElementById('rrEntryPoint-validation')) document.getElementById('rrEntryPoint-validation').textContent = '';
            if (document.getElementById('rrStopLoss-validation')) document.getElementById('rrStopLoss-validation').textContent = '';
            if (document.getElementById('rrTakeProfit-validation')) document.getElementById('rrTakeProfit-validation').textContent = '';

            if (rrEntryPointInput) rrEntryPointInput.classList.remove('invalid-input');
            if (rrStopLossInput) rrStopLossInput.classList.remove('invalid-input');
            if (rrTakeProfitInput) rrTakeProfitInput.classList.remove('invalid-input');

            calculateRiskReward();
            if (showNotif) {
                showNotification('–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è —Ä–∏—Å–∫–∞/–ø—Ä–∏–±—ã–ª–∏ —Å–±—Ä–æ—à–µ–Ω.', 'info');
            }
        }

        function resetPnLCalculator(showNotif = true) {
            if (pnlEntryPriceInput) pnlEntryPriceInput.value = '';
            if (pnlExitPriceInput) pnlExitPriceInput.value = '';
            if (pnlPositionAmountInput) pnlPositionAmountInput.value = '';
            if (pnlLeverageInput) pnlLeverageInput.value = '';
            currentPnLTradeType = 'long';

            localStorage.removeItem('currentPnLTradeType');

            if (document.getElementById('pnlEntryPrice-validation')) document.getElementById('pnlEntryPrice-validation').textContent = '';
            if (document.getElementById('pnlExitPrice-validation')) document.getElementById('pnlExitPrice-validation').textContent = '';
            if (document.getElementById('pnlPositionAmount-validation')) document.getElementById('pnlPositionAmount-validation').textContent = '';
            if (document.getElementById('pnlLeverage-validation')) document.getElementById('pnlLeverage-validation').textContent = '';

            if (pnlEntryPriceInput) pnlEntryPriceInput.classList.remove('invalid-input');
            if (pnlExitPriceInput) pnlExitPriceInput.classList.remove('invalid-input');
            if (pnlPositionAmountInput) pnlPositionAmountInput.classList.remove('invalid-input');
            if (pnlLeverageInput) pnlLeverageInput.classList.remove('invalid-input');

            updatePnLTradeTypeUI();
            calculatePnL();
            if (showNotif) {
                showNotification('–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø—Ä–∏–±—ã–ª–∏/—É–±—ã—Ç–∫–∞ —Å–±—Ä–æ—à–µ–Ω.', 'info');
            }
        }
    </script>
</body>
</html>
