<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculator_ByWeeloser</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3Eüìà%3C/text%3E%3C/svg%3E" type="image/svg+xml">

    <style>
        /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        :root {
            --primary: #3b82f6;
            --secondary: #60a5fa;
            --accent: #ec4899;
            --bg: #f9fafb;
            --card-bg: #ffffff;
            --text: #111827;
            --border-radius: 12px;
            --transition: all 0.3s ease;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --primary-rgb: 59, 130, 246;
            --accent-rgb: 236, 72, 153;
            --placeholder-text-color: #9ca3af;
            --warning-color: #ef4444;
            --button-bg: var(--primary);
            --button-text: white;
            --button-hover-bg: var(--accent);
            --button-active-shadow: inset 0 2px 5px rgba(0,0,0,0.2);

            --container-max-width: 1200px;
            --body-padding: 2rem;
            --tab-padding: 1rem 2rem;
            --input-padding: 0.85rem 1.1rem;
            --font-size-base: 1rem;
            --font-size-h2: 1.8rem;
            --font-size-result-title: 1.1rem;
            --font-size-result-value: 1.6rem;
            --gap-large: 2rem;
            --gap-medium: 1.5rem;
            --gap-small: 1rem;

            /* –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –Ω–æ–≤–æ–≥–æ –¥–∏–∑–∞–π–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ */
            --settings-card-border: 1px solid rgba(var(--primary-rgb), 0.1);
            --settings-item-bg: rgba(var(--primary-rgb), 0.05);
            --settings-item-hover-bg: rgba(var(--primary-rgb), 0.1);
            --settings-input-bg: var(--bg);
            --settings-input-border: 1px solid rgba(var(--text-rgb, 0,0,0), 0.1);
        }

        /* –¢–µ–º—ã */
        [data-theme="dark"] {
            --primary: #60a5fa;
            --secondary: #3b82f6;
            --accent: #f472b6;
            --bg: #1a1a2e; /* –ë–æ–ª–µ–µ –≥–ª—É–±–æ–∫–∏–π —Ç–µ–º–Ω—ã–π */
            --card-bg: #2a2a4a; /* –ë–æ–ª–µ–µ –≥–ª—É–±–æ–∫–∏–π —Ç–µ–º–Ω—ã–π */
            --text: #e0e0e0; /* –°–≤–µ—Ç–ª–µ–µ —Ç–µ–∫—Å—Ç */
            --shadow: 0 6px 20px rgba(0, 0, 0, 0.4); /* –ë–æ–ª–µ–µ –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–∞—è —Ç–µ–Ω—å */
            --primary-rgb: 96, 165, 250;
            --accent-rgb: 244, 114, 182;
            --placeholder-text-color: #888;
            --button-bg: #3c3c66; /* –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ü–≤–µ—Ç –∫–Ω–æ–ø–∫–∏ */
            --button-text: #fff;
            --button-hover-bg: var(--accent);

            --settings-card-border: 1px solid rgba(var(--primary-rgb), 0.3);
            --settings-item-bg: rgba(var(--primary-rgb), 0.15);
            --settings-item-hover-bg: rgba(var(--primary-rgb), 0.25);
            --settings-input-bg: #3a3a5a;
            --settings-input-border: 1px solid #555;
        }

        [data-theme="light"] {
            --primary: #3b82f6;
            --secondary: #60a5fa;
            --accent: #ec4899;
            --bg: #f9fafb;
            --card-bg: #ffffff;
            --text: #111827;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --primary-rgb: 59, 130, 246;
            --accent-rgb: 236, 72, 153;
            --placeholder-text-color: #9ca3af;
            --button-bg: #ffffff;
            --button-text: #111827;
            --button-hover-bg: var(--accent);

            --settings-card-border: 1px solid rgba(var(--primary-rgb), 0.1);
            --settings-item-bg: rgba(var(--primary-rgb), 0.05);
            --settings-item-hover-bg: rgba(var(--primary-rgb), 0.1);
            --settings-input-bg: var(--bg);
            --settings-input-border: 1px solid rgba(var(--text-rgb, 0,0,0), 0.1);
        }

        [data-theme="neon"] {
            --primary: #06b6d4;
            --secondary: #10b981;
            --accent: #facc15;
            --bg: #0c0a09;
            --card-bg: #1c1917;
            --text: #f8fafc;
            --shadow: 0 4px 12px rgba(6, 182, 212, 0.4);
            --primary-rgb: 6, 182, 212;
            --accent-rgb: 250, 204, 21;
            --placeholder-text-color: #a1a1aa;
            --button-bg: var(--primary);
            --button-text: #0c0a09;
            --button-hover-bg: var(--accent);

            --settings-card-border: 1px solid rgba(var(--primary-rgb), 0.3);
            --settings-item-bg: rgba(var(--primary-rgb), 0.15);
            --settings-item-hover-bg: rgba(var(--primary-rgb), 0.2);
            --settings-input-bg: #2d3748;
            --settings-input-border: 1px solid #4a5568;
        }
        
        [data-theme="emerald"] {
            --primary: #10b981;
            --secondary: #059669;
            --accent: #06b6d4;
            --bg: #0a0a0a;
            --card-bg: #121212;
            --text: #f4f4f5;
            --shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
            --primary-rgb: 16, 185, 129;
            --accent-rgb: 6, 182, 212;
            --placeholder-text-color: #a1a1aa;
            --button-bg: var(--primary);
            --button-text: white;
            --button-hover-bg: var(--accent);

            --settings-card-border: 1px solid rgba(var(--primary-rgb), 0.3);
            --settings-item-bg: rgba(var(--primary-rgb), 0.15);
            --settings-item-hover-bg: rgba(var(--primary-rgb), 0.2);
            --settings-input-bg: #2d3748;
            --settings-input-border: 1px solid #4a5568;
        }

        [data-theme="deep-blue"] {
            --primary: #4f46e5;
            --secondary: #6366f1;
            --accent: #e879f9;
            --bg: #0f172a;
            --card-bg: #1e293b;
            --text: #e2e8f0;
            --shadow: 0 4px 15px rgba(79, 70, 229, 0.4);
            --primary-rgb: 79, 70, 229;
            --accent-rgb: 232, 121, 249;
            --placeholder-text-color: #94a3b8;
            --button-bg: var(--primary);
            --button-text: white;
            --button-hover-bg: var(--accent);

            --settings-card-border: 1px solid rgba(var(--primary-rgb), 0.3);
            --settings-item-bg: rgba(var(--primary-rgb), 0.15);
            --settings-item-hover-bg: rgba(var(--primary-rgb), 0.2);
            --settings-input-bg: #2d3748;
            --settings-input-border: 1px solid #4a5568;
        }

        [data-theme="volcanic"] {
            --primary: #dc2626;
            --secondary: #ef4444;
            --accent: #f97316;
            --bg: #1a0a0a;
            --card-bg: #2a1a1a;
            --text: #fca5a5;
            --shadow: 0 4px 15px rgba(220, 38, 38, 0.4);
            --primary-rgb: 220, 38, 38;
            --accent-rgb: 249, 115, 22;
            --placeholder-text-color: #e5e5e5;
            --button-bg: var(--primary);
            --button-text: white;
            --button-hover-bg: var(--accent);

            --settings-card-border: 1px solid rgba(var(--primary-rgb), 0.3);
            --settings-item-bg: rgba(var(--primary-rgb), 0.15);
            --settings-item-hover-bg: rgba(var(--primary-rgb), 0.2);
            --settings-input-bg: #2d3748;
            --settings-input-border: 1px solid #4a5568;
        }

        [data-theme="synthwave"] {
            --primary: #f472b6;
            --secondary: #a78bfa;
            --accent: #06b6d4;
            --bg: #171717;
            --card-bg: #262626;
            --text: #fbcfe8;
            --shadow: 0 4px 15px rgba(244, 114, 182, 0.4);
            --primary-rgb: 244, 114, 182;
            --accent-rgb: 6, 182, 212;
            --placeholder-text-color: #a1a1aa;
            --button-bg: var(--primary);
            --button-text: white;
            --button-hover-bg: var(--accent);

            --settings-card-border: 1px solid rgba(var(--primary-rgb), 0.3);
            --settings-item-bg: rgba(var(--primary-rgb), 0.15);
            --settings-item-hover-bg: rgba(var(--primary-rgb), 0.2);
            --settings-input-bg: #2d3748;
            --settings-input-border: 1px solid #4a5568;
        }

        [data-theme="galaxy"] {
            --primary: #8b5cf6;
            --secondary: #a78bfa;
            --accent: #22d3ee;
            --bg: #0c0a09;
            --card-bg: #1c1917;
            --text: #e9d5ff;
            --shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
            --primary-rgb: 139, 92, 246;
            --accent-rgb: 34, 211, 238;
            --placeholder-text-color: #a1a1aa;
            --button-bg: var(--primary);
            --button-text: white;
            --button-hover-bg: var(--accent);

            --settings-card-border: 1px solid rgba(var(--primary-rgb), 0.3);
            --settings-item-bg: rgba(var(--primary-rgb), 0.15);
            --settings-item-hover-bg: rgba(var(--primary-rgb), 0.2);
            --settings-input-bg: #2d3748;
            --settings-input-border: 1px solid #4a5568;
        }

        /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ç–µ–ª–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
        body {
            background-color: var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding: var(--body-padding);
            transition: background-color 0.8s cubic-bezier(0.25, 0.1, 0.25, 1), color 0.8s cubic-bezier(0.25, 0.1, 0.25, 1);
            line-height: 1.6;
            position: relative;
            overflow-x: hidden;
            overflow-y: auto;
            font-size: var(--font-size-base);
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω–æ–≥–æ —Ñ–æ–Ω–∞ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(var(--primary-rgb), 0.05), var(--bg) 25%, var(--card-bg) 75%, rgba(var(--accent-rgb, var(--primary-rgb)), 0.05));
            background-size: 350% 350%;
            animation: gradientFlowAnimation 25s ease-in-out infinite alternate;
            z-index: -1;
            opacity: 0.6;
        }

        @keyframes gradientFlowAnimation {
            0% { background-position: 0% 50%; transform: rotate(-2deg) scale(1.6); }
            100% { background-position: 100% 50%; transform: rotate(2deg) scale(1.6); }
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è */
        .container {
            max-width: var(--container-max-width);
            margin: 0 auto;
            padding: 0 1rem;
            position: relative;
            z-index: 1;
            opacity: 0;
            transform: translateY(20px);
            animation: containerFadeIn 0.8s ease-out 0.2s forwards;
        }
        @keyframes containerFadeIn {
            to { opacity: 1; transform: translateY(0); }
        }

        /* –ê–≤—Ç–æ—Ä—Å–∫–∞—è –ø–æ–¥–ø–∏—Å—å */
        .author {
            text-align: center;
            margin-bottom: var(--gap-large);
            font-size: 0.9rem;
            opacity: 0;
            animation: fadeInAuthor 1.5s ease-out 0.7s forwards;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        @keyframes fadeInAuthor {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 0.8; transform: translateY(0); }
        }

        .author a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 700;
            transition: color 0.3s ease, text-shadow 0.3s ease;
        }

        .author a:hover {
            text-decoration: underline;
            color: var(--accent);
            text-shadow: 0 0 8px var(--accent);
        }

        /* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º */
        .theme-switcher {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-top: var(--gap-small);
            justify-content: center;
            animation: popInButtons 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) 1s backwards;
        }

        @keyframes popInButtons {
            from { transform: scale(0.5) rotate(-15deg); opacity: 0; }
            to { transform: scale(1) rotate(0deg); opacity: 1; }
        }

        .theme-button {
            width: 38px;
            height: 38px;
            border: 2px solid transparent;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275), border-color 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .theme-button::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.7);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1) translate(-50%, -50%);
            transform-origin: 50% 50%;
        }
        .theme-button:active::after {
            animation: themeButtonClickRipple 0.5s ease-out;
        }
        @keyframes themeButtonClickRipple {
            0% { transform: scale(0) translate(-50%, -50%); opacity: 1; }
            100% { transform: scale(10) translate(-50%, -50%); opacity: 0; }
        }

        .theme-button:hover {
            transform: scale(1.2) rotate(10deg);
            border-color: var(--accent);
            box-shadow: 0 0 12px var(--accent), 0 4px 8px rgba(0,0,0,0.2);
        }

        .theme-button.active-theme {
            border-color: var(--accent);
            box-shadow: 0 0 10px var(--accent), 0 0 20px var(--primary), inset 0 0 5px rgba(0,0,0,0.2);
            transform: scale(1.15) rotate(5deg);
        }

        .theme-light { background: #ffffff; border: 2px solid #000000; }
        .theme-dark { background: #000000; border: 2px solid #ffffff; }
        .theme-neon { background: #06b6d4; border: 2px solid #000000; }
        .theme-emerald { background: #10b981; border: 2px solid #000000; }
        .theme-deep-blue { background: #4f46e5; border: 2px solid #000000; }
        .theme-volcanic { background: #dc2626; border: 2px solid #000000; }
        .theme-synthwave { background: #f472b6; border: 2px solid #000000; }
        .theme-galaxy { background: #8b5cf6; border: 2px solid #000000; }


        /* –í–∫–ª–∞–¥–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
        .tabs {
            display: flex;
            margin-bottom: var(--gap-large);
            border-radius: var(--border-radius);
            overflow: visible;
            background: var(--card-bg);
            padding: 0.5rem;
            box-shadow: var(--shadow);
            flex-wrap: wrap;
            justify-content: center;
            animation: slideDownTabs 0.7s cubic-bezier(0.23, 1, 0.32, 1) 0.5s backwards;
        }

        @keyframes slideDownTabs {
            from { transform: translateY(-40px) scale(0.95); opacity: 0; }
            to { transform: translateY(0) scale(1); opacity: 1; }
        }

        .tab {
            flex: 1;
            padding: var(--tab-padding);
            text-align: center;
            cursor: pointer;
            font-weight: 700;
            border-radius: calc(var(--border-radius) - 4px);
            transition: background-color 0.3s ease, color 0.3s ease, transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.3s ease;
            min-width: 150px;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        .tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(var(--primary-rgb), 0.15);
            opacity: 0;
            transition: opacity 0.3s ease, transform 0.4s cubic-bezier(0.19, 1, 0.22, 1);
            transform: scale(0.7) rotateY(20deg);
            z-index: -1;
            border-radius: inherit;
        }

        .tab:hover:not(.active)::before {
            opacity: 1;
            transform: scale(1) rotateY(0deg);
        }
        .tab:hover:not(.active) {
            transform: translateY(-4px) scale(1.02);
            color: var(--primary);
        }

        .tab.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 6px 12px rgba(var(--primary-rgb), 0.4), 0 0 20px rgba(var(--accent-rgb, var(--primary-rgb)), 0.25);
            position: relative;
            overflow: hidden;
            transform: translateY(-3px) scale(1.03);
            z-index: 2;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            top: 0;
            left: -150%;
            width: 60%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.7), transparent);
            animation: shimmer 2.8s infinite ease-in-out;
            filter: blur(6px);
        }

        @keyframes shimmer {
            0% { left: -150%; }
            40% { left: 150%; }
            100% { left: 150%; }
        }

        .tab-content {
            display: none;
            background: var(--card-bg);
            padding: var(--gap-large);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            animation: tabContentAppear 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
            transform-origin: top center;
        }

        @keyframes tabContentAppear {
            from { transform: translateY(20px) scaleY(0.95) rotateX(-10deg); opacity: 0; }
            to { transform: translateY(0) scaleY(1) rotateX(0deg); opacity: 1; }
        }

        .tab-content.active {
            display: block;
        }

        /* –ü–æ–¥–≤–∫–ª–∞–¥–∫–∏ */
        .sub-tabs {
            display: flex;
            margin-bottom: var(--gap-medium);
            border-radius: var(--border-radius);
            background: var(--bg);
            padding: 0.3rem;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
            overflow: hidden;
            flex-wrap: wrap;
            justify-content: center;
        }

        .sub-tab {
            flex: 1;
            padding: 0.7rem 1rem;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            border-radius: calc(var(--border-radius) - 6px);
            transition: background-color 0.3s ease, color 0.3s ease;
            min-width: 120px;
        }

        .sub-tab.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 2px 5px rgba(var(--primary-rgb), 0.2);
        }

        .sub-tab-content {
            display: none;
        }

        .sub-tab-content.active {
            display: block;
        }

        /* –°—Ç–∏–ª–∏ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ */
        .calculator {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--gap-large);
        }

        .input-section {
            display: grid;
            gap: var(--gap-medium);
        }

        .input-group {
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            animation: inputGroupAppear 0.6s cubic-bezier(0.215, 0.610, 0.355, 1) backwards;
        }

        .input-section .input-group:nth-child(1) { animation-delay: 0.1s; }
        .input-section .input-group:nth-child(2) { animation-delay: 0.2s; }
        .input-section .input-group:nth-child(3) { animation-delay: 0.3s; }
        .input-section .input-group:nth-child(4) { animation-delay: 0.4s; }
        .input-section .input-group:nth-child(5) { animation-delay: 0.5s; }

        @keyframes inputGroupAppear {
            from { opacity: 0; transform: translateX(-25px) skewX(-10deg); }
            to { opacity: 1; transform: translateX(0) skewX(0deg); }
        }

        .input-group::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0%;
            height: 3px;
            background: linear-gradient(to right, var(--primary), var(--accent));
            transition: width 0.5s cubic-bezier(0.23, 1, 0.32, 1), left 0.5s cubic-bezier(0.23, 1, 0.32, 1);
            border-radius: 2px;
        }

        .input-group:focus-within::before {
            width: 100%;
            left: 0;
        }

        .input-group label {
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text);
            transform: translateX(-10px);
            opacity: 0;
            animation: labelSlideIn 0.5s ease-out 0.2s forwards;
        }
        @keyframes labelSlideIn {
            to { transform: translateX(0); opacity: 1;}
        }

        .input-group input {
            padding: var(--input-padding);
            border: 1px solid rgba(var(--text-rgb, 0,0,0), 0.2);
            border-radius: var(--border-radius);
            font-size: var(--font-size-base);
            transition: border-color 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease, transform 0.2s ease;
            background-color: var(--bg);
            color: var(--text);
        }

        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.5), 0 0 12px rgba(var(--accent-rgb, var(--primary-rgb)), 0.3);
            background-color: var(--card-bg);
            transform: scale(1.01);
        }

        .slider-container {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
             animation: inputGroupAppear 0.6s cubic-bezier(0.215, 0.610, 0.355, 1) backwards;
             animation-delay: 0.4s;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            color: var(--text);
        }

        .slider {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 12px;
            border-radius: 6px;
            background: linear-gradient(to right, var(--primary) 0%, var(--secondary) 50%, var(--accent) 100%);
            outline: none;
            transition: background 0.4s ease, box-shadow 0.4s ease;
            cursor: pointer;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
        }

        .slider:hover {
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.2), 0 0 10px rgba(var(--primary-rgb), 0.6);
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 26px;
            height: 26px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            transition: transform 0.25s cubic-bezier(0.175, 0.885, 0.32, 1.275), box-shadow 0.25s ease;
            box-shadow: 0 3px 7px rgba(var(--accent-rgb, 236, 72, 153), 0.5), 0 1px 3px rgba(0,0,0,0.3);
            border: 3px solid var(--accent);
        }

        .slider::-moz-range-thumb {
            width: 26px;
            height: 26px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 3px 7px rgba(var(--accent-rgb, 236, 72, 153), 0.5), 0 1px 3px rgba(0,0,0,0.3);
            border: 3px solid var(--accent);
        }

        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.25) rotate(10deg);
            box-shadow: 0 5px 10px rgba(var(--accent-rgb, 236, 72, 153), 0.7), 0 0 15px var(--accent);
        }
         .slider::-moz-range-thumb:hover {
            transform: scale(1.25) rotate(10deg);
            box-shadow: 0 5px 10px rgba(var(--accent-rgb, 236, 72, 153), 0.7), 0 0 15px var(--accent);
        }

        .results {
            margin-top: var(--gap-large);
             animation: resultsAppear 0.7s cubic-bezier(0.165, 0.84, 0.44, 1) 0.6s backwards;
        }

        @keyframes resultsAppear {
            from { opacity: 0; transform: scale(0.9) perspective(500px) rotateX(-20deg); }
            to { transform: scale(1) perspective(500px) rotateX(0deg); }
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--gap-medium);
        }

        .result-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: var(--gap-medium);
            box-shadow: var(--shadow);
            border-left: 6px solid var(--primary);
            animation: fadeInUpResultCard 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) backwards;
            position: relative;
            overflow: hidden;
            transition: transform 0.35s cubic-bezier(0.075, 0.82, 0.165, 1), box-shadow 0.35s cubic-bezier(0.075, 0.82, 0.165, 1);
            cursor: pointer;
        }

        .result-grid .result-card:nth-child(1) { animation-delay: 0.7s; }
        .result-grid .result-card:nth-child(2) { animation-delay: 0.8s; }
        .result-grid .result-card:nth-child(3) { animation-delay: 0.9s; }
        .result-grid .result-card:nth-child(4) { animation-delay: 1.0s; }
        .result-grid .result-card:nth-child(5) { animation-delay: 1.1s; }

        @keyframes fadeInUpResultCard {
            from { transform: translateY(25px) scale(0.95) skewY(3deg); opacity: 0; }
            to { transform: translateY(0) scale(1) skewY(0deg); opacity: 1; }
        }

        .result-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -120%;
            width: 60%;
            height: 100%;
            background: linear-gradient(to right, transparent 0%, rgba(255,255,255,0.15) 50%, transparent 100%);
            transition: left 0.8s cubic-bezier(0.23, 1, 0.32, 1);
            transform: skewX(-20deg);
        }

        .result-card:hover::before {
             left: 120%;
        }

        .result-card:hover {
            transform: translateY(-12px) rotateX(7deg) scale(1.04) skewY(-1deg);
            box-shadow: 0 18px 30px rgba(var(--primary-rgb), 0.25), 0 8px 15px rgba(0,0,0,0.15);
        }

        .result-title {
            font-size: var(--font-size-result-title);
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.5rem;
            opacity: 0;
            transform: translateY(-10px);
            animation: resultTextAppear 0.5s ease-out 0.2s forwards;
        }

        .result-value {
            font-size: var(--font-size-result-value);
            font-weight: 700;
            color: var(--text);
            word-break: break-all;
            display: inline-block;
            transition: opacity 0.25s ease-out, transform 0.25s ease-out, color 0.3s ease;
            opacity: 0;
            transform: translateY(10px);
            animation: resultTextAppear 0.5s ease-out 0.3s forwards;
        }
         @keyframes resultTextAppear {
            to { opacity: 1; transform: translateY(0); }
        }

        .result-value.is-placeholder {
            font-size: 0.9rem;
            font-weight: 400;
            color: var(--placeholder-text-color);
            opacity: 0;
            animation: placeholderFadeIn 0.5s ease-out forwards;
        }
        @keyframes placeholderFadeIn {
            to { opacity: 0.7; }
        }

        .result-value.high-risk {
            color: var(--warning-color);
            font-weight: 700;
            animation: pulseRed 1s infinite alternate;
        }

        @keyframes pulseRed {
            from { color: var(--warning-color); text-shadow: 0 0 5px rgba(255,0,0,0.3); }
            to { color: #cc3333; text-shadow: 0 0 10px rgba(255,0,0,0.7); }
        }

        /* –§—É—Ç–µ—Ä */
        .footer {
            margin-top: 3rem;
            text-align: center;
            font-size: 0.9rem;
            opacity: 0;
            animation: fadeInAuthor 1s ease-out 2s forwards;
        }

        .footer a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 700;
            transition: color 0.3s ease, text-shadow 0.3s ease;
        }

        .footer a:hover {
            text-decoration: underline;
            color: var(--accent);
            text-shadow: 0 0 8px var(--accent);
        }

        /* –ù–û–í–´–ô –î–ò–ó–ê–ô–ù –ù–ê–°–¢–†–û–ï–ö */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            padding: 1rem;
            border-radius: var(--border-radius);
            background: var(--card-bg);
            box-shadow: var(--shadow);
        }

        .settings-section-card {
            background: rgba(var(--primary-rgb), 0.03); /* Lighter background for sections */
            border: var(--settings-card-border);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .settings-section-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            border-top-left-radius: inherit;
            border-top-right-radius: inherit;
        }

        .settings-section-card:hover {
            box-shadow: var(--shadow), 0 0 15px rgba(var(--primary-rgb), 0.2);
            transform: translateY(-5px);
        }

        .settings-section-card h3 {
            font-size: 1.4rem;
            color: var(--primary);
            margin-bottom: 1.5rem;
            border-bottom: 1px solid rgba(var(--primary-rgb), 0.3);
            padding-bottom: 0.75rem;
            position: relative;
        }
        .settings-section-card h3::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: -1px;
            width: 50px;
            height: 2px;
            background: var(--accent);
            transition: width 0.3s ease;
        }
        .settings-section-card:hover h3::after {
            width: 100%;
        }


        .settings-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            background: var(--settings-item-bg);
            border-radius: var(--border-radius);
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
            cursor: pointer;
            border: 1px solid rgba(var(--primary-rgb), 0.1);
        }

        .setting-item:hover {
            background-color: var(--settings-item-hover-bg);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .setting-item label {
            font-weight: 600;
            color: var(--text);
            flex-grow: 1;
            margin-right: 1rem;
            cursor: inherit;
        }

        .input-group.settings-input {
            margin-top: 0.5rem;
            margin-bottom: 1rem;
            position: relative;
        }

        .input-group.settings-input input {
            width: 100%;
            background-color: var(--settings-input-bg);
            border: var(--settings-input-border);
            padding: 0.75rem;
            border-radius: var(--border-radius);
            color: var(--text);
            font-size: 1rem;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .input-group.settings-input input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.3);
        }

        .settings-dropdown select {
            width: 100%;
            padding: 0.75rem;
            border-radius: var(--border-radius);
            border: var(--settings-input-border);
            background-color: var(--settings-input-bg);
            color: var(--text);
            font-size: 1rem;
            appearance: none;
            cursor: pointer;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='currentColor'%3E%3Cpath fill-rule='evenodd' d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z' clip-rule='evenodd' /%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1.5rem;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .settings-dropdown select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.3);
        }


        /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ */
        .switch {
            position: relative;
            display: inline-block;
            width: 54px; /* –ù–µ–º–Ω–æ–≥–æ —à–∏—Ä–µ */
            height: 30px; /* –ù–µ–º–Ω–æ–≥–æ –≤—ã—à–µ */
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider-switch {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #a0aec0; /* –°–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π, –∫–æ–≥–¥–∞ –≤—ã–∫–ª—é—á–µ–Ω */
            transition: background-color 0.4s ease-in-out, box-shadow 0.4s ease-in-out;
            border-radius: 34px;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.2); /* –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ç–µ–Ω—å */
            border: 2px solid transparent; /* –î–æ–±–∞–≤–∏–º –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è */
        }

        .slider-switch:before {
            position: absolute;
            content: "";
            height: 22px; /* –ß—É—Ç—å –±–æ–ª—å—à–µ */
            width: 22px; /* –ß—É—Ç—å –±–æ–ª—å—à–µ */
            left: 4px; /* –û—Ç—Å—Ç—É–ø */
            bottom: 4px; /* –û—Ç—Å—Ç—É–ø */
            background-color: white;
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55), background-color 0.3s ease; /* –î–æ–±–∞–≤–ª–µ–Ω ease-in-out */
            border-radius: 50%;
            box-shadow: 0 3px 6px rgba(0,0,0,0.3); /* –ë–æ–ª–µ–µ –≤—ã—Ä–∞–∂–µ–Ω–Ω–∞—è —Ç–µ–Ω—å */
        }

        input:checked + .slider-switch {
            background-color: var(--primary);
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.2), 0 0 12px rgba(var(--primary-rgb), 0.6); /* –í–Ω–µ—à–Ω—è—è —Ç–µ–Ω—å */
            border-color: var(--accent); /* –¶–≤–µ—Ç–Ω–∞—è –æ–±–≤–æ–¥–∫–∞ */
        }

        input:checked + .slider-switch:before {
            transform: translateX(24px); /* –ë–æ–ª—å—à–µ —Å–º–µ—â–µ–Ω–∏–µ */
            background-color: var(--accent); /* –¶–≤–µ—Ç –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è */
        }

        /* –ö–Ω–æ–ø–∫–∞ —Å–±—Ä–æ—Å–∞ */
        .reset-button {
            background-color: #f44336;
            color: white;
            border: none;
            padding: 0.75rem 1.2rem;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 10px rgba(244, 67, 54, 0.3);
            margin-top: var(--gap-medium);
            width: fit-content;
            align-self: flex-end;
            display: block;
        }

        .reset-button:hover {
            background-color: #d32f2f;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(244, 67, 54, 0.4);
        }

        .reset-button:active {
            transform: translateY(0);
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.2);
        }

        /* –°–æ–æ–±—â–µ–Ω–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ */
        .validation-message {
            color: var(--warning-color);
            font-size: 0.85rem;
            margin-top: 0.25rem;
            min-height: 1rem;
            opacity: 0;
            transition: opacity 0.3s ease-out;
        }

        .validation-message:not(:empty) {
            opacity: 1;
        }

        .input-group input.invalid-input {
            border-color: var(--warning-color);
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.5);
        }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification-container {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .notification {
            background-color: var(--card-bg);
            color: var(--text);
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
            opacity: 0;
            transform: translateX(120%) scale(0.9);
            animation: slideInNotification 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards,
                       fadeOutNotification 0.7s cubic-bezier(0.55, 0.085, 0.68, 0.53) forwards 3.5s;
            border-left: 5px solid var(--primary);
            max-width: 320px;
            word-break: break-word;
            font-size: 0.95rem;
        }

        @keyframes slideInNotification {
            to { opacity: 1; transform: translateX(0) scale(1); }
        }

        @keyframes fadeOutNotification {
            from { opacity: 1; transform: translateX(0) scale(1); }
            to { opacity: 0; transform: translateX(120%) scale(0.9); }
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è —Å–ª–∞–π–¥–µ—Ä–∞ */
        .slider-container .slider::-webkit-slider-thumb:active {
            animation: thumbPop 0.3s ease-in-out;
        }

         .slider-container .slider::-moz-range-thumb:active {
            animation: thumbPop 0.3s ease-in-out;
        }

        @keyframes thumbPop {
            0%, 100% { transform: scale(1.2); }
            50% { transform: scale(1.1); }
        }

        /* –î–∏—Å–∫–ª–µ–π–º–µ—Ä */
        .disclaimer-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }

        .disclaimer-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .disclaimer-modal {
            background-color: var(--card-bg);
            color: var(--text);
            padding: 2.5rem;
            border-radius: var(--border-radius);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            text-align: center;
            transform: scale(0.8) translateY(20px);
            opacity: 0;
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.5s ease;
        }

        .disclaimer-overlay.show .disclaimer-modal {
            transform: scale(1) translateY(0);
            opacity: 1;
        }

        .disclaimer-modal h2 {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 1.5rem;
            text-shadow: 1px 1px 3px rgba(var(--primary-rgb), 0.2);
        }

        .disclaimer-modal p {
            font-size: 1.1rem;
            line-height: 1.8;
            margin-bottom: 2rem;
        }

        .disclaimer-modal button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 0.8rem 2rem;
            border-radius: var(--border-radius);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 10px rgba(var(--primary-rgb), 0.3);
        }

        .disclaimer-modal button:hover {
            background-color: var(--accent);
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 6px 15px rgba(var(--accent-rgb), 0.4);
        }

        .disclaimer-modal button:active {
            transform: translateY(0) scale(0.98);
            box-shadow: 0 2px 5px rgba(var(--primary-rgb), 0.2);
        }

        /* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .custom-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 4000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .custom-modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .custom-modal {
            background-color: var(--card-bg);
            color: var(--text);
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            max-width: 400px;
            width: 90%;
            text-align: center;
            transform: scale(0.9) translateY(-20px);
            opacity: 0;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.3s ease;
        }

        .custom-modal-overlay.show .custom-modal {
            transform: scale(1) translateY(0);
            opacity: 1;
        }

        .custom-modal h3 {
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .custom-modal p {
            font-size: 1rem;
            margin-bottom: 1.5rem;
        }

        .custom-modal input[type="text"] {
            width: calc(100% - 20px);
            padding: 0.75rem 1rem;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(var(--text-rgb, 0,0,0), 0.2);
            border-radius: var(--border-radius);
            font-size: 1rem;
            background-color: var(--bg);
            color: var(--text);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .custom-modal input[type="text"]:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.3);
        }

        .custom-modal-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
        }

        .custom-modal-buttons button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 0.6rem 1.5rem;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 3px 8px rgba(var(--primary-rgb), 0.3);
        }

        .custom-modal-buttons button:hover {
            background-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 5px 12px rgba(var(--accent-rgb), 0.4);
        }

        .custom-modal-buttons button:active {
            transform: translateY(0);
            box-shadow: var(--button-active-shadow);
        }

        .custom-modal-buttons button.cancel-button {
            background-color: #6c757d;
        }
        .custom-modal-buttons button.cancel-button:hover {
            background-color: #495057;
        }

        /* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ —Ä–µ–∂–∏–º–æ–≤ */
        .function-toggle-button-container {
            display: flex;
            align-items: center;
            background-color: var(--primary);
            color: white;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            margin-bottom: var(--gap-small);
            cursor: pointer;
        }

        .function-toggle-button-container:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .function-toggle-button {
            flex-grow: 1;
            padding: 0.75rem 1rem;
            border: none;
            background: none;
            color: inherit;
            font-size: 1rem;
            font-weight: 600;
            text-align: left;
            cursor: pointer;
            border-radius: var(--border-radius);
            transition: background-color 0.2s ease;
        }

        .function-toggle-button:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .function-toggle-button:focus {
            outline: none;
        }

        /* –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç—Ä–µ–ª–∫–∏ –∏ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–π */
        .function-toggle-button-container:not(.has-dropdown) .function-dropdown-toggle,
        .function-selector:not(.has-dropdown) {
            display: none !important;
        }


        .function-dropdown-toggle {
            padding: 0.75rem 1rem;
            border: none;
            background: none;
            color: inherit;
            cursor: pointer;
            border-left: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
            transition: background-color 0.2s ease;
        }

        .function-dropdown-toggle:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .function-dropdown-toggle svg {
            transition: transform 0.3s ease-in-out;
        }

        .function-dropdown-toggle.rotated svg {
            transform: rotate(180deg);
        }

        .function-selector {
            position: absolute;
            background-color: var(--card-bg);
            border: 1px solid rgba(var(--text-rgb, 0,0,0), 0.1);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            z-index: 100;
            width: calc(100% - 2rem); /* Adjusted for padding */
            margin-top: 0.5rem;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: opacity 0.3s ease, transform 0.3s ease, visibility 0.3s ease;
        }

        .function-selector.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .function-selector button {
            display: block;
            width: 100%;
            padding: 0.75rem 1rem;
            text-align: left;
            background: none;
            border: none;
            color: var(--text);
            cursor: pointer;
            transition: background-color 0.2s ease, color 0.2s ease;
        }

        .function-selector button:hover {
            background-color: rgba(var(--primary-rgb), 0.1);
            color: var(--primary);
        }

        .function-selector button:first-child {
            border-top-left-radius: inherit;
            border-top-right-radius: inherit;
        }
        .function-selector button:last-child {
            border-bottom-left-radius: inherit;
            border-bottom-right-radius: inherit;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
        @media (max-width: 768px) {
            body {
                padding: 0.5rem;
            }
            .container {
                 padding: 0.5rem;
            }

            .calculator {
                grid-template-columns: 1fr;
            }

            .result-grid {
                grid-template-columns: 1fr;
            }

            .settings-grid {
                grid-template-columns: 1fr;
                padding: 0.75rem;
            }

            .tabs {
                padding: 0.25rem;
                flex-direction: column;
                align-items: stretch;
            }

            .tab {
                min-width: unset;
                flex-basis: auto;
                margin-bottom: 0.25rem;
            }
            .tabs .tab:last-child {
                margin-bottom: 0;
            }

             .theme-switcher {
                position: static;
                bottom: auto;
                right: auto;
                padding: 0;
                gap: 0.5rem;
                box-shadow: none;
                background: none;
                justify-content: center;
             }

             .theme-button {
                 width: 30px;
                 height: 30px;
             }

             .sub-tabs {
                 padding: 0.2rem;
                 flex-wrap: wrap;
                 justify-content: center;
             }
             .sub-tab {
                 min-width: unset;
                 flex-basis: calc(50% - 0.2rem);
                 margin-bottom: 0.2rem;
             }
             .sub-tabs .sub-tab:last-child:nth-child(odd) {
                flex-basis: 100%;
             }

             .input-group, .slider-container, .function-toggle-button-container {
                 margin-left: 0;
                 margin-right: 0;
                 padding-left: 0;
                 padding-right: 0;
             }

             .function-selector {
                 width: calc(100% - 1rem);
                 left: 0.5rem;
             }

            .reset-button {
                width: 100%;
            }

            .author, .footer {
                padding: 0 0.5rem;
            }

            .settings-section-card {
                padding: 1rem;
            }
            .settings-section-card h3 {
                font-size: 1.2rem;
                margin-bottom: 1rem;
                padding-bottom: 0.5rem;
            }
            .setting-item {
                padding: 0.5rem 0.75rem;
            }
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--card-bg);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 5px;
            border: 2px solid var(--card-bg);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--secondary), var(--accent));
        }

        /* –§–æ–∫—É—Å –¥–ª—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ */
        :focus-visible {
            outline: 3px solid rgba(var(--primary-rgb), 0.7);
            outline-offset: 3px;
            border-radius: var(--border-radius);
        }
    </style>
</head>
<body>
    <div class="notification-container"></div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–∏—Å–∫–ª–µ–π–º–µ—Ä–∞ -->
    <div class="disclaimer-overlay" id="disclaimerOverlay">
        <div class="disclaimer-modal">
            <h2>–í–∞–∂–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</h2>
            <p>–ê–≤—Ç–æ—Ä –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –Ω–µ –Ω–µ—Å–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ —Ä–∞—Å—á–µ—Ç—ã, –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ä–∏—Å–∫–∏ –∏ –ª—é–±—ã–µ —É–±—ã—Ç–∫–∏, –≤–æ–∑–Ω–∏–∫—à–∏–µ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞. –í—Å–µ —Ä–∞—Å—á–µ—Ç—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –≤ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ü–µ–ª—è—Ö. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –Ω–∞ —Å–≤–æ–π —Å—Ç—Ä–∞—Ö –∏ —Ä–∏—Å–∫.</p>
            <button id="disclaimerAcceptButton">–û–ö</button>
        </div>
    </div>

    <!-- –û–±—â–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ (–¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è/–≤–≤–æ–¥–∞) - –æ—Å—Ç–∞–≤–ª–µ–Ω—ã –¥–ª—è –±—É–¥—É—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è, –µ—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è -->
    <div class="custom-modal-overlay" id="confirmModalOverlay">
        <div class="custom-modal">
            <h3 id="confirmModalTitle">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h3>
            <p id="confirmModalMessage"></p>
            <div class="custom-modal-buttons">
                <button id="confirmModalOkButton">–û–ö</button>
                <button id="confirmModalCancelButton" class="cancel-button">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <div class="custom-modal-overlay" id="promptModalOverlay">
        <div class="custom-modal">
            <h3 id="promptModalTitle">–í–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ</h3>
            <p id="promptModalMessage"></p>
            <input type="text" id="promptModalInput">
            <div class="custom-modal-buttons">
                <button id="promptModalOkButton">–û–ö</button>
                <button id="promptModalCancelButton" class="cancel-button">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <div class="container">
        <div class="author">
            <p>¬© <a href="https://t.me/weeloser " target="_blank">@weeloser</a></p>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
        <div class="tabs">
            <div class="tab active" onclick="switchTab('calculations')">–†–∞—Å—á–µ—Ç—ã</div>
            <div class="tab" onclick="switchTab('settings')">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
        </div>

        <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∫–ª–∞–¥–∫–∏ "–†–∞—Å—á–µ—Ç—ã" -->
        <div id="calculations" class="tab-content active">
            <h2>–†–∞—Å—á–µ—Ç—ã</h2>
            <div class="sub-tabs">
                <div class="sub-tab active" onclick="switchSubTab('risk-on-deal')">–†–∏—Å–∫ –Ω–∞ —Å–¥–µ–ª–∫—É</div>
                <div class="sub-tab" onclick="switchSubTab('risk-reward-ratio')">R/R</div>
                <div class="sub-tab" onclick="switchSubTab('pnl-calculator')">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø—Ä–∏–±—ã–ª–∏/—É–±—ã—Ç–∫–∞</div>
            </div>

            <!-- –ü–æ–¥–≤–∫–ª–∞–¥–∫–∞ "–†–∏—Å–∫ –Ω–∞ —Å–¥–µ–ª–∫—É" -->
            <div id="risk-on-deal" class="sub-tab-content active">
                <div class="calculator">
                    <div class="input-section">
                        <div class="input-group">
                            <label for="balance">–ë–∞–ª–∞–Ω—Å (USDT)</label>
                            <input type="number" id="balance" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –±–∞–ª–∞–Ω—Å" min="0.01">
                            <div class="validation-message" id="balance-validation"></div>
                        </div>

                        <div class="input-group">
                            <label for="leverage">–ü–ª–µ—á–æ</label>
                            <input type="number" id="leverage" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫—Ä–µ–¥–∏—Ç–Ω–æ–µ –ø–ª–µ—á–æ" min="1">
                            <div class="validation-message" id="leverage-validation"></div>
                        </div>

                        <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–µ–∂–∏–º–∞ ENTRY/SL –∏ ROI -->
                        <div class="function-toggle-button-container" id="entrySlRoiToggleContainer">
                            <button id="mainButtonTextPart" class="function-toggle-button">ENTRY/SL üîÑ</button>
                        </div>

                        <div id="twhStopFields">
                            <div class="input-group">
                                <label for="entryPoint">–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞</label>
                                <input type="number" id="entryPoint" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–æ—á–∫—É –≤—Ö–æ–¥–∞" min="0.01">
                                <div class="validation-message" id="entryPoint-validation"></div>
                            </div>

                            <div class="input-group">
                                <label for="stopLoss">–¶–µ–Ω–∞ —Å—Ç–æ–ø-–ª–æ—Å—Å–∞</label>
                                <input type="number" id="stopLoss" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É —Å—Ç–æ–ø-–ª–æ—Å—Å–∞" min="0.01">
                                <div class="validation-message" id="stopLoss-validation"></div>
                            </div>
                        </div>

                        <div id="roiField" style="display: none;">
                            <div class="input-group">
                                <label for="roi">ROI –º–µ–∂–¥—É SL –∏ ENTRY (%)</label>
                                <input type="number" id="roi" placeholder="–í–≤–µ–¥–∏—Ç–µ ROI" min="0.01">
                                <div class="validation-message" id="roi-validation"></div>
                            </div>
                        </div>

                        <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–µ–∂–∏–º–∞ % —Ä–∏—Å–∫–∞ –Ω–∞ —Å–¥–µ–ª–∫—É / –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —É–±—ã—Ç–æ–∫ -->
                        <div class="function-toggle-button-container" id="riskAmountToggleContainer">
                            <button id="riskToggleButton" class="function-toggle-button">% —Ä–∏—Å–∫–∞ –Ω–∞ —Å–¥–µ–ª–∫—É üîÑ</button>
                        </div>

                        <div id="riskPercentageSlider" class="slider-container">
                            <div class="slider-label">
                                <span>–ü—Ä–æ—Ü–µ–Ω—Ç —Ä–∏—Å–∫–∞</span>
                                <div id="riskValue">3.0%</div>
                            </div>
                            <input type="range" min="0.5" max="10" step="0.1" value="3" class="slider" id="riskSlider">
                            <div id="riskWarning" class="validation-message"></div>
                        </div>

                        <div id="fixedLossInput" style="display: none;">
                            <div class="input-group">
                                <label for="fixedLoss">–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —É–±—ã—Ç–æ–∫ (USDT)</label>
                                <input type="number" id="fixedLoss" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É —É–±—ã—Ç–∫–∞" min="0.01">
                                <div class="validation-message" id="fixedLoss-validation"></div>
                            </div>
                        </div>

                        <button class="reset-button" onclick="resetRiskOnDealCalculator()">–°–±—Ä–æ—Å</button>
                    </div>

                    <div class="results">
                        <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</h3>
                        <div class="result-grid">
                            <div class="result-card transition-hover">
                                <div class="result-title">–ú–∞—Ä–∂–∞</div>
                                <div class="result-value" id="margin">0.00 USDT</div>
                            </div>

                            <div class="result-card transition-hover">
                                <div class="result-title">–†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏</div>
                                <div class="result-value" id="positionSize">0.00 USDT</div>
                            </div>

                            <div class="result-card transition-hover">
                                <div class="result-title">–†–∏—Å–∫ –Ω–∞ —Å–¥–µ–ª–∫—É</div>
                                <div class="result-value" id="riskAmount">0.00 USDT</div>
                            </div>

                            <div class="result-card transition-hover">
                                <div class="result-title">–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ</div>
                                <div class="result-value" id="pureMovement">0.00%</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ü–æ–¥–≤–∫–ª–∞–¥–∫–∞ "–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è —Ä–∏—Å–∫–∞/–ø—Ä–∏–±—ã–ª–∏" -->
            <div id="risk-reward-ratio" class="sub-tab-content">
                <h2>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è —Ä–∏—Å–∫–∞/–ø—Ä–∏–±—ã–ª–∏</h2>
                <div class="calculator">
                    <div class="input-section">
                        <div class="input-group">
                            <label for="rrEntryPoint">–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞</label>
                            <input type="number" id="rrEntryPoint" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–æ—á–∫—É –≤—Ö–æ–¥–∞" min="0.01">
                            <div class="validation-message" id="rrEntryPoint-validation"></div>
                        </div>

                        <div class="input-group">
                            <label for="rrStopLoss">–¶–µ–Ω–∞ —Å—Ç–æ–ø-–ª–æ—Å—Å–∞</label>
                            <input type="number" id="rrStopLoss" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É —Å—Ç–æ–ø-–ª–æ—Å—Å–∞" min="0.01">
                            <div class="validation-message" id="rrStopLoss-validation"></div>
                        </div>

                        <div class="input-group">
                            <label for="rrTakeProfit">–¶–µ–Ω–∞ —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç–∞</label>
                            <input type="number" id="rrTakeProfit" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç–∞" min="0.01">
                            <div class="validation-message" id="rrTakeProfit-validation"></div>
                        </div>
                        <button class="reset-button" onclick="resetRiskRewardCalculator()">–°–±—Ä–æ—Å</button>
                    </div>

                    <div class="results">
                        <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</h3>
                        <div class="result-grid">
                            <div class="result-card transition-hover">
                                <div class="result-title">–ö–æ–ª-–≤–æ –ø—É–Ω–∫—Ç–æ–≤ –¥–æ —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç–∞</div>
                                <div class="result-value" id="rrTPPoints">0.00</div>
                            </div>

                            <div class="result-card transition-hover">
                                <div class="result-title">–ö–æ–ª-–≤–æ –ø—É–Ω–∫—Ç–æ–≤ –¥–æ —Å—Ç–æ–ø-–ª–æ—Å—Å–∞</div>
                                <div class="result-value" id="rrSLPoints">0.00</div>
                            </div>

                            <div class="result-card transition-hover">
                                <div class="result-title">–°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Ä–∏—Å–∫–∞ –∏ –ø—Ä–∏–±—ã–ª–∏</div>
                                <div class="result-value" id="rrRatio">0:0</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ü–æ–¥–≤–∫–ª–∞–¥–∫–∞ "–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø—Ä–∏–±—ã–ª–∏/—É–±—ã—Ç–∫–∞" -->
            <div id="pnl-calculator" class="sub-tab-content">
                <h2>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø—Ä–∏–±—ã–ª–∏/—É–±—ã—Ç–∫–∞</h2>
                <div class="calculator">
                    <div class="input-section">
                        <div class="input-group">
                            <label for="pnlEntryPrice">–¶–µ–Ω–∞ –≤—Ö–æ–¥–∞</label>
                            <input type="number" id="pnlEntryPrice" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É –≤—Ö–æ–¥–∞" min="0.01">
                            <div class="validation-message" id="pnlEntryPrice-validation"></div>
                        </div>

                        <div class="input-group">
                            <label for="pnlExitPrice">–¶–µ–Ω–∞ –≤—ã—Ö–æ–¥–∞</label>
                            <input type="number" id="pnlExitPrice" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É –≤—ã—Ö–æ–¥–∞" min="0.01">
                            <div class="validation-message" id="pnlExitPrice-validation"></div>
                        </div>

                        <div class="input-group">
                            <label for="pnlPositionAmount">–°—É–º–º–∞ –ø–æ–∑–∏—Ü–∏–∏ (USDT)</label>
                            <input type="number" id="pnlPositionAmount" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –ø–æ–∑–∏—Ü–∏–∏" min="0.01">
                            <div class="validation-message" id="pnlPositionAmount-validation"></div>
                        </div>

                        <div class="input-group">
                            <label for="pnlLeverage">–ü–ª–µ—á–æ</label>
                            <input type="number" id="pnlLeverage" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–ª–µ—á–æ" min="1">
                            <div class="validation-message" id="pnlLeverage-validation"></div>
                        </div>

                        <button class="reset-button" onclick="resetPnLCalculator()">–°–±—Ä–æ—Å</button>
                    </div>

                    <div class="results">
                        <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</h3>
                        <div class="result-grid">
                            <div class="result-card transition-hover">
                                <div class="result-title">–û–±—â–∞—è –ø—Ä–∏–±—ã–ª—å/—É–±—ã—Ç–æ–∫</div>
                                <div class="result-value" id="pnlTotalPnL">0.00 USDT</div>
                            </div>

                            <div class="result-card transition-hover">
                                <div class="result-title">ROI (%)</div>
                                <div class="result-value" id="pnlRoi">0.00%</div>
                            </div>

                            <div class="result-card transition-hover">
                                <div class="result-title">–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –≤ %</div>
                                <div class="result-value" id="pnlPureMovement">0.00%</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∫–ª–∞–¥–∫–∏ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏" -->
        <div id="settings" class="tab-content">
            <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
            <div class="settings-grid">
                <!-- –°–µ–∫—Ü–∏—è "–ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é" -->
                <div class="settings-section-card">
                    <h3>–ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</h3>
                    <div class="settings-list">
                        <div class="setting-item">
                            <label for="defaultBalanceToggle">–ë–∞–ª–∞–Ω—Å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</label>
                            <label class="switch">
                                <input type="checkbox" id="defaultBalanceToggle">
                                <span class="slider-switch"></span>
                            </label>
                        </div>
                        <div class="input-group settings-input">
                            <input type="number" id="defaultBalance" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é" min="0.01">
                            <div class="validation-message" id="defaultBalance-validation"></div>
                        </div>

                        <div class="setting-item">
                            <label for="defaultLeverageToggle">–ü–ª–µ—á–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</label>
                            <label class="switch">
                                <input type="checkbox" id="defaultLeverageToggle">
                                <span class="slider-switch"></span>
                            </label>
                        </div>
                        <div class="input-group settings-input">
                            <input type="number" id="defaultLeverage" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é" min="1">
                            <div class="validation-message" id="defaultLeverage-validation"></div>
                        </div>

                        <div class="setting-item">
                            <label for="defaultRiskToggle">–†–∏—Å–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</label>
                            <label class="switch">
                                <input type="checkbox" id="defaultRiskToggle">
                                <span class="slider-switch"></span>
                            </label>
                        </div>
                        <div class="input-group settings-input">
                            <input type="number" id="defaultRisk" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é" min="0.5" max="100" step="0.1">
                            <div class="validation-message" id="defaultRisk-validation"></div>
                        </div>
                    </div>
                </div>

                <!-- –°–µ–∫—Ü–∏—è "–¢–µ–º—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è" -->
                <div class="settings-section-card">
                    <h3>–¢–µ–º—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</h3>
                    <p>–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–Ω—É –∏–∑ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ç–µ–º.</p>
                    <div class="theme-switcher" id="settingsThemeSwitcher"></div>
                </div>

                <!-- –°–µ–∫—Ü–∏—è "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π" -->
                <div class="settings-section-card">
                    <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</h3>
                    <div class="settings-list">
                        <div class="setting-item">
                            <label for="notificationToggle">–í–∫–ª—é—á–∏—Ç—å –≤—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</label>
                            <label class="switch">
                                <input type="checkbox" id="notificationToggle">
                                <span class="slider-switch"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <label for="themeChangeNotificationToggle">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–º–µ–Ω–µ —Ç–µ–º—ã</label>
                            <label class="switch">
                                <input type="checkbox" id="themeChangeNotificationToggle">
                                <span class="slider-switch"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <label for="defaultSettingsNotificationToggle">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–º–µ–Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</label>
                            <label class="switch">
                                <input type="checkbox" id="defaultSettingsNotificationToggle">
                                <span class="slider-switch"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –§—É—Ç–µ—Ä -->
    <div class="footer">
        <p>¬© <a href="https://t.me/weeloser " target="_blank">@weeloser</a></p>
    </div>

    <script>
        // –û–±—ä—è–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö DOM-—ç–ª–µ–º–µ–Ω—Ç–æ–≤
        let balanceInput, leverageInput, roiInput, riskSlider, riskValue, riskWarning;
        let marginDisplay, positionSizeDisplay, riskAmountDisplay, pureMovementDisplay;

        let entryPointInput, stopLossInput;
        let fixedLossInput, fixedLossValidation;

        let rrEntryPointInput, rrStopLossInput, rrTakeProfitInput;
        let rrSLPointsDisplay, rrTPPointsDisplay, rrRatioDisplay;

        let pnlEntryPriceInput, pnlExitPriceInput, pnlPositionAmountInput, pnlLeverageInput;
        let pnlTotalPnLDisplay, pnlRoiDisplay, pnlPureMovementDisplay;

        // –°–æ–æ–±—â–µ–Ω–∏—è –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        const placeholderMessage = "–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞";
        let notificationsEnabled = true;
        let notificationsEnabledForThemeChange = true;
        let notificationsEnabledForDefaultSettings = true;

        let isROIModeForRiskOnDeal = false;
        let isFixedLossModeForRiskOnDeal = false;
        const currentPrecision = 2; // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Ç–æ—á–Ω–æ—Å—Ç–∏

        /**
         * –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É.
         * @param {string} message - –¢–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.
         * @param {string} type - –¢–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º).
         */
        function showNotification(message, type = 'global') {
            if (!notificationsEnabled) return;
            if (type === 'theme' && !notificationsEnabledForThemeChange) return;
            if (type === 'defaultSettings' && !notificationsEnabledForDefaultSettings) return;

            const container = document.querySelector('.notification-container');
            if (!container) return;
            const notification = document.createElement('div');
            notification.classList.add('notification');
            notification.textContent = message;

            container.appendChild(notification);

            requestAnimationFrame(() => {
                notification.style.opacity = '1';
                notification.style.transform = 'translateX(0) scale(1)';
            });

            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(120%) scale(0.9)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 700);
            }, 3500);
        }

        const defaultTypeLabels = {
            'balance': '–ë–∞–ª–∞–Ω—Å',
            'leverage': '–ü–ª–µ—á–æ',
            'risk': '–†–∏—Å–∫'
        };

        /**
         * –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω—É—é —Ç–µ–º—É –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è.
         * @param {string} themeName - –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã.
         */
        function setTheme(themeName) {
            document.body.setAttribute('data-theme', themeName);
            localStorage.setItem('theme', themeName);
            showNotification(`–¢–µ–º–∞ –∏–∑–º–µ–Ω–µ–Ω–∞ –Ω–∞ "${getThemeLabel(themeName)}"`, 'theme');
            updateThemeButtonActiveState(themeName);
        }

        /**
         * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É–¥–æ–±–æ—á–∏—Ç–∞–µ–º–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã.
         * @param {string} themeName - –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã.
         * @returns {string} - –£–¥–æ–±–æ—á–∏—Ç–∞–µ–º–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã.
         */
        function getThemeLabel(themeName) {
             const theme = availableThemes.find(t => t.name === themeName);
             return theme ? theme.label : themeName;
        }

        const availableThemes = [
            { name: 'light', label: '–°–≤–µ—Ç–ª–∞—è –¢–µ–º–∞' },
            { name: 'dark', label: '–¢–µ–º–Ω–∞—è –¢–µ–º–∞' },
            { name: 'neon', label: '–ù–µ–æ–Ω–æ–≤–∞—è –í—Å–ø—ã—à–∫–∞' },
            { name: 'emerald', label: '–ò–∑—É–º—Ä—É–¥–Ω—ã–π –ë—Ä–∏–∑' },
            { name: 'deep-blue', label: '–ì–ª—É–±–∏–Ω–∞ –û–∫–µ–∞–Ω–∞' },
            { name: 'volcanic', label: '–í—É–ª–∫–∞–Ω–∏—á–µ—Å–∫–∞—è –õ–∞–≤–∞' },
            { name: 'synthwave', label: '–°–∏–Ω—Ç–≤–µ–π–≤ –†–µ—Ç—Ä–æ' },
            { name: 'galaxy', label: '–ì–∞–ª–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –ù–æ—á—å' },
        ];

        /**
         * –°–æ–∑–¥–∞–µ—Ç –∫–Ω–æ–ø–∫–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ç–µ–º –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è.
         */
        function createThemeButtons() {
            const container = document.getElementById('settingsThemeSwitcher');
            if (!container) return;
            container.innerHTML = '';

            availableThemes.forEach(theme => {
                const button = document.createElement('button');
                button.className = `theme-button theme-${theme.name}`;
                button.title = theme.label;
                button.setAttribute('aria-label', `–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–º—É ${theme.label}`);
                button.onclick = () => setTheme(theme.name);
                container.appendChild(button);
            });
        }

        /**
         * –û–±–Ω–æ–≤–ª—è–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ —Ç–µ–º.
         * @param {string} activeThemeName - –ù–∞–∑–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π —Ç–µ–º—ã.
         */
        function updateThemeButtonActiveState(activeThemeName) {
             document.querySelectorAll('.theme-button').forEach(button => {
                 button.classList.remove('active-theme');
                 if (button.classList.contains(`theme-${activeThemeName}`)) {
                     button.classList.add('active-theme');
                 }
             });
        }

        /**
         * –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.
         * @param {string} type - –¢–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π ('global', 'theme', 'defaultSettings').
         * @param {boolean} enabled - –í–∫–ª—é—á–∏—Ç—å –∏–ª–∏ –≤—ã–∫–ª—é—á–∏—Ç—å.
         */
        function toggleNotifications(type, enabled) {
            if (type === 'global') {
                notificationsEnabled = enabled;
                localStorage.setItem('notificationsEnabled', enabled);
                if (!enabled) {
                    notificationsEnabledForThemeChange = false;
                    notificationsEnabledForDefaultSettings = false;

                    const themeToggle = document.getElementById('themeChangeNotificationToggle');
                    const defaultToggle = document.getElementById('defaultSettingsNotificationToggle');

                    if(themeToggle) themeToggle.checked = false;
                    if(defaultToggle) defaultToggle.checked = false;

                    localStorage.setItem('notificationsEnabledForThemeChange', false);
                    localStorage.setItem('notificationsEnabledForDefaultSettings', false);
                }
            } else if (type === 'theme') {
                notificationsEnabledForThemeChange = enabled;
                localStorage.setItem('notificationsEnabledForThemeChange', enabled);
            } else if (type === 'defaultSettings') {
                notificationsEnabledForDefaultSettings = enabled;
                localStorage.setItem('notificationsEnabledForDefaultSettings', enabled);
            }
            showNotification(`–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è ${type === 'global' ? '–≥–ª–æ–±–∞–ª—å–Ω–æ' : (type === 'theme' ? '–æ —Å–º–µ–Ω–µ —Ç–µ–º—ã' : '–æ —Å–º–µ–Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é')} ${enabled ? '–≤–∫–ª—é—á–µ–Ω—ã' : '–≤—ã–∫–ª—é—á–µ–Ω—ã'}`, type);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
        document.addEventListener('DOMContentLoaded', () => {
            try {
                // –ü—Ä–∏–≤—è–∑–∫–∞ DOM-—ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º
                balanceInput = document.getElementById('balance');
                leverageInput = document.getElementById('leverage');
                roiInput = document.getElementById('roi');
                riskSlider = document.getElementById('riskSlider');
                riskValue = document.getElementById('riskValue');
                riskWarning = document.getElementById('riskWarning');
                marginDisplay = document.getElementById('margin');
                positionSizeDisplay = document.getElementById('positionSize');
                riskAmountDisplay = document.getElementById('riskAmount');
                pureMovementDisplay = document.getElementById('pureMovement');

                entryPointInput = document.getElementById('entryPoint');
                stopLossInput = document.getElementById('stopLoss');
                fixedLossInput = document.getElementById('fixedLoss');
                fixedLossValidation = document.getElementById('fixedLoss-validation');

                rrEntryPointInput = document.getElementById('rrEntryPoint');
                rrStopLossInput = document.getElementById('rrStopLoss');
                rrTakeProfitInput = document.getElementById('rrTakeProfit');
                rrSLPointsDisplay = document.getElementById('rrSLPoints');
                rrTPPointsDisplay = document.getElementById('rrTPPoints');
                rrRatioDisplay = document.getElementById('rrRatio');

                pnlEntryPriceInput = document.getElementById('pnlEntryPrice');
                pnlExitPriceInput = document.getElementById('pnlExitPrice');
                pnlPositionAmountInput = document.getElementById('pnlPositionAmount');
                pnlLeverageInput = document.getElementById('pnlLeverage');
                pnlTotalPnLDisplay = document.getElementById('pnlTotalPnL');
                pnlRoiDisplay = document.getElementById('pnlRoi');
                pnlPureMovementDisplay = document.getElementById('pnlPureMovement');

                createThemeButtons();

                // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                const savedTheme = localStorage.getItem('theme') || 'dark';
                if (availableThemes.some(t => t.name === savedTheme)) {
                    setTheme(savedTheme);
                } else {
                    setTheme('dark'); // Fallback to dark if saved theme is invalid
                }

                // –ó–∞–≥—Ä—É–∑–∫–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
                notificationsEnabled = localStorage.getItem('notificationsEnabled') === 'true' || true;
                notificationsEnabledForThemeChange = localStorage.getItem('notificationsEnabledForThemeChange') === 'true' || true;
                notificationsEnabledForDefaultSettings = localStorage.getItem('notificationsEnabledForDefaultSettings') === 'true' || true;

                // –ü—Ä–∏–≤—è–∑–∫–∞ —Å–ª—É—à–∞—Ç–µ–ª–µ–π –∫ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
                const notificationToggleInput = document.getElementById('notificationToggle');
                const themeChangeNotificationToggle = document.getElementById('themeChangeNotificationToggle');
                const defaultSettingsNotificationToggle = document.getElementById('defaultSettingsNotificationToggle');

                if (notificationToggleInput) {
                    notificationToggleInput.checked = notificationsEnabled;
                    notificationToggleInput.addEventListener('change', () => toggleNotifications('global', notificationToggleInput.checked));
                }
                if (themeChangeNotificationToggle) {
                    themeChangeNotificationToggle.checked = notificationsEnabledForThemeChange;
                    themeChangeNotificationToggle.addEventListener('change', () => toggleNotifications('theme', themeChangeNotificationToggle.checked));
                }
                if (defaultSettingsNotificationToggle) {
                    defaultSettingsNotificationToggle.checked = notificationsEnabledForDefaultSettings;
                    defaultSettingsNotificationToggle.addEventListener('change', () => toggleNotifications('defaultSettings', defaultSettingsNotificationToggle.checked));
                }

                // –ó–∞–≥—Ä—É–∑–∫–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                loadDefaults();
                updateCalculatorWithDefaults();

                // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞—á–∞–ª—å–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏ –∏ –ø–æ–¥–≤–∫–ª–∞–¥–∫–∏
                const initialTab = localStorage.getItem('activeTab') || 'calculations';
                switchTab(initialTab);
                const initialSubTab = localStorage.getItem('activeSubTab-calculations') || 'risk-on-deal';
                switchSubTab(initialSubTab);

                // –ü—Ä–∏–≤—è–∑–∫–∞ —Å–ª—É—à–∞—Ç–µ–ª–µ–π –∫ –ø–æ–ª—è–º –≤–≤–æ–¥–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                const defaultBalanceInput = document.getElementById('defaultBalance');
                const defaultLeverageInput = document.getElementById('defaultLeverage');
                const defaultRiskInput = document.getElementById('defaultRisk');

                if (defaultBalanceInput) {
                    defaultBalanceInput.addEventListener('input', () => {
                        saveDefault('balance');
                        validateInput(defaultBalanceInput, document.getElementById('defaultBalance-validation'), 0.01);
                    });
                }
                if (defaultLeverageInput) {
                    defaultLeverageInput.addEventListener('input', () => {
                        saveDefault('leverage');
                        validateInput(defaultLeverageInput, document.getElementById('defaultLeverage-validation'), 1);
                    });
                }
                if (defaultRiskInput) {
                    defaultRiskInput.addEventListener('input', () => {
                        saveDefault('risk');
                        validateInput(defaultRiskInput, document.getElementById('defaultRisk-validation'), 0.5, 100);
                    });
                }

                // –ü—Ä–∏–≤—è–∑–∫–∞ —Å–ª—É—à–∞—Ç–µ–ª–µ–π –∫ –ø–æ–ª—è–º –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ "–†–∏—Å–∫ –Ω–∞ —Å–¥–µ–ª–∫—É"
                if (balanceInput) balanceInput.addEventListener('input', calculateRiskOnDeal);
                if (leverageInput) leverageInput.addEventListener('input', calculateRiskOnDeal);
                if (roiInput) roiInput.addEventListener('input', calculateRiskOnDeal);
                if (riskSlider) riskSlider.addEventListener('input', () => {
                    const riskVal = parseFloat(riskSlider.value);
                    if (riskValue) riskValue.textContent = `${riskVal.toFixed(1)}%`;
                    calculateRiskOnDeal();
                });
                if (entryPointInput) entryPointInput.addEventListener('input', calculateRiskOnDeal);
                if (stopLossInput) stopLossInput.addEventListener('input', calculateRiskOnDeal);
                if (fixedLossInput) fixedLossInput.addEventListener('input', calculateRiskOnDeal);

                // –ü—Ä–∏–≤—è–∑–∫–∞ —Å–ª—É—à–∞—Ç–µ–ª–µ–π –∫ –ø–æ–ª—è–º –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ "R/R"
                if (rrEntryPointInput) rrEntryPointInput.addEventListener('input', calculateRiskReward);
                if (rrStopLossInput) rrStopLossInput.addEventListener('input', calculateRiskReward);
                if (rrTakeProfitInput) rrTakeProfitInput.addEventListener('input', calculateRiskReward);

                // –ü—Ä–∏–≤—è–∑–∫–∞ —Å–ª—É—à–∞—Ç–µ–ª–µ–π –∫ –ø–æ–ª—è–º –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ "–ü—Ä–∏–±—ã–ª–∏/—É–±—ã—Ç–∫–∞"
                if (pnlEntryPriceInput) pnlEntryPriceInput.addEventListener('input', calculatePnL);
                if (pnlExitPriceInput) pnlExitPriceInput.addEventListener('input', calculatePnL);
                if (pnlPositionAmountInput) pnlPositionAmountInput.addEventListener('input', calculatePnL);
                if (pnlLeverageInput) pnlLeverageInput.addEventListener('input', calculatePnL);

                // –ü—Ä–∏–≤—è–∑–∫–∞ —Å–ª—É—à–∞—Ç–µ–ª–µ–π –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                document.querySelectorAll('.result-card').forEach(card => {
                    card.addEventListener('click', (event) => {
                        const valueElement = card.querySelector('.result-value');
                        if (valueElement && !valueElement.classList.contains('is-placeholder')) {
                            const textToCopy = valueElement.textContent.trim();
                            copyToClipboard(textToCopy);
                        }
                    });
                });

                // –õ–æ–≥–∏–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∏—Å–∫–ª–µ–π–º–µ—Ä–∞ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑)
                const disclaimerOverlay = document.getElementById('disclaimerOverlay');
                const disclaimerAcceptButton = document.getElementById('disclaimerAcceptButton');
                const disclaimerShownBefore = localStorage.getItem('disclaimerShown');
                if (!disclaimerShownBefore && disclaimerOverlay && disclaimerAcceptButton) {
                    disclaimerOverlay.classList.add('show');
                    disclaimerAcceptButton.addEventListener('click', () => {
                        disclaimerOverlay.classList.remove('show');
                        localStorage.setItem('disclaimerShown', 'true');
                    });
                } else if (disclaimerOverlay) {
                    disclaimerOverlay.classList.remove('show');
                }

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–Ω—ã—Ö —Å–æ–∫—Ä–∞—â–µ–Ω–∏–π
                document.addEventListener('keydown', (event) => {
                    if (event.ctrlKey) {
                        if (event.key === '1') {
                            event.preventDefault();
                            switchTab('calculations');
                        } else if (event.key === '2') {
                            event.preventDefault();
                            switchTab('settings');
                        }
                    }
                });

                // –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è ENTRY/SL –∏ ROI
                const entrySlRoiToggleContainer = document.getElementById('entrySlRoiToggleContainer');
                const mainButtonTextPart = document.getElementById('mainButtonTextPart');
                const twhStopFields = document.getElementById('twhStopFields');
                const roiFieldContainer = document.getElementById('roiField');

                if (entrySlRoiToggleContainer) {
                    entrySlRoiToggleContainer.addEventListener('click', () => {
                        isROIModeForRiskOnDeal = !isROIModeForRiskOnDeal;
                        updateRiskOnDealUIMode();
                        calculateRiskOnDeal();
                    });
                }

                function updateRiskOnDealUIMode() {
                    if (isROIModeForRiskOnDeal) {
                        mainButtonTextPart.textContent = 'ROI –º–µ–∂–¥—É SL –∏ ENTRY (%) üîÑ';
                        twhStopFields.style.display = 'none';
                        roiFieldContainer.style.display = 'block';
                    } else {
                        mainButtonTextPart.textContent = 'ENTRY/SL üîÑ';
                        roiFieldContainer.style.display = 'none';
                        twhStopFields.style.display = 'block';
                    }
                    entryPointInput.value = '';
                    stopLossInput.value = '';
                    roiInput.value = '';
                    document.getElementById('entryPoint-validation').textContent = '';
                    document.getElementById('stopLoss-validation').textContent = '';
                    document.getElementById('roi-validation').textContent = '';
                    entryPointInput.classList.remove('invalid-input');
                    stopLossInput.classList.remove('invalid-input');
                    roiInput.classList.remove('invalid-input');
                }

                // –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è % —Ä–∏—Å–∫–∞ –Ω–∞ —Å–¥–µ–ª–∫—É –∏ –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —É–±—ã—Ç–∫–∞
                const riskAmountToggleContainer = document.getElementById('riskAmountToggleContainer');
                const riskToggleButton = document.getElementById('riskToggleButton');
                const riskPercentageSliderContainer = document.getElementById('riskPercentageSlider');
                const fixedLossInputContainer = document.getElementById('fixedLossInput');

                if (riskAmountToggleContainer) {
                    riskAmountToggleContainer.addEventListener('click', () => {
                        isFixedLossModeForRiskOnDeal = !isFixedLossModeForRiskOnDeal;
                        updateRiskAmountUIMode();
                        calculateRiskOnDeal();
                    });
                }

                function updateRiskAmountUIMode() {
                    if (isFixedLossModeForRiskOnDeal) {
                        riskToggleButton.textContent = '–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —É–±—ã—Ç–æ–∫ üîÑ';
                        riskPercentageSliderContainer.style.display = 'none';
                        fixedLossInputContainer.style.display = 'block';
                    } else {
                        riskToggleButton.textContent = '% —Ä–∏—Å–∫–∞ –Ω–∞ —Å–¥–µ–ª–∫—É üîÑ';
                        fixedLossInputContainer.style.display = 'none';
                        riskPercentageSliderContainer.style.display = 'flex';
                    }
                    riskSlider.value = 3;
                    riskValue.textContent = '3.0%';
                    fixedLossInput.value = '';
                    fixedLossValidation.textContent = '';
                    fixedLossInput.classList.remove('invalid-input');
                }

                // –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI —Ä–µ–∂–∏–º–æ–≤
                updateRiskOnDealUIMode();
                updateRiskAmountUIMode();

            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ DOM:", error);
                showNotification(`–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ${error.message}`, 'error');
            }
        });

        /**
         * –ö–æ–ø–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞.
         * @param {string} text - –¢–µ–∫—Å—Ç –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è.
         */
        function copyToClipboard(text) {
            const tempInput = document.createElement('textarea');
            tempInput.value = text;
            document.body.appendChild(tempInput);
            tempInput.select();
            try {
                document.execCommand('copy');
                showNotification(`–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ: ${text}`);
            } catch (err) {
                console.error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç: ', err);
                showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç.');
            } finally {
                document.body.removeChild(tempInput);
            }
        }

        /**
         * –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É.
         * @param {string} tabId - ID –≤–∫–ª–∞–¥–∫–∏ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏.
         */
        function switchTab(tabId) {
            try {
                document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });

                const targetTab = document.querySelector(`.tab[onclick="switchTab('${tabId}')"]`);
                if (targetTab) {
                    targetTab.classList.add('active');
                }
                const targetContent = document.getElementById(tabId);
                if (targetContent) {
                    targetContent.classList.add('active');
                }
                localStorage.setItem('activeTab', tabId);

                if (tabId === 'calculations') {
                    const initialSubTab = localStorage.getItem('activeSubTab-calculations') || 'risk-on-deal';
                    switchSubTab(initialSubTab);
                }
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –≤ switchTab:", error);
                showNotification(`–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫: ${error.message}`, 'error');
            }
        }

        /**
         * –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω—É—é –ø–æ–¥–≤–∫–ª–∞–¥–∫—É.
         * @param {string} subTabId - ID –ø–æ–¥–≤–∫–ª–∞–¥–∫–∏ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏.
         */
        function switchSubTab(subTabId) {
            try {
                document.querySelectorAll('#calculations .sub-tab').forEach(tab => tab.classList.remove('active'));
                document.querySelectorAll('#calculations .sub-tab-content').forEach(content => {
                    content.classList.remove('active');
                });

                const targetSubTab = document.querySelector(`#calculations .sub-tab[onclick="switchSubTab('${subTabId}')"]`);
                if (targetSubTab) {
                    targetSubTab.classList.add('active');
                }
                const targetSubContent = document.getElementById(subTabId);
                if (targetSubContent) {
                    targetSubContent.classList.add('active');
                }
                localStorage.setItem('activeSubTab-calculations', subTabId);

                if (subTabId === 'risk-on-deal') {
                    calculateRiskOnDeal();
                } else if (subTabId === 'risk-reward-ratio') {
                    calculateRiskReward();
                } else if (subTabId === 'pnl-calculator') {
                    calculatePnL();
                }
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –≤ switchSubTab:", error);
                showNotification(`–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –ø–æ–¥–≤–∫–ª–∞–¥–æ–∫: ${error.message}`, 'error');
            }
        }

        /**
         * –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –ø–æ–ª–µ –≤–≤–æ–¥–∞.
         * @param {HTMLElement} inputElement - –≠–ª–µ–º–µ–Ω—Ç input.
         * @param {HTMLElement} messageElement - –≠–ª–µ–º–µ–Ω—Ç –¥–ª—è –≤—ã–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏.
         * @param {number} min - –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –¥–æ–ø—É—Å—Ç–∏–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.
         * @param {number} [max=Infinity] - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –¥–æ–ø—É—Å—Ç–∏–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.
         * @returns {boolean} - true, –µ—Å–ª–∏ –≤–≤–æ–¥ –≤–∞–ª–∏–¥–µ–Ω, –∏–Ω–∞—á–µ false.
         */
        function validateInput(inputElement, messageElement, min, max = Infinity) {
            if (!inputElement || !messageElement) return true;
            const value = parseFloat(inputElement.value);
            let isValid = true;
            let message = '';

            if (inputElement.value.trim() === '') {
                message = '';
                isValid = true;
            } else if (isNaN(value)) {
                message = '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —á–∏—Å–ª–æ.';
                isValid = false;
            } else if (value < min) {
                message = `–ó–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ ${min}.`;
                isValid = false;
            } else if (value > max) {
                message = `–ó–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ –±–æ–ª–µ–µ ${max}.`;
                isValid = false;
            }

            if (isValid) {
                inputElement.classList.remove('invalid-input');
                messageElement.textContent = '';
            } else {
                inputElement.classList.add('invalid-input');
                messageElement.textContent = message;
            }
            return isValid;
        }

        /**
         * –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Ç–∏–ø–æ–≤.
         * @param {string} type - –¢–∏–ø –∑–Ω–∞—á–µ–Ω–∏—è ('balance', 'leverage', 'risk').
         */
        function toggleDefault(type) {
            const toggleInput = document.getElementById(`default${type.charAt(0).toUpperCase() + type.slice(1)}Toggle`);
            if (!toggleInput) return;
            const toggle = toggleInput.checked;
            localStorage.setItem(`useDefault${type.charAt(0).toUpperCase() + type.slice(1)}`, toggle);

            const defaultValueInput = document.getElementById(`default${type.charAt(0).toUpperCase() + type.slice(1)}`);
            const validationMessageElement = document.getElementById(`default${type.charAt(0).toUpperCase() + type.slice(1)}-validation`);

            if (!toggle) {
                localStorage.removeItem(`default${type.charAt(0).toUpperCase() + type.slice(1)}`);
                 if (defaultValueInput) {
                    defaultValueInput.value = '';
                    defaultValueInput.classList.remove('invalid-input');
                    if (validationMessageElement) validationMessageElement.textContent = '';
                 }

                if (type === 'risk') {
                    if(riskSlider) riskSlider.value = 3;
                    if(riskValue) riskValue.textContent = '3.0%';
                }
            } else {
                const value = defaultValueInput ? parseFloat(defaultValueInput.value) : '';
                if (!isNaN(value) && value !== '') {
                    localStorage.setItem(`default${type.charAt(0).toUpperCase() + type.slice(1)}`, value.toString());
                     if (type === 'risk') {
                        const numericValue = parseFloat(value);
                         if (!isNaN(numericValue)) {
                            if (riskSlider) riskSlider.value = Math.min(numericValue, 10);
                            if (riskValue) riskValue.textContent = `${Math.min(numericValue, 10).toFixed(1)}%`;
                         }
                    }
                } else {
                    toggleInput.checked = false;
                    localStorage.setItem(`useDefault${type.charAt(0).toUpperCase() + type.slice(1)}`, false);
                    showNotification(`–ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è "${defaultTypeLabels[type]}": –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —á–∏—Å–ª–æ.`, 'warning');
                }
            }
            updateCalculatorWithDefaults();
            const activeSubTabElement = document.querySelector('#calculations .sub-tab.active');
            if (activeSubTabElement && activeSubTabElement.id === 'risk-on-deal') {
                calculateRiskOnDeal();
            }
            showNotification(`–ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è "${defaultTypeLabels[type]}" ${toggle ? '–≤–∫–ª—é—á–µ–Ω–æ' : '–≤—ã–∫–ª—é—á–µ–Ω–æ'}`, 'defaultSettings');
        }

        /**
         * –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞.
         * @param {string} type - –¢–∏–ø –∑–Ω–∞—á–µ–Ω–∏—è ('balance', 'leverage', 'risk').
         */
        function saveDefault(type) {
            const valueInput = document.getElementById(`default${type.charAt(0).toUpperCase() + type.slice(1)}`);
            const value = valueInput ? parseFloat(valueInput.value) : NaN;
            const toggleInput = document.getElementById(`default${type.charAt(0).toUpperCase() + type.slice(1)}Toggle`);
            if (!toggleInput) return;
            const toggle = toggleInput.checked;

            if (toggle && !isNaN(value) && value !== '') {
                localStorage.setItem(`default${type.charAt(0).toUpperCase() + type.slice(1)}`, value.toString());
                if (type === 'risk') {
                    const numericValue = parseFloat(value);
                     if (!isNaN(numericValue)) {
                        if (riskSlider) riskSlider.value = Math.min(numericValue, 10);
                        if (riskValue) riskValue.textContent = `${Math.min(numericValue, 10).toFixed(1)}%`;
                     }
                }
                 showNotification(`–ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è "${defaultTypeLabels[type]}" —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ`, 'defaultSettings');
            } else if (toggle && (isNaN(value) || value === '')) {
                 localStorage.removeItem(`default${type.charAt(0).toUpperCase() + type.slice(1)}`);
                 if (type === 'risk') {
                     if (riskSlider) riskSlider.value = 3;
                     if (riskValue) riskValue.textContent = '3.0%';
                 }
                 showNotification(`–ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è "${defaultTypeLabels[type]}" –æ—á–∏—â–µ–Ω–æ`, 'defaultSettings');
            }
            updateCalculatorWithDefaults();
            const activeSubTabElement = document.querySelector('#calculations .sub-tab.active');
            if (activeSubTabElement && activeSubTabElement.id === 'risk-on-deal') {
                calculateRiskOnDeal();
            }
        }

        /**
         * –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
         */
        function loadDefaults() {
            const types = ['balance', 'leverage', 'risk'];
            types.forEach(type => {
                const useDefault = localStorage.getItem(`useDefault${type.charAt(0).toUpperCase() + type.slice(1)}`) === 'true';
                const toggleElement = document.getElementById(`default${type.charAt(0).toUpperCase() + type.slice(1)}Toggle`);
                 if (toggleElement) {
                    toggleElement.checked = useDefault;
                 }

                const defaultValue = localStorage.getItem(`default${type.charAt(0).toUpperCase() + type.slice(1)}`);
                const defaultValueInput = document.getElementById(`default${type.charAt(0).toUpperCase() + type.slice(1)}`);
                if (defaultValueInput && defaultValue !== null) {
                    defaultValueInput.value = defaultValue;
                }
            });
        }

        /**
         * –û–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ–ª—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –µ—Å–ª–∏ –æ–Ω–∏ –≤–∫–ª—é—á–µ–Ω—ã.
         */
        function updateCalculatorWithDefaults() {
            const useDefaultBalance = localStorage.getItem('useDefaultBalance') === 'true';
            const useDefaultLeverage = localStorage.getItem('useDefaultLeverage') === 'true';
            const useDefaultRisk = localStorage.getItem('useDefaultRisk') === 'true';

            if (useDefaultBalance) {
                const defaultBalance = localStorage.getItem('defaultBalance');
                if (defaultBalance !== null && balanceInput) balanceInput.value = defaultBalance;
            } else {
                 // –û—á–∏—â–∞–µ–º, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é,
                 // —á—Ç–æ–±—ã –Ω–µ —Å—Ç–µ—Ä–µ—Ç—å –≤–≤–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –µ—Å–ª–∏ –æ–Ω –æ—Ç–∫–ª—é—á–∏–ª –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
                 if (balanceInput && balanceInput.value === localStorage.getItem('defaultBalance')) balanceInput.value = '';
            }

            if (useDefaultLeverage) {
                const defaultLeverage = localStorage.getItem('defaultLeverage');
                if (defaultLeverage !== null && leverageInput) leverageInput.value = defaultLeverage;
            } else {
                 if (leverageInput && leverageInput.value === localStorage.getItem('defaultLeverage')) leverageInput.value = '';
            }

            if (useDefaultRisk) {
                const defaultRisk = localStorage.getItem('defaultRisk');
                if (defaultRisk !== null) {
                    const numericValue = parseFloat(defaultRisk);
                     if (!isNaN(numericValue)) {
                        if (riskSlider) riskSlider.value = Math.min(numericValue, 10);
                        if (riskValue) riskValue.textContent = `${Math.min(numericValue, 10).toFixed(1)}%`;
                     }
                }
            } else {
                 if (riskSlider) riskSlider.value = 3;
                 if (riskValue) riskValue.textContent = '3.0%';
            }
        }

        /**
         * –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º —ç–ª–µ–º–µ–Ω—Ç–µ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π.
         * @param {HTMLElement} element - –≠–ª–µ–º–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.
         * @param {number|string} value - –ó–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.
         * @param {string} unit - –ï–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, ' USDT', '%').
         * @param {boolean} isPlaceholder - true, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ-–∑–∞–≥–ª—É—à–∫—É.
         */
        function displayResult(element, value, unit = '', isPlaceholder = false) {
            if (!element) return;

            if (isPlaceholder) {
                element.textContent = placeholderMessage;
                element.classList.add('is-placeholder');
                element.classList.remove('high-risk');
                element.style.opacity = '0';
                element.style.transform = 'translateY(5px)';
                requestAnimationFrame(() => {
                    element.style.opacity = '0.7';
                    element.style.transform = 'translateY(0px)';
                });
            } else {
                element.classList.remove('is-placeholder');
                let formattedValue;
                if (typeof value === 'number') {
                    formattedValue = `${value.toFixed(currentPrecision)}${unit}`;
                } else {
                    formattedValue = `${value}${unit}`;
                }

                // –õ–æ–≥–∏–∫–∞ –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏ —Ä–∏—Å–∫–∞ –Ω–∞ —Å–¥–µ–ª–∫—É
                if (element.id === 'riskAmount') {
                    const currentBalance = parseFloat(balanceInput?.value);
                    if (!isNaN(currentBalance) && currentBalance > 0) {
                        const riskAmountVal = typeof value === 'number' ? value : parseFloat(value);
                        const riskPercentageDisplay = (riskAmountVal / currentBalance) * 100;

                        if (riskPercentageDisplay > 5) {
                            element.classList.add('high-risk');
                        } else {
                            element.classList.remove('high-risk');
                        }
                        
                        if (isFixedLossModeForRiskOnDeal) {
                             formattedValue = `${riskAmountVal.toFixed(currentPrecision)} USDT (${riskPercentageDisplay.toFixed(2)}%)`;
                        } else {
                             formattedValue = `${riskAmountVal.toFixed(currentPrecision)} USDT`;
                        }
                    } else {
                        element.classList.remove('high-risk');
                        formattedValue = `${value.toFixed(currentPrecision)} USDT`;
                    }
                }

                // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–Ω–∞—á–µ–Ω–∏—è
                if (element.textContent !== formattedValue) {
                    element.style.opacity = '0';
                    element.style.transform = 'translateY(10px) scale(0.95)';
                    setTimeout(() => {
                        element.textContent = formattedValue;
                        element.style.opacity = '1';
                        element.style.transform = 'translateY(0px) scale(1)';
                    }, 50);
                } else if (element.style.opacity === '0') {
                     element.style.opacity = '1';
                     element.style.transform = 'translateY(0px) scale(1)';
                }
            }
        }

        /**
         * –í—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–∞—Å—á–µ—Ç—ã –¥–ª—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ "–†–∏—Å–∫ –Ω–∞ —Å–¥–µ–ª–∫—É".
         */
        function calculateRiskOnDeal() {
            const balanceVal = parseFloat(balanceInput?.value);
            const leverageVal = parseFloat(leverageInput?.value) || 1;
            const riskPercentage = parseFloat(riskSlider?.value);
            const fixedLossVal = parseFloat(fixedLossInput?.value);
            const entryPointVal = parseFloat(entryPointInput?.value);
            const stopLossVal = parseFloat(stopLossInput?.value);
            const roiVal = parseFloat(roiInput?.value);

            let isValid = true;

            isValid = validateInput(balanceInput, document.getElementById('balance-validation'), 0.01) && isValid;
            isValid = validateInput(leverageInput, document.getElementById('leverage-validation'), 1) && isValid;

            if (isROIModeForRiskOnDeal) {
                isValid = validateInput(roiInput, document.getElementById('roi-validation'), 0.01) && isValid;
            } else {
                isValid = validateInput(entryPointInput, document.getElementById('entryPoint-validation'), 0.01) && isValid;
                isValid = validateInput(stopLossInput, document.getElementById('stopLoss-validation'), 0.01) && isValid;
            }

            if (isFixedLossModeForRiskOnDeal) {
                isValid = validateInput(fixedLossInput, fixedLossValidation, 0.01) && isValid;
                if (!isNaN(fixedLossVal) && !isNaN(balanceVal) && fixedLossVal > balanceVal) {
                    fixedLossValidation.textContent = '–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —É–±—ã—Ç–æ–∫ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ –±–∞–ª–∞–Ω—Å–∞.';
                    fixedLossInput.classList.add('invalid-input');
                    isValid = false;
                }
            }

            if (!isValid || isNaN(balanceVal) || isNaN(leverageVal)) {
                displayResult(riskAmountDisplay, placeholderMessage, '', true);
                displayResult(marginDisplay, placeholderMessage, '', true);
                displayResult(positionSizeDisplay, placeholderMessage, '', true);
                displayResult(pureMovementDisplay, placeholderMessage, '', true);
                return;
            }

            let margin = 0, positionSize = 0, riskAmount = 0, pureMovement = 0;

            let calculatedROI = 0;
            if (isROIModeForRiskOnDeal && !isNaN(roiVal)) {
                calculatedROI = roiVal;
            } else if (!isROIModeForRiskOnDeal && !isNaN(entryPointVal) && !isNaN(stopLossVal) && Math.abs(entryPointVal - stopLossVal) > 0) {
                pureMovement = (Math.abs(entryPointVal - stopLossVal) / entryPointVal) * 100;
                calculatedROI = pureMovement * leverageVal;
            } else {
                displayResult(riskAmountDisplay, placeholderMessage, '', true);
                displayResult(marginDisplay, placeholderMessage, '', true);
                displayResult(positionSizeDisplay, placeholderMessage, '', true);
                displayResult(pureMovementDisplay, placeholderMessage, '', true);
                return;
            }

            if (isFixedLossModeForRiskOnDeal && !isNaN(fixedLossVal)) {
                riskAmount = fixedLossVal;
            } else {
                riskAmount = (balanceVal * riskPercentage) / 100;
            }

            if (calculatedROI === 0) {
                 displayResult(riskAmountDisplay, placeholderMessage, '', true);
                 displayResult(marginDisplay, placeholderMessage, '', true);
                 displayResult(positionSizeDisplay, placeholderMessage, '', true);
                 displayResult(pureMovementDisplay, placeholderMessage, '', true);
                 return;
            }

            positionSize = (riskAmount / (calculatedROI / 100)) * 100;
            margin = positionSize / leverageVal;

            if (!isROIModeForRiskOnDeal && !isNaN(entryPointVal) && !isNaN(stopLossVal) && Math.abs(entryPointVal - stopLossVal) > 0) {
                // pureMovement —É–∂–µ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω –∏–∑ entry/stop
            } else if (positionSize > 0) {
                pureMovement = (riskAmount * 100) / positionSize;
            } else {
                pureMovement = 0;
            }

            displayResult(riskAmountDisplay, riskAmount);
            displayResult(marginDisplay, margin, ' USDT');
            displayResult(positionSizeDisplay, positionSize, ' USDT');
            displayResult(pureMovementDisplay, pureMovement, '%');
        }

        /**
         * –í—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–∞—Å—á–µ—Ç—ã –¥–ª—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ "–°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Ä–∏—Å–∫–∞/–ø—Ä–∏–±—ã–ª–∏".
         */
        function calculateRiskReward() {
            if (!rrEntryPointInput || !rrStopLossInput || !rrTakeProfitInput ||
                !rrSLPointsDisplay || !rrTPPointsDisplay || !rrRatioDisplay) {
                return;
            }

            const isEntryPointValid = validateInput(rrEntryPointInput, document.getElementById('rrEntryPoint-validation'), 0.01);
            const isStopLossValid = validateInput(rrStopLossInput, document.getElementById('rrStopLoss-validation'), 0.01);
            const isTakeProfitValid = validateInput(rrTakeProfitInput, document.getElementById('rrTakeProfit-validation'), 0.01);

            const entryPoint = parseFloat(rrEntryPointInput.value);
            const stopLoss = parseFloat(rrStopLossInput.value);
            const takeProfit = parseFloat(rrTakeProfitInput.value);

            if (!isEntryPointValid || !isStopLossValid || !isTakeProfitValid ||
                isNaN(entryPoint) || isNaN(stopLoss) || isNaN(takeProfit)) {
                displayResult(rrTPPointsDisplay, placeholderMessage, '', true);
                displayResult(rrSLPointsDisplay, placeholderMessage, '', true);
                displayResult(rrRatioDisplay, placeholderMessage, '', true);
                return;
            }

            const slPoints = Math.abs(entryPoint - stopLoss);
            const tpPoints = Math.abs(entryPoint - takeProfit);

            displayResult(rrTPPointsDisplay, tpPoints, '', false);
            displayResult(rrSLPointsDisplay, slPoints, '', false);

            if (slPoints > 0) {
                const ratio = tpPoints / slPoints;
                displayResult(rrRatioDisplay, `1:${ratio.toFixed(currentPrecision)}`, '');
            } else {
                showNotification('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—É–Ω–∫—Ç–æ–≤ –¥–æ —Å—Ç–æ–ø-–ª–æ—Å—Å–∞ —Ä–∞–≤–Ω–æ 0. –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Ä–∏—Å–∫–∞/–ø—Ä–∏–±—ã–ª–∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–æ.', 'warning');
                displayResult(rrRatioDisplay, '–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å (SL = TP)', '', true);
            }
        }

        /**
         * –í—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–∞—Å—á–µ—Ç—ã –¥–ª—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ "–ü—Ä–∏–±—ã–ª–∏/—É–±—ã—Ç–∫–∞".
         */
        function calculatePnL() {
            if (!pnlEntryPriceInput || !pnlExitPriceInput || !pnlPositionAmountInput || !pnlLeverageInput ||
                !pnlTotalPnLDisplay || !pnlRoiDisplay || !pnlPureMovementDisplay) {
                return;
            }

            const isEntryPriceValid = validateInput(pnlEntryPriceInput, document.getElementById('pnlEntryPrice-validation'), 0.01);
            const isExitPriceValid = validateInput(pnlExitPriceInput, document.getElementById('pnlExitPrice-validation'), 0.01);
            const isPositionAmountValid = validateInput(pnlPositionAmountInput, document.getElementById('pnlPositionAmount-validation'), 0.01);
            const isLeverageValid = validateInput(pnlLeverageInput, document.getElementById('pnlLeverage-validation'), 1);

            const entryPrice = parseFloat(pnlEntryPriceInput.value);
            const exitPrice = parseFloat(pnlExitPriceInput.value);
            const positionAmount = parseFloat(pnlPositionAmountInput.value);
            const leverage = parseFloat(pnlLeverageInput.value);

            if (!isEntryPriceValid || !isExitPriceValid || !isPositionAmountValid || !isLeverageValid ||
                isNaN(entryPrice) || isNaN(exitPrice) || isNaN(positionAmount) || isNaN(leverage)) {
                displayResult(pnlTotalPnLDisplay, placeholderMessage, '', true);
                displayResult(pnlRoiDisplay, placeholderMessage, '', true);
                displayResult(pnlPureMovementDisplay, placeholderMessage, '', true);
                return;
            }

            const totalPnL = (exitPrice - entryPrice) * (positionAmount / entryPrice);
            const pureMovement = ((exitPrice - entryPrice) / entryPrice) * 100;
            
            let roi = 0;
            const margin = positionAmount / leverage; // –ò–∑–Ω–∞—á–∞–ª—å–Ω–∞—è –º–∞—Ä–∂–∞ (—Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–∑–∏—Ü–∏–∏ / –ø–ª–µ—á–æ)
            if (margin > 0) {
                 roi = (totalPnL / margin) * 100; // ROI = (–û–±—â–∞—è –ø—Ä–∏–±—ã–ª—å/—É–±—ã—Ç–æ–∫ / –ú–∞—Ä–∂–∞) * 100
            } else {
                roi = 0;
            }

            displayResult(pnlTotalPnLDisplay, totalPnL, ' USDT');
            displayResult(pnlRoiDisplay, roi, '%');
            displayResult(pnlPureMovementDisplay, pureMovement, '%');
        }

        /**
         * –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç –ø–æ–ª—è –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ "–†–∏—Å–∫ –Ω–∞ —Å–¥–µ–ª–∫—É".
         */
        function resetRiskOnDealCalculator() {
            if (balanceInput) balanceInput.value = '';
            if (leverageInput) leverageInput.value = '';
            if (entryPointInput) entryPointInput.value = '';
            if (stopLossInput) stopLossInput.value = '';
            if (roiInput) roiInput.value = '';
            if (riskSlider) riskSlider.value = 3;
            if (riskValue) riskValue.textContent = '3.0%';
            if (fixedLossInput) fixedLossInput.value = '';

            if (document.getElementById('balance-validation')) document.getElementById('balance-validation').textContent = '';
            if (document.getElementById('leverage-validation')) document.getElementById('leverage-validation').textContent = '';
            if (document.getElementById('entryPoint-validation')) document.getElementById('entryPoint-validation').textContent = '';
            if (document.getElementById('stopLoss-validation')) document.getElementById('stopLoss-validation').textContent = '';
            if (document.getElementById('roi-validation')) document.getElementById('roi-validation').textContent = '';
            if (fixedLossValidation) fixedLossValidation.textContent = '';

            if (balanceInput) balanceInput.classList.remove('invalid-input');
            if (leverageInput) leverageInput.classList.remove('invalid-input');
            if (entryPointInput) entryPointInput.classList.remove('invalid-input');
            if (stopLossInput) stopLossInput.classList.remove('invalid-input');
            if (roiInput) roiInput.classList.remove('invalid-input');
            if (fixedLossInput) fixedLossInput.classList.remove('invalid-input');

            isROIModeForRiskOnDeal = false;
            isFixedLossModeForRiskOnDeal = false;
            if (document.getElementById('mainButtonTextPart')) document.getElementById('mainButtonTextPart').textContent = 'ENTRY/SL üîÑ';
            if (document.getElementById('twhStopFields')) document.getElementById('twhStopFields').style.display = 'block';
            if (document.getElementById('roiField')) document.getElementById('roiField').style.display = 'none';

            if (document.getElementById('riskToggleButton')) document.getElementById('riskToggleButton').textContent = '% —Ä–∏—Å–∫–∞ –Ω–∞ —Å–¥–µ–ª–∫—É üîÑ';
            if (document.getElementById('riskPercentageSlider')) document.getElementById('riskPercentageSlider').style.display = 'flex';
            if (document.getElementById('fixedLossInput')) document.getElementById('fixedLossInput').style.display = 'none';

            calculateRiskOnDeal();
            showNotification('–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä "–†–∏—Å–∫ –Ω–∞ —Å–¥–µ–ª–∫—É" —Å–±—Ä–æ—à–µ–Ω.');
        }

        /**
         * –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç –ø–æ–ª—è –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ "–°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Ä–∏—Å–∫–∞/–ø—Ä–∏–±—ã–ª–∏".
         */
        function resetRiskRewardCalculator() {
            if (rrEntryPointInput) rrEntryPointInput.value = '';
            if (rrStopLossInput) rrStopLossInput.value = '';
            if (rrTakeProfitInput) rrTakeProfitInput.value = '';
            if (document.getElementById('rrEntryPoint-validation')) document.getElementById('rrEntryPoint-validation').textContent = '';
            if (document.getElementById('rrStopLoss-validation')) document.getElementById('rrStopLoss-validation').textContent = '';
            if (document.getElementById('rrTakeProfit-validation')) document.getElementById('rrTakeProfit-validation').textContent = '';
            if (rrEntryPointInput) rrEntryPointInput.classList.remove('invalid-input');
            if (rrStopLossInput) rrStopLossInput.classList.remove('invalid-input');
            if (rrTakeProfitInput) rrTakeProfitInput.classList.remove('invalid-input');
            calculateRiskReward();
            showNotification('–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è —Ä–∏—Å–∫–∞/–ø—Ä–∏–±—ã–ª–∏ —Å–±—Ä–æ—à–µ–Ω.');
        }

        /**
         * –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç –ø–æ–ª—è –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ "–ü—Ä–∏–±—ã–ª–∏/—É–±—ã—Ç–∫–∞".
         */
        function resetPnLCalculator() {
            if (pnlEntryPriceInput) pnlEntryPriceInput.value = '';
            if (pnlExitPriceInput) pnlExitPriceInput.value = '';
            if (pnlPositionAmountInput) pnlPositionAmountInput.value = '';
            if (pnlLeverageInput) pnlLeverageInput.value = '';

            if (document.getElementById('pnlEntryPrice-validation')) document.getElementById('pnlEntryPrice-validation').textContent = '';
            if (document.getElementById('pnlExitPrice-validation')) document.getElementById('pnlExitPrice-validation').textContent = '';
            if (document.getElementById('pnlPositionAmount-validation')) document.getElementById('pnlPositionAmount-validation').textContent = '';
            if (document.getElementById('pnlLeverage-validation')) document.getElementById('pnlLeverage-validation').textContent = '';

            if (pnlEntryPriceInput) pnlEntryPriceInput.classList.remove('invalid-input');
            if (pnlExitPriceInput) pnlExitPriceInput.classList.remove('invalid-input');
            if (pnlPositionAmountInput) pnlPositionAmountInput.classList.remove('invalid-input');
            if (pnlLeverageInput) pnlLeverageInput.classList.remove('invalid-input');

            calculatePnL();
            showNotification('–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø—Ä–∏–±—ã–ª–∏/—É–±—ã—Ç–∫–∞ —Å–±—Ä–æ—à–µ–Ω.');
        }
    </script>
</body>
</html>
